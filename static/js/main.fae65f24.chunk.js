(this["webpackJsonpu-dicom-viewer"]=this["webpackJsonpu-dicom-viewer"]||[]).push([[0],{135:function(e){e.exports=JSON.parse('{"name":"u-dicom-viewer","version":"0.8.1","private":true,"homepage":"https://webnamics.github.io/u-dicom-viewer/","dependencies":{"@material-ui/core":"^4.11.0","@material-ui/icons":"^4.9.1","@material-ui/lab":"^4.0.0-alpha.56","@mdi/js":"^5.3.45","@mdi/react":"^1.4.0","@react-md/material-icons":"^2.1.0","acorn":"^7.3.1","axios":"^0.19.2","blob-util":"^2.0.2","cornerstone-core":"^2.3.0","cornerstone-file-image-loader":"^0.3.0","cornerstone-math":"^0.1.8","cornerstone-tools":"^4.18.1","cornerstone-wado-image-loader":"git+https://github.com/webnamics/cornerstoneWADOImageLoader.git","cornerstone-web-image-loader":"^2.1.1","daikon":"^1.2.42","dexie":"^3.0.1","dicom-parser":"^1.8.5","file-saver":"^2.0.2","gh-pages":"^3.1.0","hammerjs":"^2.0.8","jszip":"^3.5.0","lodash":"^4.17.19","lodash.template":"^4.5.0","material-table":"^1.66.0","mathjs":"^7.1.0","react":"^16.13.1","react-device-detect":"^1.13.1","react-dom":"^16.13.1","react-icons":"^3.10.0","react-perfect-scrollbar":"^1.5.8","react-redux":"^7.2.0","react-resize-detector":"^4.2.3","react-rnd":"^10.1.10","react-router":"^5.2.0","react-router-dom":"^5.2.0","react-scripts":"3.4.1","react-scroll-wheel-handler":"^1.1.5","react-virtualized":"^9.21.2","react-window":"^1.8.5","redux":"^4.0.5","serialize-javascript":"^3.1.0","set-value":"3.0.2","three":"^0.118.3","uuid":"^8.2.0","webfontloader":"^1.6.28"},"scripts":{"start":"react-scripts start","build":"react-scripts build","test":"react-scripts test","predeploy":"npm run build","deploy":"gh-pages -d build","eject":"react-scripts eject"},"eslintConfig":{"extends":"react-app"},"browserslist":{"production":[">0.2%","not dead","not op_mini all"],"development":["last 1 chrome version","last 1 firefox version","last 1 safari version"]},"devDependencies":{"@babel/core":"^7.10.5","babel-core":"^6.26.3","babel-loader":"^8.1.0","npm-run-all":"^4.1.5"}}')},164:function(e,t,a){e.exports=a(202)},169:function(e,t,a){},201:function(e,t,a){},202:function(e,t,a){"use strict";a.r(t);var n=a(0),i=a.n(n),r=a(18),o=a.n(r),s=(a(169),a(14)),l=a(16),c=a(17),m=a(43),u=a(20),d=a(21),p=a(69),f=a(4),g=a(25),h=a(256),v=a(249),E=a(255),b=a(252),S=a(251),y=a(248),x=a(253),I=a(204),C=a(254),D=a(55),w=a(135),F=function(e){var t=e.onClose,a=i.a.createElement(D.a,{variant:"body2"},i.a.createElement(y.a,{href:"https://github.com/webnamics/u-dicom-viewer/",target:"_blank",style:{color:"#999999"}},"https://github.com/webnamics/u-dicom-viewer")),n=i.a.createElement(D.a,{variant:"body2",style:{color:"#999999"}},w.version);return i.a.createElement("div",null,i.a.createElement(v.a,{onClose:t,open:!0},i.a.createElement(S.a,{onClose:t,disableTypography:!0},i.a.createElement(D.a,{variant:"h6"},"About ",i.a.createElement("strong",null,"U")," ",i.a.createElement("strong",null,"D"),"icom ",i.a.createElement("strong",null,"V"),"iewer")),i.a.createElement(b.a,null,i.a.createElement(x.a,null,i.a.createElement(I.a,null,i.a.createElement(C.a,{primary:"Repository URL:",secondary:a})),i.a.createElement(I.a,null,i.a.createElement(C.a,{primary:"Version:",secondary:n})))),i.a.createElement(E.a,null,i.a.createElement(h.a,{autoFocus:!0,onClick:t},"Close"))))},O=a(257),M=a(81),R=a(63),P=a.n(R),L=a(64),T=a.n(L),k=(a(66),a(37)),A=a.n(k),V=a(96),z=new V.a("fsDB");z.version(1).stores({files:"[parent+name], parent, name, type"}),z.open();var j=z,N=a(26),B=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e-9;return Math.abs(e-t)<a},U=function(e){return e.reduce((function(e,t){return e+t}),0)},G=function(e,t){return[].concat(Object(s.a)(e.slice(0,t)),Object(s.a)(e.slice(t+1)))},W=function(){function e(){Object(l.a)(this,e);for(var t=arguments.length,a=new Array(t),n=0;n<t;n++)a[n]=arguments[n];this.components=a}return Object(c.a)(e,[{key:"length",value:function(){return Math.hypot.apply(Math,Object(s.a)(this.components))}},{key:"isZero",value:function(){var e=this;return this.components.reduce((function(t,a,n){return t&&(i=e.components[n],Math.abs(i)<1e-9);var i}),!0)}},{key:"abs",value:function(){return Object(N.a)(e,Object(s.a)(this.components.map((function(e){return Math.abs(e)}))))}},{key:"round",value:function(){return Object(N.a)(e,Object(s.a)(this.components.map((function(e){return Math.round(e)}))))}},{key:"nearestAxis",value:function(){var t=e.zero,a=Math.abs(this.components[0]),n=Math.abs(this.components[1]),i=Math.abs(this.components[2]);return a>=n&&a>=i?t.x=this.components[0]>0?1:-1:n>=i?t.y=this.components[1]>0?1:-1:t.z=this.components[2]>0?1:-1,t}},{key:"toArray",value:function(){return this.components}},{key:"mul",value:function(t){return Object(N.a)(e,Object(s.a)(this.components.map((function(e){return e*t}))))}},{key:"add",value:function(t){var a=this,n=t.components;return Object(N.a)(e,Object(s.a)(n.map((function(e,t){return a.components[t]+e}))))}},{key:"sub",value:function(t){var a=this,n=t.components;return Object(N.a)(e,Object(s.a)(n.map((function(e,t){return a.components[t]-e}))))}},{key:"crossProduct",value:function(t){var a=t.components;if(3===this.components.length)return new e(this.components[1]*a[2]-this.components[2]*a[1],this.components[2]*a[0]-this.components[0]*a[2],this.components[0]*a[1]-this.components[1]*a[0])}},{key:"dotProduct",value:function(e){var t=this;return e.components.reduce((function(e,a,n){return e+a*t.components[n]}),0)}},{key:"x",get:function(){return this.components[0]},set:function(e){this.components[0]=e}},{key:"y",get:function(){return this.components[1]},set:function(e){this.components[1]=e}},{key:"z",get:function(){return this.components[2]},set:function(e){this.components[2]=e}}],[{key:"zero",get:function(){return new e(0,0,0)}}]),e}(),Z=a(28);function H(e){if(null===e)return null;var t=e.data.string("x00200010");return void 0!==t?t:void 0}function _(e,t){var a=e.data.string("x00200032");if(void 0!==a){var n=a.split("\\");return parseFloat(n[t])}}function X(e){var t=e.data.string("x00180086");if(void 0!==t)return parseFloat(t)}function J(e){var t=e.data.string("x00201041");if(void 0!==t)return parseFloat(t)}function Y(e,t){var a=new Map;return e.forEach((function(e){var n=t(e),i=a.get(n);i?i.push(e):a.set(n,[e])})),a}function q(){var e=document.createElement("input");return"webkitdirectory"in e||"mozdirectory"in e||"odirectory"in e||"msdirectory"in e||"directory"in e}function Q(e){return void 0!==e&&null!==e&&null!=e.match(/\.(jpeg|jpg|png)$/)}function K(e){if(void 0===e||null===e)return!1;return e&&["image/jpeg","image/png"].includes(e.type)}function $(e){return console.log("isFsFileImage: ",e),void 0!==e&&null!==e&&("jpeg"===e.type.toLowerCase()||"png"===e.type.toLowerCase())}function ee(e){if(Z.isAndroid&&Z.isFirefox&&"null"===te(e))return ne(e);return e}function te(e){var t=/(?:\.([^.]+))?$/.exec(e)[1];return void 0===t?"dcm":t}function ae(e){var t=/(?:\.([^.]+))?$/.exec(e)[1];return void 0===t?"":t}function ne(e){var t=e.replace(/\.[^.$]+$/,"");return void 0===t?"":t}function ie(){var e=localStorage.getItem("saveInto");return null===e&&(e="local",localStorage.setItem("saveInto",e)),e}function re(){var e=localStorage.getItem("overlay");return null===e&&(e="1",localStorage.setItem("overlay",e)),"1"===e}function oe(){var e=localStorage.getItem("fsView");return null===e&&(e=Z.isMobile&&!Z.isTablet?"bottom":"right",localStorage.setItem("fsView",e)),e}function se(){var e=localStorage.getItem("dicomdirView");return null===e&&(e=Z.isMobile&&!Z.isTablet?"bottom":"right",localStorage.setItem("dicomdirView",e)),e}function le(){var e=localStorage.getItem("mprInterpolation");return null===e&&(e="weightedlinear",localStorage.setItem("mprInterpolation",e)),e}function ce(e){var t=typeof e;return"undefined"===t||null===t?"":"string"===t?'"'+e.replace(/"/g,'""')+'"':'"'+String(e).replace(/"/g,'""')+'"'}var me=function(e){return{type:"LOCALFILE_STORE",fsFile:e}},ue=function(e){return{type:"FILES_STORE",files:e}},de=function(e){return{type:"DCM_IS_OPEN",value:e}},pe=function(e){return{type:"DCM_TOOL",tool:e}},fe=function(e){return{type:"ACTIVE_DCM",activeDcm:e}},ge=function(e){return{type:"ACTIVE_MEASUREMENTS",measurements:e}},he=function(e){return{type:"EXPLORER_ACTIVE_SERIES_INDEX",explorerActiveSeriesIndex:e}},ve=function(e){return{type:"FSZIPPEDFILE",fsZippedFile:e}},Ee=function(e){return{type:"DCMENABLETOOL_STORE",dcmEnableTool:e}},be={height:"calc(100vh - 48px)"},Se=function(e){return e.expanded?i.a.createElement(P.a,null):i.a.createElement(T.a,null)},ye=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={data:[],expanded:[]},n.buildData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=n.output;null!==e&&(t[e].expanded=!t[e].expanded);var a=[],i=[],r=[],o=[];t.slice().reverse().forEach((function(e,t){"image"===e.key?a.unshift({id:e.id,key:e.key,path:e.path,value:e.value}):"series"===e.key?(i.unshift({id:e.id,key:e.key,number:e.number,value:e.value,expanded:e.expanded,children:a}),a=[]):"study"===e.key?(r.unshift({id:e.id,key:e.key,value:e.value,expanded:e.expanded,children:i}),i=[]):"patient"===e.key&&(o.unshift({id:e.id,key:e.key,value:e.value,expanded:e.expanded,children:r}),r=[])})),n.setState({data:o})},n.buildOutput=function(e){var t=e.elements.x00041220.items,a=[];return t&&t.forEach((function(e,t){var n,i,r=t.toString();if("PATIENT"===e.dataSet.string("x00041430"))a.push({id:r,key:"patient",value:e.dataSet.string("x00100010"),expanded:!0});else if("STUDY"===e.dataSet.string("x00041430")){var o="".concat((i=e.dataSet.string("x00080020"),new Date(i.substring(0,4)+"-"+i.substring(4,6)+"-"+i.substring(6)).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}))," - ").concat((n=e.dataSet.string("x00080030")).substring(0,2)+":"+n.substring(2,4)+":"+n.substring(4,6));a.push({id:r,key:"study",value:o,expanded:!0})}else"SERIES"===e.dataSet.string("x00041430")?a.push({id:r,key:"series",number:e.dataSet.string("x00200011"),value:e.dataSet.string("x00080060"),expanded:!0}):"IMAGE"===e.dataSet.string("x00041430")&&a.push({id:r,key:"image",path:e.dataSet.string("x00041500").replace(/\\/g,"/"),value:e.dataSet.string("x00041500").split("\\").pop(),expanded:!0})})),a},n.openDicomdir=function(e){var t=new FileReader;t.onload=function(e){var a=t.result,i=new Uint8Array(a),r=null,o=[];try{r=M.parseDicom(i),o=n.buildOutput(r)}catch(s){"undefined"!=typeof s.dataSet&&(o=n.buildOutput(s.dataSet))}n.output=o,n.buildData()},t.readAsArrayBuffer(e)},n.openDicomdirFs=function(e){var t=new Uint8Array(e.data),a=null,i=[];try{a=M.parseDicom(t),i=n.buildOutput(a)}catch(r){"undefined"!=typeof r.dataSet&&(i=n.buildOutput(r.dataSet))}n.output=i,n.buildData()},n.onClick=function(e){var t=n.output.find((function(t){return t.id===e}));if("image"===t.key)if("local"===n.props.dicomdir.origin){var a=n.props.dicomdir.files.find((function(e){return e.name===t.value}));n.props.onOpenFile(a)}else{var i=t.path.split("/"),r=i.pop();i.unshift(n.props.fsCurrentDir);var o=i.join("/");j.files.where({parent:o,name:r}).first((function(e){n.props.setFsFileStore(e),n.props.onOpenFs(e)}))}else n.buildData(e)},n.studyText=function(e){return e.value},n.output=null,n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){"local"===this.props.dicomdir.origin?this.openDicomdir(this.props.dicomdir.dicomdir):this.openDicomdirFs(this.props.dicomdir.dicomdir)}},{key:"render",value:function(){var e=this,t=this.props.classes,a=null;return a="bottom"===se()?{marginTop:"0px",height:"275px"}:{marginTop:"48px",width:"350px"},i.a.createElement(A.a,null,i.a.createElement("div",{style:be},i.a.createElement("div",{style:a},i.a.createElement(x.a,null,this.state.data.map((function(a,r){var o=Object.assign({},a);return i.a.createElement(n.Fragment,{key:r},i.a.createElement(I.a,{button:!0,onClick:function(){return e.onClick(o.id)}},i.a.createElement(C.a,{primary:o.value,secondary:o.key,classes:{primary:t.listItemText,secondary:t.listItemText}}),i.a.createElement(Se,{expanded:o.expanded})),i.a.createElement(O.a,{in:o.expanded},o.children.map((function(a){return i.a.createElement(n.Fragment,{key:a.id},i.a.createElement(I.a,{key:a.id,button:!0,dense:!0,onClick:function(){return e.onClick(a.id)},className:t.study},i.a.createElement(C.a,{primary:e.studyText(a),secondary:a.key,classes:{primary:t.listItemText,secondary:t.listItemText}}),i.a.createElement(Se,{expanded:a.expanded})),i.a.createElement(O.a,{in:a.expanded},a.children.map((function(r){return i.a.createElement(n.Fragment,{key:r.id},i.a.createElement(I.a,{key:r.id,button:!0,dense:!0,onClick:function(){return e.onClick(r.id)},className:t.series},i.a.createElement(C.a,{primary:"".concat(r.value," (").concat(r.number,")"),secondary:r.key,classes:{primary:t.listItemText,secondary:t.listItemText}}),i.a.createElement(Se,{expanded:a.expanded})),i.a.createElement(O.a,{in:r.expanded},r.children.map((function(a){return i.a.createElement(I.a,{key:a.id,button:!0,dense:!0,onClick:function(){return e.onClick(a.id)},className:t.images},i.a.createElement(C.a,{primary:a.value,secondary:a.key,classes:{primary:t.listItemText,secondary:t.listItemText}}))}))))}))))}))))}))))))}}]),a}(n.PureComponent),xe=Object(g.b)((function(e){return{dicomdir:e.dicomdir,fsCurrentDir:e.fsCurrentDir}}),(function(e){return{setFsFileStore:function(t){return e(me(t))}}}))(Object(f.a)((function(e){return{study:{paddingLeft:e.spacing(3)},series:{paddingLeft:e.spacing(5)},images:{paddingLeft:e.spacing(7)},listItemText:{fontSize:"0.80em"}}}))(ye)),Ie=a(22),Ce=a.n(Ie),De=a(33),we=a(259),Fe=a(136),Oe=a.n(Fe),Me=a(10),Re=a(7),Pe=a(137),Le=a(51),Te=a(138),ke=a(41),Ae=a(107),Ve={"1.2.840.10008.1.1":"Verification SOP Class","1.2.840.10008.1.2":"Implicit VR Little Endian: Default Transfer Syntax for DICOM","1.2.840.10008.1.2.1":"Explicit VR Little Endian","1.2.840.10008.1.2.1.99":"Deflated Explicit VR Little Endian","1.2.840.10008.1.2.2":"Explicit VR Big Endian (Retired)","1.2.840.10008.1.2.4.50":"JPEG Baseline (Process 1): Default Transfer Syntax for Lossy JPEG 8 Bit Image Compression","1.2.840.10008.1.2.4.51":"JPEG Extended (Process 2 & 4): Default Transfer Syntax for Lossy JPEG 12 Bit Image Compression (Process 4 only)","1.2.840.10008.1.2.4.52":"JPEG Extended (Process 3 & 5) (Retired)","1.2.840.10008.1.2.4.53":"JPEG Spectral Selection, Non-Hierarchical (Process 6 & 8) (Retired)","1.2.840.10008.1.2.4.54":"JPEG Spectral Selection, Non-Hierarchical (Process 7 & 9) (Retired)","1.2.840.10008.1.2.4.55":"JPEG Full Progression, Non-Hierarchical (Process 10 & 12) (Retired)","1.2.840.10008.1.2.4.56":"JPEG Full Progression, Non-Hierarchical (Process 11 & 13) (Retired)","1.2.840.10008.1.2.4.57":"JPEG Lossless, Non-Hierarchical (Process 14)","1.2.840.10008.1.2.4.58":"JPEG Lossless, Non-Hierarchical (Process 15) (Retired)","1.2.840.10008.1.2.4.59":"JPEG Extended, Hierarchical (Process 16 & 18) (Retired)","1.2.840.10008.1.2.4.60":"JPEG Extended, Hierarchical (Process 17 & 19) (Retired)","1.2.840.10008.1.2.4.61":"JPEG Spectral Selection, Hierarchical (Process 20 & 22) (Retired)","1.2.840.10008.1.2.4.62":"JPEG Spectral Selection, Hierarchical (Process 21 & 23) (Retired)","1.2.840.10008.1.2.4.63":"JPEG Full Progression, Hierarchical (Process 24 & 26) (Retired)","1.2.840.10008.1.2.4.64":"JPEG Full Progression, Hierarchical (Process 25 & 27) (Retired)","1.2.840.10008.1.2.4.65":"JPEG Lossless, Hierarchical (Process 28) (Retired)","1.2.840.10008.1.2.4.66":"JPEG Lossless, Hierarchical (Process 29) (Retired)","1.2.840.10008.1.2.4.70":"JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1]): Default Transfer Syntax for Lossless JPEG Image Compression","1.2.840.10008.1.2.4.80":"JPEG-LS Lossless Image Compression","1.2.840.10008.1.2.4.81":"JPEG-LS Lossy (Near-Lossless) Image Compression","1.2.840.10008.1.2.4.90":"JPEG 2000 Image Compression (Lossless Only)","1.2.840.10008.1.2.4.91":"JPEG 2000 Image Compression","1.2.840.10008.1.2.4.92":"JPEG 2000 Part 2 Multi-component Image Compression (Lossless Only)","1.2.840.10008.1.2.4.93":"JPEG 2000 Part 2 Multi-component Image Compression","1.2.840.10008.1.2.4.94":"JPIP Referenced","1.2.840.10008.1.2.4.95":"JPIP Referenced Deflate","1.2.840.10008.1.2.4.100":"MPEG2 Main Profile @ Main Level","1.2.840.10008.1.2.4.101":"MPEG2 Main Profile @ High Level","1.2.840.10008.1.2.4.102":"MPEG-4 AVC/H.264 High Profile / Level 4.1","1.2.840.10008.1.2.4.103":"MPEG-4 AVC/H.264 BD-compatible High Profile / Level 4.1","1.2.840.10008.1.2.4.104":"MPEG-4 AVC/H.264 High Profile / Level 4.2 For 2D Video","1.2.840.10008.1.2.4.105":"MPEG-4 AVC/H.264 High Profile / Level 4.2 For 3D Video","1.2.840.10008.1.2.4.106":"MPEG-4 AVC/H.264 Stereo High Profile / Level 4.2","1.2.840.10008.1.2.5":"RLE Lossless","1.2.840.10008.1.2.6.1":"RFC 2557 MIME encapsulation","1.2.840.10008.1.2.6.2":"XML Encoding","1.2.840.10008.1.3.10":"Media Storage Directory Storage","1.2.840.10008.1.4.1.1":"Talairach Brain Atlas Frame of Reference","1.2.840.10008.1.4.1.2":"SPM2 T1 Frame of Reference","1.2.840.10008.1.4.1.3":"SPM2 T2 Frame of Reference","1.2.840.10008.1.4.1.4":"SPM2 PD Frame of Reference","1.2.840.10008.1.4.1.5":"SPM2 EPI Frame of Reference","1.2.840.10008.1.4.1.6":"SPM2 FIL T1 Frame of Reference","1.2.840.10008.1.4.1.7":"SPM2 PET Frame of Reference","1.2.840.10008.1.4.1.8":"SPM2 TRANSM Frame of Reference","1.2.840.10008.1.4.1.9":"SPM2 SPECT Frame of Reference","1.2.840.10008.1.4.1.10":"SPM2 GRAY Frame of Reference","1.2.840.10008.1.4.1.11":"SPM2 WHITE Frame of Reference","1.2.840.10008.1.4.1.12":"SPM2 CSF Frame of Reference","1.2.840.10008.1.4.1.13":"SPM2 BRAINMASK Frame of Reference","1.2.840.10008.1.4.1.14":"SPM2 AVG305T1 Frame of Reference","1.2.840.10008.1.4.1.15":"SPM2 AVG152T1 Frame of Reference","1.2.840.10008.1.4.1.16":"SPM2 AVG152T2 Frame of Reference","1.2.840.10008.1.4.1.17":"SPM2 AVG152PD Frame of Reference","1.2.840.10008.1.4.1.18":"SPM2 SINGLESUBJT1 Frame of Reference","1.2.840.10008.1.4.2.1":"ICBM 452 T1 Frame of Reference","1.2.840.10008.1.4.2.2":"ICBM Single Subject MRI Frame of Reference","1.2.840.10008.1.5.1":"Hot Iron Color Palette SOP Instance","1.2.840.10008.1.5.2":"PET Color Palette SOP Instance","1.2.840.10008.1.5.3":"Hot Metal Blue Color Palette SOP Instance","1.2.840.10008.1.5.4":"PET 20 Step Color Palette SOP Instance","1.2.840.10008.1.9":"Basic Study Content Notification SOP Class (Retired)","1.2.840.10008.1.20.1":"Storage Commitment Push Model SOP Class","1.2.840.10008.1.20.1.1":"Storage Commitment Push Model SOP Instance","1.2.840.10008.1.20.2":"Storage Commitment Pull Model SOP Class (Retired)","1.2.840.10008.1.20.2.1":"Storage Commitment Pull Model SOP Instance (Retired)","1.2.840.10008.1.40":"Procedural Event Logging SOP Class","1.2.840.10008.1.40.1":"Procedural Event Logging SOP Instance","1.2.840.10008.1.42":"Substance Administration Logging SOP Class","1.2.840.10008.1.42.1":"Substance Administration Logging SOP Instance","1.2.840.10008.2.6.1":"DICOM UID Registry","1.2.840.10008.2.16.4":"DICOM Controlled Terminology","1.2.840.10008.3.1.1.1":"DICOM Application Context Name","1.2.840.10008.3.1.2.1.1":"Detached Patient Management SOP Class (Retired)","1.2.840.10008.3.1.2.1.4":"Detached Patient Management Meta SOP Class (Retired)","1.2.840.10008.3.1.2.2.1":"Detached Visit Management SOP Class (Retired)","1.2.840.10008.3.1.2.3.1":"Detached Study Management SOP Class (Retired)","1.2.840.10008.3.1.2.3.2":"Study Component Management SOP Class (Retired)","1.2.840.10008.3.1.2.3.3":"Modality Performed Procedure Step SOP Class","1.2.840.10008.3.1.2.3.4":"Modality Performed Procedure Step Retrieve SOP Class","1.2.840.10008.3.1.2.3.5":"Modality Performed Procedure Step Notification SOP Class","1.2.840.10008.3.1.2.5.1":"Detached Results Management SOP Class (Retired)","1.2.840.10008.3.1.2.5.4":"Detached Results Management Meta SOP Class (Retired)","1.2.840.10008.3.1.2.5.5":"Detached Study Management Meta SOP Class (Retired)","1.2.840.10008.3.1.2.6.1":"Detached Interpretation Management SOP Class (Retired)","1.2.840.10008.4.2":"Storage Service Class","1.2.840.10008.5.1.1.1":"Basic Film Session SOP Class","1.2.840.10008.5.1.1.2":"Basic Film Box SOP Class","1.2.840.10008.5.1.1.4":"Basic Grayscale Image Box SOP Class","1.2.840.10008.5.1.1.4.1":"Basic Color Image Box SOP Class","1.2.840.10008.5.1.1.4.2":"Referenced Image Box SOP Class (Retired)","1.2.840.10008.5.1.1.9":"Basic Grayscale Print Management Meta SOP Class","1.2.840.10008.5.1.1.9.1":"Referenced Grayscale Print Management Meta SOP Class (Retired)","1.2.840.10008.5.1.1.14":"Print Job SOP Class","1.2.840.10008.5.1.1.15":"Basic Annotation Box SOP Class","1.2.840.10008.5.1.1.16":"Printer SOP Class","1.2.840.10008.5.1.1.16.376":"Printer Configuration Retrieval SOP Class","1.2.840.10008.5.1.1.17":"Printer SOP Instance","1.2.840.10008.5.1.1.17.376":"Printer Configuration Retrieval SOP Instance","1.2.840.10008.5.1.1.18":"Basic Color Print Management Meta SOP Class","1.2.840.10008.5.1.1.18.1":"Referenced Color Print Management Meta SOP Class (Retired)","1.2.840.10008.5.1.1.22":"VOI LUT Box SOP Class","1.2.840.10008.5.1.1.23":"Presentation LUT SOP Class","1.2.840.10008.5.1.1.24":"Image Overlay Box SOP Class (Retired)","1.2.840.10008.5.1.1.24.1":"Basic Print Image Overlay Box SOP Class (Retired)","1.2.840.10008.5.1.1.25":"Print Queue SOP Instance (Retired)","1.2.840.10008.5.1.1.26":"Print Queue Management SOP Class (Retired)","1.2.840.10008.5.1.1.27":"Stored Print Storage SOP Class (Retired)","1.2.840.10008.5.1.1.29":"Hardcopy Grayscale Image Storage SOP Class (Retired)","1.2.840.10008.5.1.1.30":"Hardcopy Color Image Storage SOP Class (Retired)","1.2.840.10008.5.1.1.31":"Pull Print Request SOP Class (Retired)","1.2.840.10008.5.1.1.32":"Pull Stored Print Management Meta SOP Class (Retired)","1.2.840.10008.5.1.1.33":"Media Creation Management SOP Class UID","1.2.840.10008.5.1.1.40":"Display System SOP Class","1.2.840.10008.5.1.1.40.1":"Display System SOP Instance","1.2.840.10008.5.1.4.1.1.1":"Computed Radiography Image Storage","1.2.840.10008.5.1.4.1.1.1.1":"Digital X-Ray Image Storage - For Presentation","1.2.840.10008.5.1.4.1.1.1.1.1":"Digital X-Ray Image Storage - For Processing","1.2.840.10008.5.1.4.1.1.1.2":"Digital Mammography X-Ray Image Storage - For Presentation","1.2.840.10008.5.1.4.1.1.1.2.1":"Digital Mammography X-Ray Image Storage - For Processing","1.2.840.10008.5.1.4.1.1.1.3":"Digital Intra-Oral X-Ray Image Storage - For Presentation","1.2.840.10008.5.1.4.1.1.1.3.1":"Digital Intra-Oral X-Ray Image Storage - For Processing","1.2.840.10008.5.1.4.1.1.2":"CT Image Storage","1.2.840.10008.5.1.4.1.1.2.1":"Enhanced CT Image Storage","1.2.840.10008.5.1.4.1.1.2.2":"Legacy Converted Enhanced CT Image Storage","1.2.840.10008.5.1.4.1.1.3":"Ultrasound Multi-frame Image Storage (Retired)","1.2.840.10008.5.1.4.1.1.3.1":"Ultrasound Multi-frame Image Storage","1.2.840.10008.5.1.4.1.1.4":"MR Image Storage","1.2.840.10008.5.1.4.1.1.4.1":"Enhanced MR Image Storage","1.2.840.10008.5.1.4.1.1.4.2":"MR Spectroscopy Storage","1.2.840.10008.5.1.4.1.1.4.3":"Enhanced MR Color Image Storage","1.2.840.10008.5.1.4.1.1.4.4":"Legacy Converted Enhanced MR Image Storage","1.2.840.10008.5.1.4.1.1.5":"Nuclear Medicine Image Storage (Retired)","1.2.840.10008.5.1.4.1.1.6":"Ultrasound Image Storage (Retired)","1.2.840.10008.5.1.4.1.1.6.1":"Ultrasound Image Storage","1.2.840.10008.5.1.4.1.1.6.2":"Enhanced US Volume Storage","1.2.840.10008.5.1.4.1.1.7":"Secondary Capture Image Storage","1.2.840.10008.5.1.4.1.1.7.1":"Multi-frame Single Bit Secondary Capture Image Storage","1.2.840.10008.5.1.4.1.1.7.2":"Multi-frame Grayscale Byte Secondary Capture Image Storage","1.2.840.10008.5.1.4.1.1.7.3":"Multi-frame Grayscale Word Secondary Capture Image Storage","1.2.840.10008.5.1.4.1.1.7.4":"Multi-frame True Color Secondary Capture Image Storage","1.2.840.10008.5.1.4.1.1.8":"Standalone Overlay Storage (Retired)","1.2.840.10008.5.1.4.1.1.9":"Standalone Curve Storage (Retired)","1.2.840.10008.5.1.4.1.1.9.1":"Waveform Storage - Trial (Retired)","1.2.840.10008.5.1.4.1.1.9.1.1":"12-lead ECG Waveform Storage","1.2.840.10008.5.1.4.1.1.9.1.2":"General ECG Waveform Storage","1.2.840.10008.5.1.4.1.1.9.1.3":"Ambulatory ECG Waveform Storage","1.2.840.10008.5.1.4.1.1.9.2.1":"Hemodynamic Waveform Storage","1.2.840.10008.5.1.4.1.1.9.3.1":"Cardiac Electrophysiology Waveform Storage","1.2.840.10008.5.1.4.1.1.9.4.1":"Basic Voice Audio Waveform Storage","1.2.840.10008.5.1.4.1.1.9.4.2":"General Audio Waveform Storage","1.2.840.10008.5.1.4.1.1.9.5.1":"Arterial Pulse Waveform Storage","1.2.840.10008.5.1.4.1.1.9.6.1":"Respiratory Waveform Storage","1.2.840.10008.5.1.4.1.1.10":"Standalone Modality LUT Storage (Retired)","1.2.840.10008.5.1.4.1.1.11":"Standalone VOI LUT Storage (Retired)","1.2.840.10008.5.1.4.1.1.11.1":"Grayscale Softcopy Presentation State Storage SOP Class","1.2.840.10008.5.1.4.1.1.11.2":"Color Softcopy Presentation State Storage SOP Class","1.2.840.10008.5.1.4.1.1.11.3":"Pseudo-Color Softcopy Presentation State Storage SOP Class","1.2.840.10008.5.1.4.1.1.11.4":"Blending Softcopy Presentation State Storage SOP Class","1.2.840.10008.5.1.4.1.1.11.5":"XA/XRF Grayscale Softcopy Presentation State Storage","1.2.840.10008.5.1.4.1.1.12.1":"X-Ray Angiographic Image Storage","1.2.840.10008.5.1.4.1.1.12.1.1":"Enhanced XA Image Storage","1.2.840.10008.5.1.4.1.1.12.2":"X-Ray Radiofluoroscopic Image Storage","1.2.840.10008.5.1.4.1.1.12.2.1":"Enhanced XRF Image Storage","1.2.840.10008.5.1.4.1.1.12.3":"X-Ray Angiographic Bi-Plane Image Storage (Retired)","1.2.840.10008.5.1.4.1.1.13.1.1":"X-Ray 3D Angiographic Image Storage","1.2.840.10008.5.1.4.1.1.13.1.2":"X-Ray 3D Craniofacial Image Storage","1.2.840.10008.5.1.4.1.1.13.1.3":"Breast Tomosynthesis Image Storage","1.2.840.10008.5.1.4.1.1.13.1.4":"Breast Projection X-Ray Image Storage - For Presentation","1.2.840.10008.5.1.4.1.1.13.1.5":"Breast Projection X-Ray Image Storage - For Processing","1.2.840.10008.5.1.4.1.1.14.1":"Intravascular Optical Coherence Tomography Image Storage - For Presentation","1.2.840.10008.5.1.4.1.1.14.2":"Intravascular Optical Coherence Tomography Image Storage - For Processing","1.2.840.10008.5.1.4.1.1.20":"Nuclear Medicine Image Storage","1.2.840.10008.5.1.4.1.1.30":"Parametric Map Storage","1.2.840.10008.5.1.4.1.1.66":"Raw Data Storage","1.2.840.10008.5.1.4.1.1.66.1":"Spatial Registration Storage","1.2.840.10008.5.1.4.1.1.66.2":"Spatial Fiducials Storage","1.2.840.10008.5.1.4.1.1.66.3":"Deformable Spatial Registration Storage","1.2.840.10008.5.1.4.1.1.66.4":"Segmentation Storage","1.2.840.10008.5.1.4.1.1.66.5":"Surface Segmentation Storage","1.2.840.10008.5.1.4.1.1.67":"Real World Value Mapping Storage","1.2.840.10008.5.1.4.1.1.68.1":"Surface Scan Mesh Storage","1.2.840.10008.5.1.4.1.1.68.2":"Surface Scan Point Cloud Storage","1.2.840.10008.5.1.4.1.1.77.1":"VL Image Storage - Trial (Retired)","1.2.840.10008.5.1.4.1.1.77.2":"VL Multi-frame Image Storage - Trial (Retired)","1.2.840.10008.5.1.4.1.1.77.1.1":"VL Endoscopic Image Storage","1.2.840.10008.5.1.4.1.1.77.1.1.1":"Video Endoscopic Image Storage","1.2.840.10008.5.1.4.1.1.77.1.2":"VL Microscopic Image Storage","1.2.840.10008.5.1.4.1.1.77.1.2.1":"Video Microscopic Image Storage","1.2.840.10008.5.1.4.1.1.77.1.3":"VL Slide-Coordinates Microscopic Image Storage","1.2.840.10008.5.1.4.1.1.77.1.4":"VL Photographic Image Storage","1.2.840.10008.5.1.4.1.1.77.1.4.1":"Video Photographic Image Storage","1.2.840.10008.5.1.4.1.1.77.1.5.1":"Ophthalmic Photography 8 Bit Image Storage","1.2.840.10008.5.1.4.1.1.77.1.5.2":"Ophthalmic Photography 16 Bit Image Storage","1.2.840.10008.5.1.4.1.1.77.1.5.3":"Stereometric Relationship Storage","1.2.840.10008.5.1.4.1.1.77.1.5.4":"Ophthalmic Tomography Image Storage","1.2.840.10008.5.1.4.1.1.77.1.5.5":"Wide Field Ophthalmic Photography Stereographic Projection Image Storage","1.2.840.10008.5.1.4.1.1.77.1.5.6":"Wide Field Ophthalmic Photography 3D Coordinates Image Storage","1.2.840.10008.5.1.4.1.1.77.1.6":"VL Whole Slide Microscopy Image Storage","1.2.840.10008.5.1.4.1.1.78.1":"Lensometry Measurements Storage","1.2.840.10008.5.1.4.1.1.78.2":"Autorefraction Measurements Storage","1.2.840.10008.5.1.4.1.1.78.3":"Keratometry Measurements Storage","1.2.840.10008.5.1.4.1.1.78.4":"Subjective Refraction Measurements Storage","1.2.840.10008.5.1.4.1.1.78.5":"Visual Acuity Measurements Storage","1.2.840.10008.5.1.4.1.1.78.6":"Spectacle Prescription Report Storage","1.2.840.10008.5.1.4.1.1.78.7":"Ophthalmic Axial Measurements Storage","1.2.840.10008.5.1.4.1.1.78.8":"Intraocular Lens Calculations Storage","1.2.840.10008.5.1.4.1.1.79.1":"Macular Grid Thickness and Volume Report Storage","1.2.840.10008.5.1.4.1.1.80.1":"Ophthalmic Visual Field Static Perimetry Measurements Storage","1.2.840.10008.5.1.4.1.1.81.1":"Ophthalmic Thickness Map Storage","1.2.840.10008.5.1.4.1.1.82.1":"Corneal Topography Map Storage","1.2.840.10008.5.1.4.1.1.88.1":"Text SR Storage - Trial (Retired)","1.2.840.10008.5.1.4.1.1.88.2":"Audio SR Storage - Trial (Retired)","1.2.840.10008.5.1.4.1.1.88.3":"Detail SR Storage - Trial (Retired)","1.2.840.10008.5.1.4.1.1.88.4":"Comprehensive SR Storage - Trial (Retired)","1.2.840.10008.5.1.4.1.1.88.11":"Basic Text SR Storage","1.2.840.10008.5.1.4.1.1.88.22":"Enhanced SR Storage","1.2.840.10008.5.1.4.1.1.88.33":"Comprehensive SR Storage","1.2.840.10008.5.1.4.1.1.88.34":"Comprehensive 3D SR Storage","1.2.840.10008.5.1.4.1.1.88.35":"Extensible SR Storage","1.2.840.10008.5.1.4.1.1.88.40":"Procedure Log Storage","1.2.840.10008.5.1.4.1.1.88.50":"Mammography CAD SR Storage","1.2.840.10008.5.1.4.1.1.88.59":"Key Object Selection Document Storage","1.2.840.10008.5.1.4.1.1.88.65":"Chest CAD SR Storage","1.2.840.10008.5.1.4.1.1.88.67":"X-Ray Radiation Dose SR Storage","1.2.840.10008.5.1.4.1.1.88.68":"Radiopharmaceutical Radiation Dose SR Storage","1.2.840.10008.5.1.4.1.1.88.69":"Colon CAD SR Storage","1.2.840.10008.5.1.4.1.1.88.70":"Implantation Plan SR Storage","1.2.840.10008.5.1.4.1.1.104.1":"Encapsulated PDF Storage","1.2.840.10008.5.1.4.1.1.104.2":"Encapsulated CDA Storage","1.2.840.10008.5.1.4.1.1.128":"Positron Emission Tomography Image Storage","1.2.840.10008.5.1.4.1.1.128.1":"Legacy Converted Enhanced PET Image Storage","1.2.840.10008.5.1.4.1.1.129":"Standalone PET Curve Storage (Retired)","1.2.840.10008.5.1.4.1.1.130":"Enhanced PET Image Storage","1.2.840.10008.5.1.4.1.1.131":"Basic Structured Display Storage","1.2.840.10008.5.1.4.1.1.481.1":"RT Image Storage","1.2.840.10008.5.1.4.1.1.481.2":"RT Dose Storage","1.2.840.10008.5.1.4.1.1.481.3":"RT Structure Set Storage","1.2.840.10008.5.1.4.1.1.481.4":"RT Beams Treatment Record Storage","1.2.840.10008.5.1.4.1.1.481.5":"RT Plan Storage","1.2.840.10008.5.1.4.1.1.481.6":"RT Brachy Treatment Record Storage","1.2.840.10008.5.1.4.1.1.481.7":"RT Treatment Summary Record Storage","1.2.840.10008.5.1.4.1.1.481.8":"RT Ion Plan Storage","1.2.840.10008.5.1.4.1.1.481.9":"RT Ion Beams Treatment Record Storage","1.2.840.10008.5.1.4.1.1.501.1":"DICOS CT Image Storage","1.2.840.10008.5.1.4.1.1.501.2.1":"DICOS Digital X-Ray Image Storage - For Presentation","1.2.840.10008.5.1.4.1.1.501.2.2":"DICOS Digital X-Ray Image Storage - For Processing","1.2.840.10008.5.1.4.1.1.501.3":"DICOS Threat Detection Report Storage","1.2.840.10008.5.1.4.1.1.501.4":"DICOS 2D AIT Storage","1.2.840.10008.5.1.4.1.1.501.5":"DICOS 3D AIT Storage","1.2.840.10008.5.1.4.1.1.501.6":"DICOS Quadrupole Resonance (QR) Storage","1.2.840.10008.5.1.4.1.1.601.1":"Eddy Current Image Storage","1.2.840.10008.5.1.4.1.1.601.2":"Eddy Current Multi-frame Image Storage","1.2.840.10008.5.1.4.1.2.1.1":"Patient Root Query/Retrieve Information Model - FIND","1.2.840.10008.5.1.4.1.2.1.2":"Patient Root Query/Retrieve Information Model - MOVE","1.2.840.10008.5.1.4.1.2.1.3":"Patient Root Query/Retrieve Information Model - GET","1.2.840.10008.5.1.4.1.2.2.1":"Study Root Query/Retrieve Information Model - FIND","1.2.840.10008.5.1.4.1.2.2.2":"Study Root Query/Retrieve Information Model - MOVE","1.2.840.10008.5.1.4.1.2.2.3":"Study Root Query/Retrieve Information Model - GET","1.2.840.10008.5.1.4.1.2.3.1":"Patient/Study Only Query/Retrieve Information Model - FIND (Retired)","1.2.840.10008.5.1.4.1.2.3.2":"Patient/Study Only Query/Retrieve Information Model - MOVE (Retired)","1.2.840.10008.5.1.4.1.2.3.3":"Patient/Study Only Query/Retrieve Information Model - GET (Retired)","1.2.840.10008.5.1.4.1.2.4.2":"Composite Instance Root Retrieve - MOVE","1.2.840.10008.5.1.4.1.2.4.3":"Composite Instance Root Retrieve - GET","1.2.840.10008.5.1.4.1.2.5.3":"Composite Instance Retrieve Without Bulk Data - GET","1.2.840.10008.5.1.4.31":"Modality Worklist Information Model - FIND","1.2.840.10008.5.1.4.32":"General Purpose Worklist Management Meta SOP Class (Retired)","1.2.840.10008.5.1.4.32.1":"General Purpose Worklist Information Model - FIND (Retired)","1.2.840.10008.5.1.4.32.2":"General Purpose Scheduled Procedure Step SOP Class (Retired)","1.2.840.10008.5.1.4.32.3":"General Purpose Performed Procedure Step SOP Class (Retired)","1.2.840.10008.5.1.4.33":"Instance Availability Notification SOP Class","1.2.840.10008.5.1.4.34.1":"RT Beams Delivery Instruction Storage - Trial (Retired)","1.2.840.10008.5.1.4.34.2":"RT Conventional Machine Verification - Trial (Retired)","1.2.840.10008.5.1.4.34.3":"RT Ion Machine Verification - Trial (Retired)","1.2.840.10008.5.1.4.34.4":"Unified Worklist and Procedure Step Service Class - Trial (Retired)","1.2.840.10008.5.1.4.34.4.1":"Unified Procedure Step - Push SOP Class - Trial (Retired)","1.2.840.10008.5.1.4.34.4.2":"Unified Procedure Step - Watch SOP Class - Trial (Retired)","1.2.840.10008.5.1.4.34.4.3":"Unified Procedure Step - Pull SOP Class - Trial (Retired)","1.2.840.10008.5.1.4.34.4.4":"Unified Procedure Step - Event SOP Class - Trial (Retired)","1.2.840.10008.5.1.4.34.5":"UPS Global Subscription SOP Instance","1.2.840.10008.5.1.4.34.5.1":"UPS Filtered Global Subscription SOP Instance","1.2.840.10008.5.1.4.34.6":"Unified Worklist and Procedure Step Service Class","1.2.840.10008.5.1.4.34.6.1":"Unified Procedure Step - Push SOP Class","1.2.840.10008.5.1.4.34.6.2":"Unified Procedure Step - Watch SOP Class","1.2.840.10008.5.1.4.34.6.3":"Unified Procedure Step - Pull SOP Class","1.2.840.10008.5.1.4.34.6.4":"Unified Procedure Step - Event SOP Class","1.2.840.10008.5.1.4.34.7":"RT Beams Delivery Instruction Storage","1.2.840.10008.5.1.4.34.8":"RT Conventional Machine Verification","1.2.840.10008.5.1.4.34.9":"RT Ion Machine Verification","1.2.840.10008.5.1.4.37.1":"General Relevant Patient Information Query","1.2.840.10008.5.1.4.37.2":"Breast Imaging Relevant Patient Information Query","1.2.840.10008.5.1.4.37.3":"Cardiac Relevant Patient Information Query","1.2.840.10008.5.1.4.38.1":"Hanging Protocol Storage","1.2.840.10008.5.1.4.38.2":"Hanging Protocol Information Model - FIND","1.2.840.10008.5.1.4.38.3":"Hanging Protocol Information Model - MOVE","1.2.840.10008.5.1.4.38.4":"Hanging Protocol Information Model - GET","1.2.840.10008.5.1.4.39.1":"Color Palette Storage","1.2.840.10008.5.1.4.39.2":"Color Palette Information Model - FIND","1.2.840.10008.5.1.4.39.3":"Color Palette Information Model - MOVE","1.2.840.10008.5.1.4.39.4":"Color Palette Information Model - GET","1.2.840.10008.5.1.4.41":"Product Characteristics Query SOP Class","1.2.840.10008.5.1.4.42":"Substance Approval Query SOP Class","1.2.840.10008.5.1.4.43.1":"Generic Implant Template Storage","1.2.840.10008.5.1.4.43.2":"Generic Implant Template Information Model - FIND","1.2.840.10008.5.1.4.43.3":"Generic Implant Template Information Model - MOVE","1.2.840.10008.5.1.4.43.4":"Generic Implant Template Information Model - GET","1.2.840.10008.5.1.4.44.1":"Implant Assembly Template Storage","1.2.840.10008.5.1.4.44.2":"Implant Assembly Template Information Model - FIND","1.2.840.10008.5.1.4.44.3":"Implant Assembly Template Information Model - MOVE","1.2.840.10008.5.1.4.44.4":"Implant Assembly Template Information Model - GET","1.2.840.10008.5.1.4.45.1":"Implant Template Group Storage","1.2.840.10008.5.1.4.45.2":"Implant Template Group Information Model - FIND","1.2.840.10008.5.1.4.45.3":"Implant Template Group Information Model - MOVE","1.2.840.10008.5.1.4.45.4":"Implant Template Group Information Model - GET","1.2.840.10008.7.1.1":"Native DICOM Model","1.2.840.10008.7.1.2":"Abstract Multi-Dimensional Image Model","1.2.840.10008.8.1.1":"DICOM Content Mapping Resource","1.2.840.10008.15.0.3.1":"dicomDeviceName","1.2.840.10008.15.0.3.2":"dicomDescription","1.2.840.10008.15.0.3.3":"dicomManufacturer","1.2.840.10008.15.0.3.4":"dicomManufacturerModelName","1.2.840.10008.15.0.3.5":"dicomSoftwareVersion","1.2.840.10008.15.0.3.6":"dicomVendorData","1.2.840.10008.15.0.3.7":"dicomAETitle","1.2.840.10008.15.0.3.8":"dicomNetworkConnectionReference","1.2.840.10008.15.0.3.9":"dicomApplicationCluster","1.2.840.10008.15.0.3.10":"dicomAssociationInitiator","1.2.840.10008.15.0.3.11":"dicomAssociationAcceptor","1.2.840.10008.15.0.3.12":"dicomHostname","1.2.840.10008.15.0.3.13":"dicomPort","1.2.840.10008.15.0.3.14":"dicomSOPClass","1.2.840.10008.15.0.3.15":"dicomTransferRole","1.2.840.10008.15.0.3.16":"dicomTransferSyntax","1.2.840.10008.15.0.3.17":"dicomPrimaryDeviceType","1.2.840.10008.15.0.3.18":"dicomRelatedDeviceReference","1.2.840.10008.15.0.3.19":"dicomPreferredCalledAETitle","1.2.840.10008.15.0.3.20":"dicomTLSCyphersuite","1.2.840.10008.15.0.3.21":"dicomAuthorizedNodeCertificateReference","1.2.840.10008.15.0.3.22":"dicomThisNodeCertificateReference","1.2.840.10008.15.0.3.23":"dicomInstalled","1.2.840.10008.15.0.3.24":"dicomStationName","1.2.840.10008.15.0.3.25":"dicomDeviceSerialNumber","1.2.840.10008.15.0.3.26":"dicomInstitutionName","1.2.840.10008.15.0.3.27":"dicomInstitutionAddress","1.2.840.10008.15.0.3.28":"dicomInstitutionDepartmentName","1.2.840.10008.15.0.3.29":"dicomIssuerOfPatientID","1.2.840.10008.15.0.3.30":"dicomPreferredCallingAETitle","1.2.840.10008.15.0.3.31":"dicomSupportedCharacterSet","1.2.840.10008.15.0.4.1":"dicomConfigurationRoot","1.2.840.10008.15.0.4.2":"dicomDevicesRoot","1.2.840.10008.15.0.4.3":"dicomUniqueAETitlesRegistryRoot","1.2.840.10008.15.0.4.4":"dicomDevice","1.2.840.10008.15.0.4.5":"dicomNetworkAE","1.2.840.10008.15.0.4.6":"dicomNetworkConnection","1.2.840.10008.15.0.4.7":"dicomUniqueAETitle","1.2.840.10008.15.0.4.8":"dicomTransferCapability","1.2.840.10008.15.1.1":"Universal Coordinated Time"},ze=a(258),je=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){var e;Object(l.a)(this,a);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).hide=function(){e.props.onClose()},e.cancel=function(){window.stop(),e.hide()},e}return Object(c.a)(a,[{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement(v.a,{open:!0,onClose:this.hide,"aria-labelledby":"alert-dialog-title"},i.a.createElement(S.a,{id:"alert-dialog-title"},"Downloading file ..."),i.a.createElement(b.a,null,i.a.createElement(ze.a,{variant:"determinate",value:this.props.progress,color:"secondary"})),i.a.createElement(E.a,null,i.a.createElement(h.a,{onClick:this.cancel},"Cancel"))))}}]),a}(n.PureComponent),Ne=a(6),Be=a.n(Ne),Ue=a(205),Ge=a(5),We=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){var e;Object(l.a)(this,a);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).firstframe=function(){e.props.runCinePlayer("firstframe")},e.previousframe=function(){e.props.runCinePlayer("previousframe")},e.play=function(){e.props.runCinePlayer("play")},e.pause=function(){e.props.runCinePlayer("pause")},e.nextframe=function(){e.props.runCinePlayer("nextframe")},e.lastframe=function(){e.props.runCinePlayer("lastframe")},e}return Object(c.a)(a,[{key:"render",value:function(){var e=null;return e=this.props.inPlay?i.a.createElement(Ue.a,{onClick:this.pause},i.a.createElement(Be.a,{path:Ge.M,size:"1.5rem",color:"#FFFFFF"})):i.a.createElement(Ue.a,{onClick:this.play},i.a.createElement(Be.a,{path:Ge.N,size:"1.5rem",color:"#FFFFFF"})),i.a.createElement("div",{style:{width:240,margin:"0 auto"}},i.a.createElement(Ue.a,{onClick:this.firstframe},i.a.createElement(Be.a,{path:Ge.R,size:"1.5rem",color:"#FFFFFF"})),i.a.createElement(Ue.a,{onClick:this.previousframe},i.a.createElement(Be.a,{path:Ge.U,size:"1.5rem",color:"#FFFFFF"})),e,i.a.createElement(Ue.a,{onClick:this.nextframe},i.a.createElement(Be.a,{path:Ge.T,size:"1.5rem",color:"#FFFFFF"})),i.a.createElement(Ue.a,{onClick:this.lastframe},i.a.createElement(Be.a,{path:Ge.S,size:"1.5rem",color:"#FFFFFF"})))}}]),a}(n.PureComponent),Ze=new V.a("udvDB");Ze.version(1).stores({measurement:"++id, sopinstanceuid, tool"}),Ze.open();var He=Ze,_e=function(){function e(){Object(l.a)(this,e);for(var t=arguments.length,a=new Array(t),n=0;n<t;n++)a[n]=arguments[n];this.rows=a}return Object(c.a)(e,[{key:"get",value:function(e,t){return this.rows[e][t]}},{key:"columns",value:function(){var e=this;return this.rows[0].map((function(t,a){return e.rows.map((function(e){return e[a]}))}))}},{key:"componentWiseOperation",value:function(t,a){var n=this,i=a.rows.map((function(e,a){return e.map((function(e,i){return t(n.rows[a][i],e)}))}));return Object(N.a)(e,Object(s.a)(i))}},{key:"add",value:function(e){return this.componentWiseOperation((function(e,t){return e+t}),e)}},{key:"subtract",value:function(e){return this.componentWiseOperation((function(e,t){return e-t}),e)}},{key:"scaleBy",value:function(t){var a=this.rows.map((function(e){return e.map((function(e){return e*t}))}));return Object(N.a)(e,Object(s.a)(a))}},{key:"multiply",value:function(t){if(this.rows[0].length!==t.rows.length)throw new Error("The number of columns of this matrix is not equal to the number of rows of the given matrix.");var a=t.columns(),n=this.rows.map((function(e){return a.map((function(t){return U(e.map((function(e,a){return e*t[a]})))}))}));return Object(N.a)(e,Object(s.a)(n))}},{key:"transpose",value:function(){return Object(N.a)(e,Object(s.a)(this.columns()))}},{key:"determinant",value:function(){var t=this;if(this.rows.length!==this.rows[0].length)throw new Error("Only matrices with the same number of rows and columns are supported.");if(2===this.rows.length)return this.rows[0][0]*this.rows[1][1]-this.rows[0][1]*this.rows[1][0];var a=this.rows[0].map((function(a,n){var i=t.rows.slice(1).map((function(e){return[].concat(Object(s.a)(e.slice(0,n)),Object(s.a)(e.slice(n+1)))})),r=a*Object(N.a)(e,Object(s.a)(i)).determinant();return n%2===0?r:-r}));return U(a)}},{key:"toDimension",value:function(t){var a=this,n=new Array(t).fill(0),i=n.map((function(e,t){return n.map((function(e,n){return a.rows[t]&&void 0!==a.rows[t][n]?a.rows[t][n]:t===n?1:0}))}));return Object(N.a)(e,Object(s.a)(i))}},{key:"components",value:function(){return this.rows.reduce((function(e,t){return[].concat(Object(s.a)(e),Object(s.a)(t))}),[])}},{key:"map",value:function(t){return Object(N.a)(e,Object(s.a)(this.rows.map((function(e,a){return e.map((function(e,n){return t(e,a,n)}))}))))}},{key:"minor",value:function(t,a){var n=G(this.rows,t).map((function(e){return G(e,a)}));return Object(N.a)(e,Object(s.a)(n)).determinant()}},{key:"cofactor",value:function(e,t){return Math.pow(-1,e+t)*this.minor(e,t)}},{key:"adjugate",value:function(){var e=this;return this.map((function(t,a,n){return e.cofactor(a,n)})).transpose()}},{key:"inverse",value:function(){var e=this.determinant();if(0===e)throw new Error("Determinant can't be  zero.");return this.adjugate().scaleBy(1/e)}}]),e}(),Xe=function(){function e(){Object(l.a)(this,e);for(var t=arguments.length,a=new Array(t),n=0;n<t;n++)a[n]=arguments[n];this.components=a}return Object(c.a)(e,[{key:"length",value:function(){return Math.hypot.apply(Math,Object(s.a)(this.components))}},{key:"abs",value:function(){return Object(N.a)(e,Object(s.a)(this.components.map((function(e){return Math.abs(e)}))))}},{key:"toVector",value:function(){return Object(N.a)(W,Object(s.a)(this.components))}},{key:"toMatrix",value:function(){return Object(N.a)(_e,Object(s.a)(this.components.map((function(e){return[e]}))))}},{key:"distance",value:function(e){var t=this;return Math.sqrt(this.components.reduce((function(a,n,i){return a+Math.pow(t.components[i]-e.components[i],2)}),0))}},{key:"add",value:function(t){var a=this,n=t.components;return Object(N.a)(e,Object(s.a)(n.map((function(e,t){return a.components[t]+e}))))}},{key:"sub",value:function(e){var t=this,a=e.components;return Object(N.a)(W,Object(s.a)(a.map((function(e,a){return t.components[a]-e}))))}},{key:"x",get:function(){return this.components[0]},set:function(e){this.components[0]=e}},{key:"y",get:function(){return this.components[1]},set:function(e){this.components[1]=e}},{key:"z",get:function(){return this.components[2]},set:function(e){this.components[2]=e}}],[{key:"zero",get:function(){return new e(0,0,0)}}]),e}(),Je=function(){function e(t,a){Object(l.a)(this,e),this.p1=t,this.p2=a,this.m=(a.y-t.y)/(a.x-t.x),this.c=t.y-this.m*t.x}return Object(c.a)(e,[{key:"length",value:function(){return this.p1.distance(this.p2)}},{key:"distance",value:function(e){var t=Math.abs(e.c-this.c)/Math.sqrt(1+Math.pow(this.m,2));return isNaN(t)?0:t}}]),e}(),Ye=function e(t){Object(l.a)(this,e),this.image=t;var a=this.image.data.string("x00200032").split("\\").map((function(e){return parseFloat(e)})),n=this.image.data.string("x00200037").split("\\").map((function(e){return parseFloat(e)})),i=this.image.data.string("x00280030").split("\\").map((function(e){return parseFloat(e)}));this.spacingY=i[0],this.spacingX=i[1],this.rows=t.rows,this.cols=t.columns,this.lengthX=this.cols*this.spacingY,this.lengthY=this.rows*this.spacingX,this.rowDir=new W(n[0],n[1],n[2]),this.colDir=new W(n[3],n[4],n[5]),this.nrmDir=this.rowDir.crossProduct(this.colDir),this.topLeft=new Xe(a[0],a[1],a[2]),this.topRight=this.topLeft.add(this.rowDir.mul(this.spacingX*this.cols)),this.bottomLeft=this.topLeft.add(this.colDir.mul(this.spacingY*this.rows)),this.bottomRight=this.bottomLeft.add(this.topRight.sub(this.topLeft)),this.transformImageToRcs=new _e([this.rowDir.x*this.spacingX,this.colDir.x*this.spacingY,this.nrmDir.x,this.topLeft.x],[this.rowDir.y*this.spacingX,this.colDir.y*this.spacingY,this.nrmDir.y,this.topLeft.y],[this.rowDir.z*this.spacingX,this.colDir.z*this.spacingY,this.nrmDir.z,this.topLeft.z],[0,0,0,1]),this.transformRcsToImage=this.transformImageToRcs.inverse();var r=this.nrmDir.round().abs();1===r.x?this.orientation="sagittal":1===r.y?this.orientation="coronal":1===r.z&&(this.orientation="axial")},qe=Object(Re.import)("util/scrollToIndex");Re.external.cornerstone=Me,Re.external.cornerstoneMath=Pe,Le.external.cornerstone=Me,Te.external.cornerstone=Me,ke.external.cornerstone=Me,ke.external.dicomParser=M,Re.external.Hammer=Oe.a,Re.init({globalToolSyncEnabled:!0});var Qe=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={visibleOpenUrlDlg:!1,progress:null,visibleCinePlayer:!1,errorOnOpenImage:null,errorOnCors:!1,frame:1,inPlay:!1,viewport:null},n.handlerMouseScroll=function(e){n.shouldScroll&&(e.deltaY>0?n.props.listOpenFilesNextFrame():e.deltaY<0&&n.props.listOpenFilesPreviousFrame())},n.onOpenUrl=function(e){var t=e.detail;n.setState({progress:t.percentComplete})},n.showOpenUrlDlg=function(e){n.setState({visibleOpenUrlDlg:!0},(function(){Me.events.addEventListener("cornerstoneimageloadprogress",n.onOpenUrl),n.loadImage(void 0,e)}))},n.hideOpenUrlDlg=function(){n.setState({visibleOpenUrlDlg:!1,progress:null})},n.measurementSave=function(e){n.measurements.push(e)},n.measurementClear=function(){n.measurements.splice(0,n.measurements.length)},n.measurementRemove=function(e){n.measurements.splice(e,1)},n.getTransferSyntax=function(){var e=n.image.data.string("x00020010");return e+" ["+Ve[e]+"]"},n.getSopClass=function(){var e=n.image.data.string("x00080016");return e+" ["+Ve[e]+"]"},n.getSopInstanceUID=function(){return n.image.data.string("x00080018")},n.getPixelRepresentation=function(){var e=n.image.data.uint16("x00280103");if(void 0!==e)return e+(0===e?" (unsigned)":" (signed)")},n.getPlanarConfiguration=function(){var e=n.image.data.uint16("x00280006");if(void 0!==e)return e+(0===e?" (pixel)":" (plane)")},n.getDicomViewerElement=function(){return document.getElementsByClassName("cornerstone-enabled-image")},n.onImageLoaded=function(e){n.props.onLoadedImage()},n.onImageRendered=function(e){var t,a=Me.getViewport(e.target);if(n.zoom=Math.round(100*a.scale.toFixed(2)),document.getElementById("mrtopleft-".concat(n.props.index)).textContent=n.mprIsOrthogonalView()?"".concat(void 0===(t=n.mprPlane)?"":t.charAt(0).toUpperCase()+t.slice(1)):"".concat(n.PatientsName),document.getElementById("mrtopright-".concat(n.props.index)).textContent="".concat(a.displayedArea.brhc.x,"x").concat(a.displayedArea.brhc.y),document.getElementById("mrbottomleft-".concat(n.props.index)).textContent="WW/WC: ".concat(Math.round(a.voi.windowWidth),"/").concat(Math.round(a.voi.windowCenter)),document.getElementById("mrbottomright-".concat(n.props.index)).textContent="Zoom: ".concat(n.zoom,"%"),document.getElementById("mrtopcenter-".concat(n.props.index)).textContent="",document.getElementById("mrbottomcenter-".concat(n.props.index)).textContent="",document.getElementById("mrleftcenter-".concat(n.props.index)).textContent="",document.getElementById("mrrightcenter-".concat(n.props.index)).textContent="","sagittal"===n.mprPlane?(document.getElementById("mrtopcenter-".concat(n.props.index)).textContent="S",document.getElementById("mrbottomcenter-".concat(n.props.index)).textContent="I",document.getElementById("mrleftcenter-".concat(n.props.index)).textContent="A",document.getElementById("mrrightcenter-".concat(n.props.index)).textContent="P"):"axial"===n.mprPlane?(document.getElementById("mrtopcenter-".concat(n.props.index)).textContent="A",document.getElementById("mrbottomcenter-".concat(n.props.index)).textContent="P",document.getElementById("mrleftcenter-".concat(n.props.index)).textContent="R",document.getElementById("mrrightcenter-".concat(n.props.index)).textContent="L"):"coronal"===n.mprPlane&&(document.getElementById("mrtopcenter-".concat(n.props.index)).textContent="S",document.getElementById("mrbottomcenter-".concat(n.props.index)).textContent="I",document.getElementById("mrleftcenter-".concat(n.props.index)).textContent="R",document.getElementById("mrrightcenter-".concat(n.props.index)).textContent="L"),n.referenceLines.isScoutDraw&&(n.referenceLines.isScoutDraw=!1,n.referenceLinesDraw()),n.mpr.isSliceLocation&&(n.mpr.isSliceLocation=!1,n.mprSliceLocationDraw()),n.isDicom&&n.state.visibleCinePlayer&&n.numberOfFrames>1&&(document.getElementById("frameLabel-".concat(n.props.index)).textContent="".concat(n.state.frame," / ").concat(n.numberOfFrames),n.state.inPlay)){var i=n.state.frame===n.numberOfFrames?1:n.state.frame+1;n.setState({frame:i})}n.props.onRenderedImage(n.props.index)},n.onMeasurementModified=function(e){},n.onMeasurementAdded=function(e){if("Angle"===n.props.tool){var t={tool:n.props.tool,note:"",data:e.detail.measurementData};n.measurementSave(t),n.props.setActiveMeasurements(n.measurements)}},n.onMeasurementCompleted=function(e){var t={tool:n.props.tool,note:"",data:e.detail.measurementData};"FreehandRoi"===n.props.tool?setTimeout((function(){n.measurementSave(t),n.props.setActiveMeasurements(n.measurements)}),500):(n.measurementSave(t),n.props.setActiveMeasurements(n.measurements))},n.onErrorOpenImageClose=function(){n.setState({errorOnOpenImage:null})},n.onErrorCorsClose=function(){n.setState({errorOnCors:!1})},n.updateImage=function(){var e=n.dicomImage;Me.updateImage(e)},n.displayImageFromFiles=function(e){var t=null===n.files?n.props.files:n.files,a=t[e].image,i=t[e].imageId;n.filename=t[e].name,n.sliceIndex=e;var r=n.dicomImage;r.addEventListener("cornerstonenewimage",n.onNewImage),r.addEventListener("cornerstoneimagerendered",n.onImageRendered),r.addEventListener("cornerstonetoolsmeasurementadded",n.onMeasurementAdded),r.addEventListener("cornerstonetoolsmeasurementmodified",n.onMeasurementModified),r.addEventListener("cornerstonetoolsmeasurementcompleted",n.onMeasurementCompleted),Me.enable(r),n.image=a,n.isDicom=!0,n.PatientsName=a.data.string("x00100010"),n.sopInstanceUid=n.getSopInstanceUID();var o={currentImageIdIndex:0,imageIds:""};if(n.numberOfFrames=a.data.intString("x00280008"),n.numberOfFrames>0){for(var s=[],l=0;l<n.numberOfFrames;++l)s.push(i+"?frame="+l);o.imageIds=s}Me.displayImage(r,a),n.mprPlanePosition(),n.enableTool(),n.numberOfFrames>1&&(Re.addStackStateManager(r,["stack","playClip"]),Re.addToolState(r,"stack",o),n.setState({frame:1})),He.measurement.where("sopinstanceuid").equals(n.sopInstanceUid).each((function(e){n.measurementSave(e),Re.addToolState(r,e.tool,e.data),n.runTool(e.tool),Me.updateImage(r),Re.setToolEnabled(e.tool)})).then((function(){n.props.setActiveMeasurements(n.measurements),n.props.setActiveDcm(Object(m.a)(n)),n.props.setIsOpenStore({index:n.props.index,value:!0})}))},n.loadImageFromCanvas=function(e){var t=n.dicomImage;t.addEventListener("cornerstonenewimage",n.onNewImage),t.addEventListener("cornerstoneimagerendered",n.onImageRendered),t.addEventListener("cornerstonetoolsmeasurementadded",n.onMeasurementAdded),t.addEventListener("cornerstonetoolsmeasurementmodified",n.onMeasurementModified),t.addEventListener("cornerstonetoolsmeasurementcompleted",n.onMeasurementCompleted),Me.enable(t);var a=Le.fileManager.addCanvas(e);Me.loadImage(a).then((function(e){n.image=e,n.isDicom=!1,Me.displayImage(t,e),n.enableTool(),n.props.setIsOpenStore({index:n.props.index,value:!0})}),(function(e){console.log("error",e),n.setState({errorOnOpenImage:"This is not a valid canvas."})}))},n.loadImageFromCustomObject=function(e,t,a){var i=n.dicomImage;i.addEventListener("cornerstonenewimage",n.onNewImage),i.addEventListener("cornerstoneimagerendered",n.onImageRendered),i.addEventListener("cornerstonetoolsmeasurementadded",n.onMeasurementAdded),i.addEventListener("cornerstonetoolsmeasurementmodified",n.onMeasurementModified),i.addEventListener("cornerstonetoolsmeasurementcompleted",n.onMeasurementCompleted),Me.enable(i);var r={rows:t,columns:e,pixelData:a,image:n.originImage},o=Le.fileManager.addCustom(r);Me.loadImage(o).then((function(e){n.image=e,n.isDicom=!0,Me.displayImage(i,e),n.props.setIsOpenStore({index:n.props.index,value:!0})}),(function(e){console.log("error",e),n.setState({errorOnOpenImage:"This is not a valid canvas."})}))},n.loadImage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(void 0!==e||void 0!==t||void 0!==a){void 0!==a?n.fsItem=a:void 0!==e?n.localfile=e:n.localurl=t;var i=n.dicomImage;i.addEventListener("cornerstonenewimage",n.onNewImage),i.addEventListener("cornerstoneimagerendered",n.onImageRendered),i.addEventListener("cornerstonetoolsmeasurementadded",n.onMeasurementAdded),i.addEventListener("cornerstonetoolsmeasurementmodified",n.onMeasurementModified),i.addEventListener("cornerstonetoolsmeasurementcompleted",n.onMeasurementCompleted);var r=void 0;Me.enable(i),void 0===e&&Q(t)?Me.loadImage(t).then((function(e){n.hideOpenUrlDlg(),n.image=e,n.isDicom=!1,Me.displayImage(i,e),n.enableTool(),n.props.setActiveDcm(Object(m.a)(n)),n.props.isOpenStore(!0)}),(function(e){console.log("error",e),n.setState({errorOnOpenImage:"This is not a valid JPG or PNG file."})})):void 0!==e&&K(e)||void 0!==a&&$(a)?(r=void 0!==a?Le.fileManager.addBuffer(a.data):Le.fileManager.add(e),Me.loadImage(r).then((function(e){console.log("loadImage, image from local: ",e),n.image=e,n.isDicom=!1,n.PatientsName="",Me.displayImage(i,e),n.enableTool(),n.props.setActiveDcm(Object(m.a)(n)),n.props.setIsOpenStore({index:n.props.index,value:!0})}),(function(e){console.log("error",e),n.setState({errorOnOpenImage:"This is not a valid JPG or PNG file."})}))):(void 0!==a?(r=ke.wadouri.fileManager.addBuffer(a.data),n.filename=a.name):void 0!==e?(r=ke.wadouri.fileManager.add(e),n.filename=e.name):r="wadouri:"+t,Me.loadAndCacheImage(r).then((function(e){n.hideOpenUrlDlg(),n.image=e,n.isDicom=!0,n.PatientsName=e.data.string("x00100010"),n.sopInstanceUid=n.getSopInstanceUID();var t={currentImageIdIndex:0,imageIds:""};if(n.numberOfFrames=e.data.intString("x00280008"),n.numberOfFrames>0){for(var a=[],o=0;o<n.numberOfFrames;++o)a.push(r+"?frame="+o);t.imageIds=a}Me.displayImage(i,e),n.enableTool(),n.numberOfFrames>1&&(Re.addStackStateManager(i,["stack","playClip"]),Re.addToolState(i,"stack",t),n.setState({frame:1})),He.measurement.where("sopinstanceuid").equals(n.sopInstanceUid).each((function(e){n.measurementSave(e),Re.addToolState(i,e.tool,e.data),n.runTool(e.tool),Me.updateImage(i),Re.setToolEnabled(e.tool)})).then((function(){n.props.setActiveMeasurements(n.measurements),n.props.setActiveDcm(Object(m.a)(n)),n.props.setIsOpenStore({index:n.props.index,value:!0})}))}),(function(e){console.log("error",e),n.hideOpenUrlDlg();var t=e.error.toString();if("[object XMLHttpRequest]"===t)n.setState({errorOnCors:!0});else{var a=t.indexOf(":");n.setState({errorOnOpenImage:a<0?e.error:t.substring(a+1)})}})))}},n.enableTool=function(e,t){if(!n.props.dcmEnableTool){var a=Re.WwwcTool,i=Re.LengthTool,r=Re.PanTool,o=Re.ZoomTouchPinchTool,s=Re.ZoomTool,l=Re.ProbeTool,c=Re.EllipticalRoiTool,m=Re.RectangleRoiTool,u=Re.FreehandRoiTool,d=Re.AngleTool,p=Re.MagnifyTool,f=Re.StackScrollMouseWheelTool;Re.addTool(p),Re.addTool(d),Re.addTool(a),Re.addTool(i),Re.addTool(r),Re.addTool(o),Re.addTool(s),Re.addTool(l),Re.addTool(c),Re.addTool(m),Re.addTool(u),Re.addTool(f),n.props.setDcmEnableToolStore(!0)}},n.disableAllTools=function(){n.props.setDcmEnableToolStore(!1),Re.setToolEnabled("Length"),Re.setToolEnabled("Pan"),Re.setToolEnabled("Magnify"),Re.setToolEnabled("Angle"),Re.setToolEnabled("RectangleRoi"),Re.setToolEnabled("Wwwc"),Re.setToolEnabled("ZoomTouchPinch"),Re.setToolEnabled("Probe"),Re.setToolEnabled("EllipticalRoi"),Re.setToolEnabled("FreehandRoi"),Re.setToolEnabled("StackScrollMouseWheel")},n.runTool=function(e,t){switch(n.state.inPlay&&n.runCinePlayer("pause"),e){case"setfiles":n.files=t,n.sliceMax=n.files.length,n.shouldScroll=n.files.length>1;break;case"openimage":Me.disable(n.dicomImage),n.displayImageFromFiles(t);break;case"openLocalFs":Me.disable(n.dicomImage),n.loadImage(t);break;case"openSandboxFs":Me.disable(n.dicomImage),n.loadImage(void 0,void 0,t);break;case"openurl":n.showOpenUrlDlg(t);break;case"clear":n.setState({visibleCinePlayer:!1}),n.mprPlane="",n.files=null,n.props.setIsOpenStore({index:n.props.index,value:!1}),Me.disable(n.dicomImage);break;case"notool":n.disableAllTools();break;case"Wwwc":Re.setToolActive("Wwwc",{mouseButtonMask:1});break;case"Pan":Re.setToolActive("Pan",{mouseButtonMask:1});break;case"Zoom":Re.setToolActive(Z.isMobile?"ZoomTouchPinch":"Zoom",{mouseButtonMask:1});break;case"Length":Re.setToolActive("Length",Z.isMobile?{isTouchActive:!0}:{mouseButtonMask:1});break;case"Probe":Re.setToolActive("Probe",{mouseButtonMask:1});break;case"EllipticalRoi":Re.setToolActive("EllipticalRoi",{mouseButtonMask:1});break;case"RectangleRoi":Re.setToolActive("RectangleRoi",{mouseButtonMask:1});break;case"Angle":Re.setToolActive("Angle",{mouseButtonMask:1});break;case"Magnify":Re.setToolActive("Magnify",{mouseButtonMask:1});break;case"FreehandRoi":Re.setToolActive("FreehandRoi",{mouseButtonMask:1});break;case"Invert":var a=n.dicomImage,i=Me.getViewport(a);i.invert=!i.invert,Me.setViewport(a,i);break;case"saveas":var r=localStorage.getItem("saveAs");if("local"===ie()){var o=n.dicomImage,s=Me.getViewport(o),l=document.getElementsByClassName("cornerstone-canvas")[n.props.activeDcmIndex],c=s.scale.toFixed(2),m=n.image.columns*c,u=n.image.rows*c,d=document.createElement("canvas");d=n.cropCanvas(l,Math.round(l.width/2-m/2),Math.round(l.height/2-u/2),m,u);var p=document.createElement("a");p.href=d.toDataURL("image/".concat(r)),p.download="".concat(n.filename,".").concat(r),document.body.appendChild(p),p.click()}else{var f=n.dicomImage,g=Me.getViewport(f),h=document.getElementsByClassName("cornerstone-canvas")[n.props.activeDcmIndex],v=g.scale.toFixed(2),E=n.image.columns*v,b=n.image.rows*v,S=document.createElement("canvas");S=n.cropCanvas(h,Math.round(h.width/2-E/2),Math.round(h.height/2-b/2),E,b),Ae.b(S,"image/".concat(r)).then((function(e){Ae.a(e).then((function(e){var t="".concat(ne(n.filename),"-MPR-").concat(n.mprPlane),a=t,i=1,o=!1,s=function(){var s="".concat(a,".").concat(r);void 0===n.props.fsCurrentList.find((function(e){return e.name===s}))?(j.transaction("rw",j.files,Object(De.a)(Ce.a.mark((function t(){return Ce.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j.files.add({parent:n.props.fsCurrentDir,name:s,type:r,size:e.byteLength,data:e});case 2:case"end":return t.stop()}}),t)})))).then((function(){n.props.makeFsRefresh()})),o=!0):(a="".concat(t," - ").concat(i),i++)};do{s()}while(!o)}))}))}break;case"cine":n.setState({visibleCinePlayer:!n.state.visibleCinePlayer});break;case"reset":n.reset();break;case"removetool":var y=n.dicomImage;Re.removeToolState(y,n.measurements[t].tool,n.measurements[t].data),Me.updateImage(y),n.measurementRemove(t),n.props.setActiveMeasurements(n.measurements);break;case"removetools":var x=n.dicomImage;n.measurements.forEach((function(e){Re.clearToolState(x,e.tool)})),Me.updateImage(x),n.measurementClear(),He.measurement.where("sopinstanceuid").equals(n.sopInstanceUid).delete(),n.props.setActiveMeasurements(n.measurements);break;case"savetools":He.measurement.where("sopinstanceuid").equals(n.sopInstanceUid).delete(),n.measurements.forEach((function(e){try{He.measurement.add({sopinstanceuid:n.sopInstanceUid,tool:e.tool,note:e.note,data:e.data})}catch(t){console.error(t)}}))}},n.cropCanvas=function(e,t,a,n,i){var r=document.createElement("canvas");return r.width=n,r.height=i,r.getContext("2d").drawImage(e,t,a,n,i,0,0,n,i),r},n.changeTool=function(e,t){switch(e){case"Wwwc":1===t?Re.setToolActive("Wwwc",{mouseButtonMask:1}):0===t&&Re.setToolPassive("Wwwc");break;case"Pan":1===t?Re.setToolActive("Pan",{mouseButtonMask:1}):0===t&&Re.setToolPassive("Pan");break;case"Zoom":1===t?Re.setToolActive(Z.isMobile?"ZoomTouchPinch":"Zoom",{mouseButtonMask:1}):0===t&&Re.setToolPassive(Z.isMobile?"ZoomTouchPinch":"Zoom");break;case"Length":1===t?Re.setToolActive("Length",Z.isMobile?{isTouchActive:!0}:{mouseButtonMask:1}):0===t&&Re.setToolPassive("Length");break;case"Probe":1===t?Re.setToolActive("Probe",{mouseButtonMask:1}):0===t&&Re.setToolPassive("Probe");break;case"Angle":1===t?Re.setToolActive("Angle",{mouseButtonMask:1}):0===t&&Re.setToolPassive("Angle");break;case"Magnify":1===t?Re.setToolActive("Magnify",{mouseButtonMask:1}):0===t&&Re.setToolPassive("Magnify");break;case"EllipticalRoi":1===t?Re.setToolActive("EllipticalRoi",{mouseButtonMask:1}):0===t&&Re.setToolPassive("EllipticalRoi");break;case"RectangleRoi":1===t?Re.setToolActive("RectangleRoi",{mouseButtonMask:1}):0===t&&Re.setToolPassive("RectangleRoi");break;case"FreehandRoi":1===t?Re.setToolActive("FreehandRoi",{mouseButtonMask:1}):0===t&&Re.setToolPassive("FreehandRoi")}},n.runCinePlayer=function(e){var t=n.dicomImage;switch(e){case"firstframe":n.setState({frame:1}),qe(t,0);break;case"previousframe":if(n.state.frame>1){var a=n.state.frame-1;n.setState({frame:a}),qe(t,a-1)}break;case"play":Re.playClip(t,30),n.setState({inPlay:!0});break;case"pause":Re.stopClip(t),n.setState({inPlay:!1});break;case"nextframe":if(n.state.frame<n.numberOfFrames){var i=n.state.frame+1;n.setState({frame:i}),qe(t,i-1)}break;case"lastframe":var r=n.numberOfFrames;n.setState({frame:r}),qe(t,r-1)}},n.reset=function(){var e=n.dicomImage,t=Me.getDefaultViewportForImage(e,n.image),a=Me.getViewport(e);a.voi.windowWidth=t.voi.windowWidth,a.voi.windowCenter=t.voi.windowCenter,a.invert=!1,Me.setViewport(e,a)},n.mprPlanePosition=function(){try{if(!n.isDicom)return n.mprPlane;var e=n.files[0].image.data.string("x00200037").split("\\"),t=new Array(6).fill(0);t[0]=parseFloat(e[0]),t[1]=parseFloat(e[1]),t[2]=parseFloat(e[2]),t[3]=parseFloat(e[3]),t[4]=parseFloat(e[4]),t[5]=parseFloat(e[5]);var a=[(t=t.map((function(e){return Math.round(e)})))[1]*t[5]-t[2]*t[4],t[2]*t[3]-t[0]*t[5],t[0]*t[4]-t[1]*t[3]];1===(a=a.map((function(e){return Math.abs(e)})))[0]?n.mprPlane="sagittal":1===a[1]?n.mprPlane="coronal":1===a[2]&&(n.mprPlane="axial")}catch(i){n.mprPlane=""}return n.mprPlane},n.transpose=function(e){return Object.keys(e[0]).map((function(t){return e.map((function(e){return e[t]}))}))},n.mprRenderYZPlane=function(e,t,a,i){if(null!==n.volume){n.mprData=i;var r=null===n.files?n.props.files:n.files;n.sliceIndex=a,n.filename=e,Me.disable(n.dicomImage),n.mprPlane="sagittal"===t?"coronal":"sagittal",n.xSize=r[0].columns,n.ySize=r[0].rows,n.zSize=i.zDim;var o=Math.round(a/n.xSize*r.length);if(n.originImage=r[o].image,"sagittal"===t){for(var s=Math.floor(n.xSize/2)-Math.floor(n.zSize/2),l=new Int16Array(n.xSize*n.ySize),c=0;c<n.ySize;c++)for(var m=0;m<n.zSize;m++)l[m+n.ySize*c+s]=n.volume[m][a+n.ySize*c];n.loadImageFromCustomObject(n.xSize,n.ySize,l)}else if("coronal"===t){for(var u=Math.floor(n.xSize/2)-Math.floor(n.zSize/2),d=new Int16Array(n.xSize*n.ySize),p=0;p<n.ySize;p++)for(var f=0;f<n.zSize;f++)d[f+n.ySize*p+u]=n.volume[f][a+n.ySize*p];n.loadImageFromCustomObject(n.xSize,n.ySize,d)}else{var g=n.mprBuildYZPlane(a);n.loadImageFromCustomObject(n.ySize,n.zSize,g)}}},n.mprBuildYZPlane=function(e){for(var t=new Int16Array(n.ySize*n.zSize),a=0;a<n.ySize;a++)for(var i=0;i<n.zSize;i++)t[a+n.ySize*i]=n.volume[i][e+n.ySize*a];return t},n.mprRenderXZPlane=function(e,t,a,i){if(null!==n.volume){n.mprData=i;var r=null===n.files?n.props.files:n.files;n.sliceIndex=a,n.filename=e,Me.disable(n.dicomImage),n.mprPlane="sagittal"===t?"axial":"axial"===t?"coronal":"axial",n.xSize=r[0].columns,n.ySize=r[0].rows,n.zSize=i.zDim;var o=Math.trunc(a/n.ySize*r.length);if(n.originImage=r[o].image,"sagittal"===t){for(var s=Math.floor(n.xSize/2)-Math.floor(n.zSize/2),l=new Int16Array(n.xSize*n.ySize),c=0;c<n.xSize;c++)for(var m=0;m<n.zSize;m++)l[m+n.xSize*c+s]=n.volume[m][c+n.xSize*a];n.loadImageFromCustomObject(n.xSize,n.ySize,l)}else{var u=n.mprBuildXZPlane(a);n.loadImageFromCustomObject(n.xSize,n.zSize,u)}}},n.mprBuildXZPlane=function(e){for(var t=new Int16Array(n.xSize*n.zSize),a=0;a<n.xSize;a++)for(var i=0;i<n.zSize;i++)t[a+n.xSize*i]=n.volume[i][a+n.xSize*e];return t},n.mprIsOrthogonalView=function(){return""!==n.mprPlane&&1===n.props.layout[0]&&3===n.props.layout[1]},n.mprReferenceLines=function(e){var t=n.props.activeDcm.mprPlane,a=n.mprPlane,i=1===n.mprData.instanceNumberOrder?e*n.mprData.zStep:(n.mprData.indexMax-e)*n.mprData.zStep;if(n.mpr.sliceLocation={},"axial"===t)n.mpr.sliceLocation.p0=new Xe(3,i),n.mpr.sliceLocation.p1=new Xe(n.xSize-3,i);else if("sagittal"===t){var r=Math.round((n.xSize-n.zSize)/2);n.mpr.sliceLocation.p0=new Xe(r+i,3),n.mpr.sliceLocation.p1=new Xe(r+i,n.ySize-3)}else if("axial"===a)n.mpr.sliceLocation.p0=new Xe(3,i),n.mpr.sliceLocation.p1=new Xe(n.xSize-3,i);else{var o=Math.round((n.xSize-n.zSize)/2);n.mpr.sliceLocation.p0=new Xe(o+i,3),n.mpr.sliceLocation.p1=new Xe(o+i,n.ySize-3)}n.mpr.isSliceLocation=!0,n.updateImage()},n.mprReferenceLines2=function(e){var t=n.props.activeDcm.mprPlane,a=n.mprPlane,i=(n.mprData.instanceNumberOrder,e);n.mpr.sliceLocation={},"axial"===t?(n.mpr.sliceLocation.p0=new Xe(3,i),n.mpr.sliceLocation.p1=new Xe(n.xSize-3,i)):"sagittal"===t?(n.mpr.sliceLocation.p0=new Xe(i,3),n.mpr.sliceLocation.p1=new Xe(i,n.zSize-3)):"axial"===a?(n.mpr.sliceLocation.p0=new Xe(3,i),n.mpr.sliceLocation.p1=new Xe(n.xSize-3,i)):(n.mpr.sliceLocation.p0=new Xe(i,3),n.mpr.sliceLocation.p1=new Xe(i,n.zSize-3)),n.mpr.isSliceLocation=!0,n.updateImage()},n.mprReferenceLines3=function(e,t){var a=n.image.columns,i=n.image.rows,r=n.props.activeDcm.mprPlane,o=n.mprPlane;n.mpr.sliceLocation={},"axial"===r?(n.mpr.sliceLocation.p0=new Xe(3,e),n.mpr.sliceLocation.p1=new Xe(a-3,e)):"sagittal"===r?(n.mpr.sliceLocation.p0=new Xe(e,3),n.mpr.sliceLocation.p1=new Xe(e,i-3)):"axial"===o?(n.mpr.sliceLocation.p0=new Xe(3,e),n.mpr.sliceLocation.p1=new Xe(a-3,e)):(n.mpr.sliceLocation.p0=new Xe(e,3),n.mpr.sliceLocation.p1=new Xe(e,i-3)),n.mpr.isSliceLocation=!0,n.updateImage()},n.mprSliceLocationDraw=function(){var e=document.getElementById("viewer-".concat(n.props.index)).getElementsByClassName("cornerstone-canvas")[0].getContext("2d"),t=n.mpr.sliceLocation.p0,a=n.mpr.sliceLocation.p1;e.beginPath(),e.setLineDash([]),n.zoom<150&&(e.lineWidth=2),e.strokeStyle="rgba(255, 255, 51, 0.7)",e.moveTo(t.x,t.y),e.lineTo(a.x,a.y),e.lineWidth=1,e.stroke()},n.referenceLinesBuild=function(e){n.referenceLines.dst=new Ye(n.image),n.referenceLines.src=new Ye(e),n.referenceLines.isReferenceLine=void 0!==n.referenceLines.dst.orientation&&void 0!==n.referenceLines.src.orientation&&n.referenceLines.dst.orientation!==n.referenceLines.src.orientation,n.referenceLines.isScoutDraw=!0,n.updateImage()},n.referenceLinesBuildLine=function(){var e=n.referenceLines.dst,t=n.referenceLines.src,a=e.nrmDir.dotProduct(e.topLeft),i=e.nrmDir.dotProduct(t.topLeft),r=e.nrmDir.dotProduct(t.topRight),o=e.nrmDir.dotProduct(t.bottomRight),s=e.nrmDir.dotProduct(t.bottomLeft),l=[];if(!B(r,i)){var c=(a-i)/(r-i);c>0&&c<=1&&l.push(t.topLeft.add(t.topRight.sub(t.topLeft).mul(c)))}if(!B(o,r)){var m=(a-r)/(o-r);m>0&&m<=1&&l.push(t.topRight.add(t.bottomRight.sub(t.topRight).mul(m)))}if(!B(s,o)){var u=(a-o)/(s-o);u>0&&u<=1&&l.push(t.bottomRight.add(t.bottomLeft.sub(t.bottomRight).mul(u)))}if(!B(i,s)){var d=(a-s)/(i-s);d>0&&d<=1&&l.push(t.bottomLeft.add(t.topLeft.sub(t.bottomLeft).mul(d)))}if(2===l.length)return{startPoint:n.transformDstPatientPointToImage(l[0]),endPoint:n.transformDstPatientPointToImage(l[1])}},n.transformDstPatientPointToImage=function(e){var t=new _e([e.x],[e.y],[e.z],[1]),a=n.referenceLines.dst.transformRcsToImage.multiply(t);return new Xe(Math.round(a.get(0,0)),Math.round(a.get(1,0)))},n.referenceLinesBuildPlane=function(){var e=n.referenceLines.dst,t=n.referenceLines.src,a=[];a[0]=t.topLeft,a[1]=t.topLeft.add(t.rowDir.mul(t.lengthX)),a[2]=t.topLeft.add(t.rowDir.mul(t.lengthX).add(t.colDir.mul(t.lengthY))),a[3]=t.topLeft.add(t.colDir.mul(t.lengthY));for(var i=[],r=new _e(e.rowDir.toArray(),e.colDir.toArray(),e.nrmDir.toArray()),o=0;o<4;o++){a[o]=a[o].add(Xe.zero.sub(e.topLeft));var s=r.multiply(a[o].toMatrix());a[o]=new Xe(Math.round(s.get(0,0)),Math.round(s.get(1,0)),Math.round(s.get(2,0))),i[o]=new Xe(Math.trunc(a[o].x/e.spacingY+.5),Math.trunc(a[o].y/e.spacingX+.5))}return i},n.referenceLinesDraw=function(){if(n.referenceLines.isReferenceLine){var e=document.getElementById("viewer-".concat(n.props.index)).getElementsByClassName("cornerstone-canvas")[0].getContext("2d");n.referenceLines.plane=n.referenceLinesBuildPlane(),n.referenceLines.line=n.referenceLinesBuildLine();var t=n.referenceLines.line;e.beginPath(),e.setLineDash([]),e.strokeStyle="rgba(255, 255, 51, 0.5)",e.moveTo(t.startPoint.x,t.startPoint.y),e.lineTo(t.endPoint.x,t.endPoint.y),e.lineWidth=1,e.stroke();var a=n.referenceLines.plane,i=Math.max(n.referenceLines.dst.rows,n.referenceLines.dst.cols)/30,r=new Je(a[0],a[1]),o=new Je(a[1],a[2]),s=new Je(a[2],a[3]),l=new Je(a[3],a[0]);Math.min(r.distance(s),o.distance(l))<i||(e.beginPath(),e.setLineDash([3,3]),e.strokeStyle="rgba(135, 206, 250, 0.5)",e.moveTo(a[0].x,a[0].y),e.lineTo(a[1].x,a[1].y),e.lineTo(a[2].x,a[2].y),e.lineTo(a[3].x,a[3].y),e.lineTo(a[0].x,a[0].y),e.lineWidth=1,e.stroke())}},n.dicomImageRef=function(e){n.dicomImage=e},n.onImageClick=function(){},n.isLocalizer=function(){return function(e){var t=e.data.string("x00080008").split("\\");return console.log("Localizer: ",t),3===t.length&&"LOCALIZER"===t[2]}(n.image)},n.findFirstSliceWithIppValue=function(e,t){for(var a=n.files[0].sliceDistance-n.files[n.files.length-1].sliceDistance<0,i=0;i<n.files.length;i++){var r=_(n.files[i].image,t);if(a){if(r>=e)return i}else if(r<=e)return i}return-1},n.files=null,n.filename="",n.localfile=null,n.localurl=null,n.fsItem=null,n.dicomImage=null,n.explorerIndex=0,n.imageId=null,n.image=null,n.isDicom=!1,n.layoutIndex=0,n.numberOfFrames=1,n.measurements=[],n.xSize=0,n.ySize=0,n.zSize=0,n.volume=null,n.originImage=null,n.mprPlane="",n.sliceMax=0,n.sliceIndex=0,n.mpr={},n.referenceLines={},n.shouldScroll=!1,n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){this.props.runTool(this),this.props.changeTool(this),Me.events.addEventListener("cornerstoneimageloaded",this.onImageLoaded),(0,this.props.dcmRef)(this),this.layoutIndex=this.props.index,document.getElementById("viewer-".concat(this.props.index)).addEventListener("wheel",this.handlerMouseScroll)}},{key:"componentWillUnmount",value:function(){this.props.runTool(void 0),this.props.changeTool(void 0),(0,this.props.dcmRef)(void 0)}},{key:"componentDidUpdate",value:function(e){var t=this.props.isOpen[this.props.index];this.props.layout!==e.layout&&t&&Me.resize(this.dicomImage)}},{key:"render",value:function(){var e=this.props.visible?"visible":"hidden",t=this.props.isOpen[this.props.index],a=this.state.visibleOpenUrlDlg,n=this.state.errorOnOpenImage,r=this.state.progress,o={width:"100%",height:"100%",border:this.props.activeDcmIndex===this.props.index&&(this.props.layout[0]>1||this.props.layout[1]>1)?"solid 1px #AAAAAA":null,position:"relative"},s=re()&&this.props.overlay;return i.a.createElement("div",{className:"container",style:o},a?i.a.createElement(je,{progress:r,onClose:this.hideOpenUrlDlg}):null,i.a.createElement(v.a,{open:null!==n,onClose:this.onErrorOpenImageClose},i.a.createElement(S.a,{id:"alert-dialog-title"},"Error on opening image"),i.a.createElement(b.a,null,i.a.createElement(we.a,{id:"alert-dialog-description"},this.state.errorOnOpenImage)),i.a.createElement(E.a,null,i.a.createElement(h.a,{onClick:this.onErrorOpenImageClose,autoFocus:!0},"Ok"))),i.a.createElement(v.a,{open:this.state.errorOnCors,onClose:this.onErrorCorsClose,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},i.a.createElement(S.a,{id:"alert-dialog-title"},"Error on loading image"),i.a.createElement(b.a,null,i.a.createElement(we.a,{id:"alert-dialog-description"},i.a.createElement(D.a,{gutterBottom:!0},"CORS or Cross Origin Resource Sharing is a browser security policy that prevents javascript from loading data from a server with a different base URL than the server that served up the javascript file."),i.a.createElement(D.a,{gutterBottom:!0},"See the \xa0",i.a.createElement(y.a,{href:"http://enable-cors.org/",target:"_blank",color:"textPrimary"},"Enable CORS site"),"\xa0 for information about CORS."))),i.a.createElement(E.a,null,i.a.createElement(h.a,{onClick:this.onErrorCorsClose,autoFocus:!0},"Ok"))),i.a.createElement("div",{style:{width:"100%",height:"100%",position:"relative",color:"#FFFFFF",fontSize:"1.00em",textShadow:"1px 1px #000000",visibility:e},onContextMenu:function(){return!1},className:"cornerstone-enabled-image"},i.a.createElement("div",{id:"viewer-".concat(this.props.index),ref:this.dicomImageRef,style:{width:"100%",height:"100%",position:"relative"}}),i.a.createElement("div",{id:"mrtopleft-".concat(this.props.index),style:{position:"absolute",top:0,left:3,display:t&&s?"":"none"}}),i.a.createElement("div",{id:"mrtopright-".concat(this.props.index),style:{position:"absolute",top:0,right:3,display:t&&s?"":"none"}}),i.a.createElement("div",{id:"mrbottomright-".concat(this.props.index),style:{position:"absolute",bottom:0,right:3,display:t&&s?"":"none"}}),i.a.createElement("div",{id:"mrbottomleft-".concat(this.props.index),style:{position:"absolute",bottom:0,left:3,display:t&&s?"":"none"}}),i.a.createElement("div",{id:"mrtopcenter-".concat(this.props.index),style:{position:"absolute",top:0,width:"60px",left:"50%",marginLeft:"0px",display:t&&s?"":"none"}}),i.a.createElement("div",{id:"mrleftcenter-".concat(this.props.index),style:{position:"absolute",top:"50%",width:"30px",left:3,marginLeft:"0px",display:t&&s?"":"none"}}),i.a.createElement("div",{id:"mrrightcenter-".concat(this.props.index),style:{position:"absolute",top:"50%",width:"30px",right:3,marginRight:"-20px",display:t&&s?"":"none"}}),i.a.createElement("div",{id:"mrbottomcenter-".concat(this.props.index),style:{position:"absolute",bottom:0,width:"60px",left:"50%",marginLeft:"0px",display:t&&s?"":"none"}}),this.state.visibleCinePlayer&&this.numberOfFrames>1?i.a.createElement("div",{style:{position:"absolute",width:"100%",bottom:0,textAlign:"center"}},i.a.createElement("div",{style:{margin:"0 auto",width:"240px",backgroundColor:"rgba(136, 136, 136, 0.5)"}},i.a.createElement(We,{runCinePlayer:this.runCinePlayer,inPlay:this.state.inPlay}),i.a.createElement("div",{id:"frameLabel-".concat(this.props.index),style:{width:230,margin:"0 auto",marginTop:-10,textAlign:"center"}},this.state.frame," / ",this.numberOfFrames))):null))}}]),a}(i.a.Component),Ke=Object(g.b)((function(e){return{files:e.files,series:e.series,url:e.url,isOpen:e.isOpen,tool:e.tool,activeDcmIndex:e.activeDcmIndex,activeDcm:e.activeDcm,explorerActiveSeriesIndex:e.explorerActiveSeriesIndex,measurements:e.measurements,layout:e.layout,fsCurrentDir:e.fsCurrentDir,fsCurrentList:e.fsCurrentList,volume:e.volume,dcmEnableTool:e.dcmEnableTool}}),(function(e){return{clearingStore:function(){return e({type:"CLEAR_STORE"})},setIsOpenStore:function(t){return e(de(t))},toolStore:function(t){return e(pe(t))},setActiveDcm:function(t){return e(fe(t))},setActiveMeasurements:function(t){return e(ge(t))},makeFsRefresh:function(t){return e({type:"FSREFRESH"})},setDcmEnableToolStore:function(t){return e(Ee(t))}}}))(Qe),$e=a(11),et=a(260),tt=function(e){var t=e.dcmViewer,a=e.classes,n=e.color,r=[];r.push({name:"Transfer Syntax",value:t.getTransferSyntax()}),r.push({name:"SOP Class",value:t.getSopClass()}),r.push({name:"SOP Instance UID",value:t.getSopInstanceUID()}),r.push({name:"Modality",value:t.image.data.string("x00080060")}),r.push({name:"Manufacturer",value:t.image.data.string("x00080070")}),r.push({name:"Study Description",value:t.image.data.string("x00081030")}),r.push({name:"Series Description",value:t.image.data.string("x0008103E")}),r.push({name:"Patient Name",value:t.image.data.string("x00100010")}),r.push({name:"Frame Rate",value:t.image.data.string("x00082144")}),r.push({name:"MR Acquisition Type",value:t.image.data.string("x00180023")}),r.push({name:"Slice Thickness",value:t.image.data.string("x00180050")}),r.push({name:"Spacing Between Slice",value:t.image.data.string("x00180088")}),r.push({name:"Patient Position",value:t.image.data.string("x00185100")}),r.push({name:"Study ID",value:t.image.data.string("x00200010")}),r.push({name:"Series Number",value:t.image.data.string("x00200011")}),r.push({name:"Acquisition Number",value:t.image.data.string("x00200012")}),r.push({name:"Instance Number",value:t.image.data.string("x00200013")}),r.push({name:"Image Position (Patient)",value:t.image.data.string("x00200032")}),r.push({name:"Image Orientation (Patient)",value:t.image.data.string("x00200037")}),r.push({name:"Images in Acquisition",value:t.image.data.string("x00201002")}),r.push({name:"Slice Location",value:t.image.data.string("x00201041")}),r.push({name:"Samples per Pixel",value:t.image.data.uint16("x00280002")}),r.push({name:"Photometric Interpretation",value:t.image.data.string("x00280004")}),r.push({name:"Number of Frames",value:t.image.data.string("x00280008")}),r.push({name:"Planar Configuration",value:t.getPlanarConfiguration()}),r.push({name:"Rows",value:t.image.data.uint16("x00280010")}),r.push({name:"Columns",value:t.image.data.uint16("x00280011")}),r.push({name:"Pixel Spacing",value:t.image.data.string("x00280030")}),r.push({name:"Bits Allocated",value:t.image.data.uint16("x00280100")}),r.push({name:"Bits Stored",value:t.image.data.uint16("x00280101")}),r.push({name:"High Bit",value:t.image.data.uint16("x00280102")}),r.push({name:"Pixel Representation",value:t.getPixelRepresentation()}),r.push({name:"Window Center",value:t.image.data.string("x00281050")}),r.push({name:"Window Width",value:t.image.data.string("x00281051")}),r.push({name:"Rescale Intercept",value:t.image.data.string("x00281052")}),r.push({name:"Rescale Slope",value:t.image.data.string("x00281053")}),r.push({name:"Min Stored Pixel Value",value:t.image.minPixelValue}),r.push({name:"Max Stored Pixel Value",value:t.image.maxPixelValue}),r.push({name:"Image Orientation",value:t.image.data.string("x00700042")}),r.push({name:"Image Horizontal Flip",value:t.image.data.string("x00700041")});var o=r.map((function(e,t){return void 0!==e.value?i.a.createElement(I.a,{dense:!0,key:t},i.a.createElement(C.a,{primary:e.name,secondary:e.value})):null}));return console.log("dcmViewer",t),i.a.createElement(A.a,null,i.a.createElement("div",{style:{marginTop:"48px"}},i.a.createElement(et.a,{variant:"dense"},i.a.createElement(D.a,{variant:"subtitle1",className:a.title},"Dicom Header"),i.a.createElement("div",{className:a.grow}),i.a.createElement(Ue.a,{color:"inherit",onClick:function(){var e=localStorage.getItem("exportAs");null===e&&(e="json",localStorage.setItem("exportAs",e));var a="";if("csv"===e)a=function(e,t){var a,n,i,r,o,s,l,c=[],m="",u='"';for("undefined"!==typeof t&&null!==t||(t=","),a=0,n=e.length;a<n;a+=1){if(r=e[a],o="",0===a){for(i in r)r.hasOwnProperty(i)&&(c.push(i),o+=[u,i.replace(/"/g,'""'),u,t].join(""));m+=o=o.substring(0,o.length-1)}for(m+="\n",o="",s=0,l=c.length;s<l;s+=1)s>0&&(o+=t),o+=ce(r[i=c[s]]);m+=o}return m}(r);else{var n=r.reduce((function(e,t){return Object($e.a)(Object($e.a)({},e),{},Object(p.a)({},t.name,t.value))}),{});a=JSON.stringify(n)}var i=document.createElement("a"),o=new Blob([a],{type:"text/plain"});i.href=URL.createObjectURL(o),i.download="".concat(t.localfile.name,".").concat(e),document.body.appendChild(i),i.click()}},i.a.createElement(Be.a,{path:Ge.q,size:"1.2rem",color:n}))),i.a.createElement("div",null,i.a.createElement(x.a,{dense:!0,component:"div"},o))))},at=a(108),nt=a.n(at),it=nt.a.CancelToken.source(),rt=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){var e;Object(l.a)(this,a);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).state={loading:0},e.hide=function(){e.props.onClose()},e.cancel=function(){it.cancel("Operation canceled by the user."),e.hide()},e.requestDownloadZip=function(){console.log("this.props.url",e.props.url),e.setState({loading:0}),nt()({method:"get",url:e.props.url,responseType:"arraybuffer",cancelToken:it.token,onDownloadProgress:function(t){var a=Math.round(100*t.loaded/t.total);e.setState({loading:a}),console.log("loading: ",a)}}).then((function(t){console.log("response: ",t),e.props.setFsZippedFile(t.data),e.hide()})).catch((function(e){console.log("error: ",e)}))},e}return Object(c.a)(a,[{key:"componentDidMount",value:function(e){this.requestDownloadZip()}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement(v.a,{open:!0,onClose:this.hide},i.a.createElement(S.a,null,"Downloading zip archive..."),i.a.createElement(b.a,null,i.a.createElement(ze.a,{variant:"determinate",value:this.state.loading,color:"secondary"})),i.a.createElement(E.a,null,i.a.createElement(h.a,{onClick:this.cancel},"Cancel"))))}}]),a}(n.PureComponent),ot=Object(g.b)(null,(function(e){return{setFsZippedFile:function(t){return e(ve(t))}}}))(rt),st=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={visibleOpenUrlDlg:!1,progress:null,visibleCinePlayer:!1,errorOnOpenImage:null,errorOnCors:!1,frame:1,inPlay:!1,viewport:null},n.onOpenUrl=function(e){var t=e.detail;n.setState({progress:t.percentComplete})},n.showOpenUrlDlg=function(e){n.setState({visibleOpenUrlDlg:!0},(function(){Me.events.addEventListener("cornerstoneimageloadprogress",n.onOpenUrl),n.loadImage(void 0,e)}))},n.hideOpenUrlDlg=function(){n.setState({visibleOpenUrlDlg:!1,progress:null})},n.measurementSave=function(e){n.measurements.push(e)},n.measurementClear=function(){n.measurements.splice(0,n.measurements.length)},n.measurementRemove=function(e){n.measurements.splice(e,1)},n.getTransferSyntax=function(){var e=n.image.data.string("x00020010");return e+" ["+Ve[e]+"]"},n.getSopClass=function(){var e=n.image.data.string("x00080016");return e+" ["+Ve[e]+"]"},n.getSopInstanceUID=function(){return n.image.data.string("x00080018")},n.getPixelRepresentation=function(){var e=n.image.data.uint16("x00280103");if(void 0!==e)return e+(0===e?" (unsigned)":" (signed)")},n.getPlanarConfiguration=function(){var e=n.image.data.uint16("x00280006");if(void 0!==e)return e+(0===e?" (pixel)":" (plane)")},n.getDicomViewerElement=function(){return document.getElementsByClassName("cornerstone-enabled-image")},n.onImageLoaded=function(e){},n.onImageRendered=function(e){if(n.isDicom&&n.state.visibleCinePlayer&&n.numberOfFrames>1&&(document.getElementById("frameLabel-".concat(n.props.index)).textContent="".concat(n.state.frame," / ").concat(n.numberOfFrames),n.state.inPlay)){var t=n.state.frame===n.numberOfFrames?1:n.state.frame+1;n.setState({frame:t})}},n.onErrorOpenImageClose=function(){n.setState({errorOnOpenImage:null})},n.onErrorCorsClose=function(){n.setState({errorOnCors:!1})},n.updateImage=function(){var e=n.dicomImage;Me.updateImage(e)},n.displayImageFromFiles=function(e){var t=null===n.files?n.props.files:n.files,a=t[e].image,i=t[e].imageId;n.filename=t[e].name;var r=n.dicomImage;r.addEventListener("cornerstonenewimage",n.onNewImage),r.addEventListener("cornerstoneimagerendered",n.onImageRendered),Me.enable(r),n.image=a,n.isDicom=!0,n.PatientsName=a.data.string("x00100010"),n.sopInstanceUid=n.getSopInstanceUID();if(n.numberOfFrames=a.data.intString("x00280008"),n.numberOfFrames>0)for(var o=[],s=0;s<n.numberOfFrames;++s)o.push(i+"?frame="+s);Me.displayImage(r,a)},n.loadImage=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0;if(void 0!==e||void 0!==t||void 0!==a){void 0!==a?n.fsItem=a:void 0!==e?n.localfile=e:n.localurl=t;var i=n.dicomImage;i.addEventListener("cornerstonenewimage",n.onNewImage),i.addEventListener("cornerstoneimagerendered",n.onImageRendered),i.addEventListener("cornerstonetoolsmeasurementadded",n.onMeasurementAdded),i.addEventListener("cornerstonetoolsmeasurementmodified",n.onMeasurementModified),i.addEventListener("cornerstonetoolsmeasurementcompleted",n.onMeasurementCompleted);var r=void 0;Me.enable(i),void 0===e&&Q(t)?Me.loadImage(t).then((function(e){n.hideOpenUrlDlg(),n.image=e,n.isDicom=!1,Me.displayImage(i,e),n.enableTool(),n.props.setActiveDcm({image:n.image,element:n.dicomImage,isDicom:n.isDicom}),n.props.isOpenStore(!0)}),(function(e){console.log("error",e),n.setState({errorOnOpenImage:"This is not a valid JPG or PNG file."})})):void 0!==e&&K(e)||void 0!==a&&$(a)?(r=void 0!==a?Le.fileManager.addBuffer(a.data):Le.fileManager.add(e),Me.loadImage(r).then((function(e){console.log("loadImage, image from local: ",e),n.image=e,n.isDicom=!1,n.PatientsName="",Me.displayImage(i,e),n.enableTool(),n.props.setActiveDcm({image:n.image,element:n.dicomImage,isDicom:n.isDicom}),n.props.setIsOpenStore({index:n.props.index,value:!0})}),(function(e){console.log("error",e),n.setState({errorOnOpenImage:"This is not a valid JPG or PNG file."})}))):(void 0!==a?(r=ke.wadouri.fileManager.addBuffer(a.data),n.filename=a.name):void 0!==e?(r=ke.wadouri.fileManager.add(e),n.filename=e.name):r="wadouri:"+t,Me.loadAndCacheImage(r).then((function(e){n.hideOpenUrlDlg(),n.image=e,n.isDicom=!0,n.PatientsName=e.data.string("x00100010"),n.sopInstanceUid=n.getSopInstanceUID();if(n.numberOfFrames=e.data.intString("x00280008"),n.numberOfFrames>0)for(var t=[],a=0;a<n.numberOfFrames;++a)t.push(r+"?frame="+a);Me.displayImage(i,e),n.enableTool()}),(function(e){console.log("error",e),n.hideOpenUrlDlg();var t=e.error.toString();if("[object XMLHttpRequest]"===t)n.setState({errorOnCors:!0});else{var a=t.indexOf(":");n.setState({errorOnOpenImage:a<0?e.error:t.substring(a+1)})}})))}},n.runTool=function(e,t){switch(n.state.inPlay&&n.runCinePlayer("pause"),e){case"setfiles":n.files=t,n.sliceMax=n.files.length,n.shouldScroll=n.files.length>1;break;case"openimage":Me.disable(n.dicomImage),n.sliceIndex=t,n.displayImageFromFiles(t);break;case"reset":n.reset();break;case"clear":n.files=null,Me.disable(n.dicomImage)}},n.reset=function(){var e=n.dicomImage,t=Me.getDefaultViewportForImage(e,n.image),a=Me.getViewport(e);a.voi.windowWidth=t.voi.windowWidth,a.voi.windowCenter=t.voi.windowCenter,a.invert=!1,Me.setViewport(e,a)},n.dicomImageRef=function(e){n.dicomImage=e},n.onImageClick=function(){},n.getSeriesNumber=function(){if(void 0!==n.props.series&&null!==n.props.series)return n.props.series.seriesList.get(n.props.series.seriesKeys[n.props.index])[n.props.index].series.seriesNumber},n.getSeriesLength=function(){if(void 0!==n.props.series&&null!==n.props.series)return n.props.series.seriesList.get(n.props.series.seriesKeys[n.props.index]).length},n.getSeriesDescription=function(){if(void 0!==n.props.series&&null!==n.props.series&&void 0!==n.props.series.seriesList.get(n.props.series.seriesKeys[n.props.index])[n.props.index])return n.props.series.seriesList.get(n.props.series.seriesKeys[n.props.index])[n.props.index].series.seriesDescription},n.files=null,n.filename="",n.localfile=null,n.localurl=null,n.fsItem=null,n.dicomImage=null,n.explorerIndex=0,n.imageId=null,n.image=null,n.isDicom=!1,n.numberOfFrames=1,n.measurements=[],n.originImage=null,n.mprPlane="",n.sliceMax=0,n.sliceIndex=0,n.shouldScroll=!1,n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){this.props.runTool(this),(0,this.props.dcmRef)(this)}},{key:"componentWillUnmount",value:function(){this.props.runTool(void 0),(0,this.props.dcmRef)(void 0)}},{key:"componentDidUpdate",value:function(e){}},{key:"render",value:function(){var e=this.props.visible?"visible":"hidden",t=this.state.visibleOpenUrlDlg,a=this.state.errorOnOpenImage,n=this.state.progress;this.sliceMax=this.getSeriesLength();var r={width:"100%",height:"100%",border:this.props.explorerActiveSeriesIndex===this.props.index?"solid 1px #AAAAAA":null,position:"relative"};return i.a.createElement("div",{className:"container",style:r},t?i.a.createElement(je,{progress:n,onClose:this.hideOpenUrlDlg}):null,i.a.createElement(v.a,{open:null!==a,onClose:this.onErrorOpenImageClose},i.a.createElement(S.a,{id:"alert-dialog-title"},"Error on opening image"),i.a.createElement(b.a,null,i.a.createElement(we.a,{id:"alert-dialog-description"},this.state.errorOnOpenImage)),i.a.createElement(E.a,null,i.a.createElement(h.a,{onClick:this.onErrorOpenImageClose,autoFocus:!0},"Ok"))),i.a.createElement(v.a,{open:this.state.errorOnCors,onClose:this.onErrorCorsClose,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},i.a.createElement(S.a,{id:"alert-dialog-title"},"Error on loading image"),i.a.createElement(b.a,null,i.a.createElement(we.a,{id:"alert-dialog-description"},i.a.createElement(D.a,{gutterBottom:!0},"CORS or Cross Origin Resource Sharing is a browser security policy that prevents javascript from loading data from a server with a different base URL than the server that served up the javascript file."),i.a.createElement(D.a,{gutterBottom:!0},"See the \xa0",i.a.createElement(y.a,{href:"http://enable-cors.org/",target:"_blank",color:"textPrimary"},"Enable CORS site"),"\xa0 for information about CORS."))),i.a.createElement(E.a,null,i.a.createElement(h.a,{onClick:this.onErrorCorsClose,autoFocus:!0},"Ok"))),i.a.createElement("div",{style:{width:"100%",height:"100%",position:"relative",color:"#AAAAAA",fontSize:"0.80em",textShadow:"1px 1px #000000",visibility:e},onContextMenu:function(){return!1},className:"cornerstone-enabled-image"},i.a.createElement("div",{id:"previewer-".concat(this.props.index),ref:this.dicomImageRef,style:{width:"100%",height:"100%",position:"relative"}}),i.a.createElement("div",{id:"mrtopleft-".concat(this.props.index),style:{position:"absolute",top:0,left:3}},this.getSeriesNumber()),i.a.createElement("div",{id:"mrtopright-".concat(this.props.index),style:{position:"absolute",top:0,right:3}}),i.a.createElement("div",{id:"mrbottomright-".concat(this.props.index),style:{position:"absolute",bottom:0,right:3}},"".concat(this.sliceMax)),i.a.createElement("div",{id:"mrbottomleft-".concat(this.props.index),style:{position:"absolute",bottom:0,left:3}},this.getSeriesDescription()),i.a.createElement("div",{id:"mrtopcenter-".concat(this.props.index),style:{position:"absolute",top:0,width:"60px",left:"50%",marginLeft:"0px"}}),i.a.createElement("div",{id:"mrleftcenter-".concat(this.props.index),style:{position:"absolute",top:"50%",width:"30px",left:3,marginLeft:"0px"}}),i.a.createElement("div",{id:"mrrightcenter-".concat(this.props.index),style:{position:"absolute",top:"50%",width:"30px",right:3,marginRight:"-20px"}}),i.a.createElement("div",{id:"mrbottomcenter-".concat(this.props.index),style:{position:"absolute",bottom:0,width:"60px",left:"50%",marginLeft:"0px"}})))}}]),a}(i.a.Component),lt=Object(g.b)((function(e){return{files:e.files,series:e.series,url:e.url,tool:e.tool,activeDcmIndex:e.activeDcmIndex,activeDcm:e.activeDcm,explorerActiveSeriesIndex:e.explorerActiveSeriesIndex,measurements:e.measurements,fsCurrentDir:e.fsCurrentDir,fsCurrentList:e.fsCurrentList,dcmEnableTool:e.dcmEnableTool}}),(function(e){return{clearingStore:function(){return e({type:"CLEAR_STORE"})},setIsOpenStore:function(t){return e(de(t))},toolStore:function(t){return e(pe(t))},setActiveDcm:function(t){return e(fe(t))},setActiveMeasurements:function(t){return e(ge(t))},makeFsRefresh:function(t){return e({type:"FSREFRESH"})},setDcmEnableToolStore:function(t){return e(Ee(t))}}}))(st),ct=a(262),mt=a(266),ut=a(261),dt=a(280),pt={width:"200px",padding:"8px 8px 8px 8px",marginTop:"40px"},ft={height:"calc(100vh - 48px)"},gt={width:"182px",marginTop:"10px",marginLeft:"7px"},ht={padding:"4px 4px 4px 4px"},vt=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;Object(l.a)(this,a),(n=t.call(this,e)).state={patientName:n.props.explorer.patient.keys[0],studies:[],study:"",series:[],seriesActiveIndex:0},n.setDcmViewer=function(e){return i.a.createElement("div",{style:ht},i.a.createElement(lt,{dcmRef:function(t){n.dicomViewersRefs[e]=t},index:e,runTool:function(e){return n.runTool=e},changeTool:function(e){return n.changeTool=e},onLoadedImage:n.onLoadedImage,onRenderedImage:n.onRenderedImage,visible:!0}))},n.onLoadedImage=function(){},n.onRenderedImage=function(){},n.getDcmViewerRef=function(e){return n.dicomViewersRefs[e]},n.getDcmViewer=function(e){return n.dicomViewers[e]},n.buildPreviewStack=function(e){n.dicomviewers=[];for(var t=function(e){n.dicomviewers.push(i.a.createElement("div",{key:e,onClick:function(){return n.previewStackClick(e)},onTouchStart:function(){return n.previewStackTouch(e)}},n.getDcmViewer(e)))},a=0;a<e;a++)t(a);return i.a.createElement("div",{id:"dicompreviewer-grid",style:{display:"grid",gridTemplateRows:"repeat(".concat(e,", ").concat(100/e,"%)"),gridTemplateColumns:"repeat(".concat(1,", ",100,"%)"),height:"100%",width:"100%"}},n.dicomviewers)},n.handlePatientChange=function(e,t){n.patientName=e.target.value;var a=t.key;n.filesListForPatient=n.props.allFiles.filter((function(e){return e.patient.patientName===n.patientName})),n.studyList=Y(n.filesListForPatient,(function(e){return e.study.studyDateTime}));var i=Object(s.a)(n.studyList.keys());n.study={list:n.studyList,keys:i},n.seriesList=Y(n.studyList.get(i[0]),(function(e){return e.series.seriesNumber}));var r=Object(s.a)(n.seriesList.keys());n.series={seriesList:n.seriesList,seriesKeys:r},n.props.setSeriesStore(n.series),n.setState({patientName:n.patientName,study:n.study.keys[0],studies:i,series:r},(function(){n.props.setExplorerActivePatientIndex(a),n.previewStackClick(0)}))},n.handleStudyChange=function(e,t){var a=t.key;n.studyList=Y(n.filesListForPatient,(function(e){return e.study.studyDateTime}));var i=Object(s.a)(n.studyList.keys());void 0===n.studyList.get(i[0])[0].study.studyDate&&(n.studyList=Y(n.filesListForPatient,(function(e){return e.study.studyDescription})),i=Object(s.a)(n.studyList.keys())),n.study={list:n.studyList,keys:i},n.seriesList=Y(n.studyList.get(i[a]),(function(e){return e.series.seriesNumber}));var r=Object(s.a)(n.seriesList.keys());n.series={seriesList:n.seriesList,seriesKeys:r},n.props.setSeriesStore(n.series),n.setState({study:n.study.keys[a],studies:i,series:r},(function(){n.previewStackClick(0)}))},n.previewStackClick=function(e){n.props.setExplorerActiveSeriesIndex(e),n.setState({seriesActiveIndex:e},(function(){n.props.onSelectSeries(n.series.seriesList.get(n.state.series[e]),e)}))},n.previewStackTouch=function(e){n.props.setExplorerActiveSeriesIndex(e),n.setState({seriesActiveIndex:e},(function(){n.props.onSelectSeries(n.series.seriesList.get(n.state.series[e]))}))},n.clear=function(){for(var e=0;e<16;e++)n.dicomViewersRefs[e].runTool("clear")},n.dicomViewersRefs=[],n.dicomViewers=[];for(var r=0;r<16;r++)n.dicomViewers.push(n.setDcmViewer(r));return n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=this,t=this.props.explorerActivePatientIndex,a=this.props.explorerActiveStudyIndex,n=this.props.explorerActiveSeriesIndex,i=this.props.explorer.patient.keys[t],r=this.props.files;this.setState({patientName:i},(function(){e.filesListForPatient=r.filter((function(e){return e.patient.patientName===i})),e.studyList=Y(e.filesListForPatient,(function(e){return e.study.studyDateTime}));var t=Object(s.a)(e.studyList.keys());void 0===e.studyList.get(t[0])[0].study.studyDate&&(e.studyList=Y(e.filesListForPatient,(function(e){return e.study.studyDescription})),t=Object(s.a)(e.studyList.keys())),e.study={list:e.studyList,keys:t};var o=Y(e.studyList.get(t[0]),(function(e){return e.series.seriesNumber}));e.seriesList=new Map(Object(s.a)(o).sort());var l=Object(s.a)(e.seriesList.keys());l.sort((function(e,t){return e-t})),e.series={seriesList:e.seriesList,seriesKeys:l},e.files=e.series.seriesList.get(l[0]),e.props.setSeriesStore(e.series),e.setState({study:e.study.keys[a],studies:t,series:l},(function(){e.previewStackClick(n)}))}))}},{key:"componentDidUpdate",value:function(){for(var e=0;e<this.state.series.length;e++)this.dicomViewersRefs[e].runTool("setfiles",this.seriesList.get(this.state.series[e])),this.dicomViewersRefs[e].runTool("openimage",0)}},{key:"render",value:function(){var e=this.props.classes;return i.a.createElement(A.a,null,i.a.createElement("div",{style:ft},i.a.createElement("div",{style:pt},i.a.createElement(ut.a,{className:e.formControl},i.a.createElement(ct.a,{id:"patient-label"},"Patient"),i.a.createElement(dt.a,{className:e.selectText,labelId:"patient-select-label",id:"patient-select",value:this.state.patientName,onChange:this.handlePatientChange},this.props.explorer.patient.keys.map((function(t,a){return i.a.createElement(mt.a,{className:e.menuItemText,value:t,key:a},t)})))),i.a.createElement(ut.a,{className:e.formControl},i.a.createElement(ct.a,{id:"study-label"},"Study"),i.a.createElement(dt.a,{className:e.selectText,labelId:"study-select-label",id:"study-select",value:this.state.study,onChange:this.handleStudyChange},this.state.studies.map((function(t,a){return i.a.createElement(mt.a,{className:e.menuItemText,value:t,key:a},t)})))),i.a.createElement("div",{style:gt},this.buildPreviewStack(this.state.series.length)))))}}]),a}(n.PureComponent),Et=Object(g.b)((function(e){return{files:e.files,explorerActivePatientIndex:e.explorerActivePatientIndex,explorerActiveStudyIndex:e.explorerActiveStudyIndex,explorerActiveSeriesIndex:e.explorerActiveSeriesIndex}}),(function(e){return{setFilesStore:function(t){return e(ue(t))},setExplorer:function(t){return e(function(e){return{type:"EXPLORER_STORE",explorer:e}}(t))},setExplorerActivePatientIndex:function(t){return e(function(e){return{type:"EXPLORER_ACTIVE_PATIENT_INDEX",explorerActivePatientIndex:e}}(t))},setExplorerActiveStudyIndex:function(t){return e(function(e){return{type:"EXPLORER_ACTIVE_STUDY_INDEX",explorerActiveStudyIndex:e}}(t))},setExplorerActiveSeriesIndex:function(t){return e(he(t))},setSeriesStore:function(t){return e(function(e){return{type:"SERIES_STORE",series:e}}(t))}}}))(Object(f.a)((function(e){return{formControl:{margin:e.spacing(1),minWidth:180},selectEmpty:{marginTop:e.spacing(2)},selectText:{fontSize:"0.85em"},menuItemText:{fontSize:"0.85em"}}}))(vt)),bt=a(267),St=a(151),yt=a(111),xt=a(269),It=a(273),Ct=a(272),Dt=a(268),wt=a(270),Ft=a(271),Ot=a(285),Mt=a(284),Rt=a(109),Pt=a.n(Rt),Lt=a(139);ke.external.cornerstone=Me;var Tt=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){var e;Object(l.a)(this,a);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).state={progress:0,cancel:!1},e.close=function(){e.props.onClose()},e.cancel=function(){e.setState({cancel:!0})},e}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=this;this.items=[],this.count=0,this.step=0;var t=this.props.files;this.step=t.length/50,this.nextProgress=this.step,this.t0=performance.now();for(var a=[],n=0;n<t.length;n++){var i=t[n];"local"===this.props.origin?a.push(ke.wadouri.fileManager.add(i)):a.push(ke.wadouri.fileManager.addBuffer(i.data))}for(var r=function(n){var i=t[n];if(e.state.cancel)return e.props.setFilesStore(null),e.close(),{v:void 0};Me.loadImage(a[n]).then((function(r){var o=function(e){var t=e.data.string("x00100010");if(void 0!==t)return t}(r),s=H(r),l=function(e){var t=e.data.string("x00080020");if(void 0!==t)return t}(r),c=function(e){var t=e.data.string("x00080030");if(void 0!==t)return t}(r),m=function(e){var t=e.data.string("x00081030");if(void 0!==t)return t}(r),u=function(e){var t=e.data.string("x00080021");if(void 0!==t)return t}(r),d=function(e){var t=e.data.string("x00080031");if(void 0!==t)return t}(r),p=function(e){var t=e.data.string("x0008103e");if(void 0!==t)return t}(r),f=function(e){var t=e.data.string("x00200011");if(void 0!==t)return parseFloat(t)}(r),g=function(e){var t=e.data.string("x00200013");if(void 0!==t)return t}(r),h=function(e){try{var t=e.data.string("x00200032").split("\\"),a=new Array(3).fill(0);a[0]=parseFloat(t[0]),a[1]=parseFloat(t[1]),a[2]=parseFloat(t[2]);var n=e.data.string("x00200037").split("\\"),i=new Array(3).fill(0).map((function(){return new Array(3).fill(0)}));i[0][0]=parseFloat(n[0]),i[0][1]=parseFloat(n[1]),i[0][2]=parseFloat(n[2]),i[1][0]=parseFloat(n[3]),i[1][1]=parseFloat(n[4]),i[1][2]=parseFloat(n[5]),i[2][0]=i[0][1]*i[1][2]-i[0][2]*i[1][1],i[2][1]=i[0][2]*i[1][0]-i[0][0]*i[1][2],i[2][2]=i[0][0]*i[1][1]-i[0][1]*i[1][0];for(var r=0,o=0;o<3;++o)r+=i[2][o]*a[o];return r}catch(s){return 0}}(r),v=X(r),E=J(r),b=function(e){var t=e.data.uint16("x00280011");if(void 0!==t)return t}(r),S=function(e){var t=e.data.uint16("x00280010");if(void 0!==t)return t}(r),y=void 0===l?void 0:function(e){var t=new Date(e.substring(0,4)+"-"+e.substring(4,6)+"-"+e.substring(6,8)),a=e.substring(9,11)+":"+e.substring(11,13)+":"+e.substring(13,15),n=t.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"});return"".concat(n," - ").concat(a)}("".concat(l,".").concat(c)),x=null;x="local"===e.props.origin?{imageId:a[n],instanceNumber:g,name:ee(i.name),image:r,rows:S,columns:b,sliceDistance:h,sliceLocation:E,patient:{patientName:o},study:{studyId:s,studyDate:l,studyTime:c,studyDateTime:y,studyDescription:m},series:{seriesDate:u,seriesTime:d,seriesDescription:p,seriesNumber:f,echoNumber:v}}:{imageId:a[n],instanceNumber:g,name:i.name,image:r,rows:S,columns:b,sliceDistance:h,sliceLocation:E,patient:{patientName:o},study:{studyId:s,studyDate:l,studyTime:c,studyDateTime:y,studyDescription:m},series:{seriesDate:u,seriesTime:d,seriesDescription:p,seriesNumber:f,echoNumber:v}},e.items.push(x),e.count++;var I=Math.floor(e.count*(100/t.length));I>e.nextProgress&&(e.nextProgress+=e.step,e.setState({progress:I})),e.count===t.length&&(e.items.sort((function(e,t){return e.instanceNumber-t.instanceNumber})),e.t1=performance.now(),console.log("performance load ".concat(e.count," images in ").concat(e.t1-e.t0," milliseconds")),e.props.setFilesStore(e.items),e.close())}),(function(t){console.log("Error in reading multiple files: ",t),e.count++})),e.count,t.length},o=0;o<t.length;o++){var s=r(o);if("object"===typeof s)return s.v}}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement(v.a,{open:!0,onClose:this.close,"aria-labelledby":"alert-dialog-title"},i.a.createElement(S.a,{id:"alert-dialog-title"},"Opening multiple files ..."),i.a.createElement(b.a,null,i.a.createElement(ze.a,{variant:"determinate",value:this.state.progress,color:"secondary"})),i.a.createElement(E.a,null,i.a.createElement(h.a,{onClick:this.cancel},"Cancel"))))}}]),a}(n.PureComponent),kt=Object(g.b)(null,(function(e){return{setFilesStore:function(t){return e(ue(t))}}}))(Tt),At={height:"calc(100vh - 48px)"},Vt=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={textFieldLabel:"",textFieldValue:"",selected:[],selectedCopy:[],visibleTextField:!1,visibleDeleteDlg:!1,visibleOthers:!1,visibleAlreadyExistDlg:!1,visibleOSaveAsDlg:!1,visibleWaiting:!1,visibleOpenMultipleFilesDlg:!1},n.doSelectUnselect=function(){var e=[];n.state.selected.length>0?n.setState({selected:e}):n.props.fsCurrentList.forEach((function(t){"dir"!==t.type&&e.push(t.name),n.setState({selected:e},(function(){}))}))},n.openSelectedFilesRetrieveItems=Object(De.a)(Ce.a.mark((function e(){return Ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.transaction("r",j.files,Object(De.a)(Ce.a.mark((function e(){return Ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.state.selected.forEach(function(){var e=Object(De.a)(Ce.a.mark((function e(t,a){return Ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.files.where({parent:n.props.fsCurrentDir,name:t}).first((function(e){void 0!==e&&"dir"!==e.type?n.files.push(e):"dir"===e.type&&j.files.where("parent").startsWithIgnoreCase(e.name).each((function(e){void 0!==e&&"dir"!==e.type&&n.files.push(e)}))}));case 2:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e)}))),n.openSelectedFiles=function(){0!==n.state.selected.length&&(n.files=[],n.openSelectedFilesRetrieveItems().then((function(){n.setState({visibleOpenMultipleFilesDlg:!0}),n.setState({selected:[]})})))},n.hideOpenMultipleFilesDlg=function(){n.setState({visibleOpenMultipleFilesDlg:!1}),n.props.files.length>1?n.props.onOpenMultipleFilesCompleted():n.props.onOpenImage(0)},n.createDir=function(){n.setState({textFieldLabel:"new folder name",visibleTextField:!n.state.visibleTextField})},n.renameItem=function(){n.lastSelected=n.state.selected[n.state.selected.length-1],n.setState({textFieldLabel:"",textFieldValue:n.lastSelected,visibleTextField:!n.state.visibleTextField})},n.previousDir=function(){if(""!==n.props.fsCurrentDir){var e=n.props.fsCurrentDir.split("/").slice(0,-1).join("/");n.props.setCurrentDir(e),n.fsListDir(e)}},n.confirmText=function(e){if(""===n.state.textFieldLabel){if(void 0!==n.props.fsCurrentList.find((function(e){return e.name===n.state.textFieldValue})))return void n.setState({visibleAlreadyExistDlg:!0});var t=n.props.fsCurrentList.find((function(e){return e.name===n.lastSelected}));if(void 0!==t){if("dir"===t.type){var a=n.fsBuildParent(t.parent,t.name),i=n.fsBuildParent(t.parent,n.state.textFieldValue);j.transaction("rw",j.files,Object(De.a)(Ce.a.mark((function e(){return Ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.files.where({parent:a}).each((function(e){j.transaction("rw",j.files,Object(De.a)(Ce.a.mark((function t(){return Ce.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,j.files.add({parent:i,name:e.name,type:e.type,size:e.size,data:e.data}).then((function(){j.files.where({parent:a}).delete()}));case 2:case"end":return t.stop()}}),t)}))))}));case 2:case"end":return e.stop()}}),e)}))))}j.transaction("rw",j.files,Object(De.a)(Ce.a.mark((function e(){return Ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.files.add({parent:t.parent,name:n.state.textFieldValue,type:t.type,size:t.size,data:t.data}).then((function(){j.files.where({parent:t.parent,name:t.name}).delete()}));case 2:case"end":return e.stop()}}),e)})))),n.setState({visibleTextField:!1}),n.fsListDir(n.props.fsCurrentDir)}}else n.setState({visibleTextField:!1},(function(){n.fsCreateDir(n.props.fsCurrentDir,n.state.textFieldValue)}))},n.cancelDir=function(){n.setState({visibleTextField:!1})},n.saveItem=function(){if(null!==n.props.localFileStore){var e=n.props.localFileStore;if(null===e)return;var t=new FileReader;t.onload=function(t){var a=t.target.result,i=ae(e.name),r=ne(ee(e.name)),o=r,s=0,l=!1,c=function(){var t=""===i?o:"".concat(o,".").concat(i);void 0===n.props.fsCurrentList.find((function(e){return e.name===t}))?(j.transaction("rw",j.files,Object(De.a)(Ce.a.mark((function o(){return Ce.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.next=2,j.files.add({parent:n.props.fsCurrentDir,name:t,type:""===i?te(r):i,size:e.size,data:a});case 2:case"end":return o.stop()}}),o)})))).then((function(){n.fsListDir(n.props.fsCurrentDir)})),l=!0):(o="".concat(r," - Copy"),s>0&&(o="".concat(o," (").concat(s,")")),s++)};do{c()}while(!l)},t.readAsArrayBuffer(e)}else null!==n.props.fsFileStore&&function(){var e=n.props.fsFileStore,t=e.data,a=ae(e.name),i=ne(ee(e.name)),r=i,o=0,s=!1,l=function(){var l=""===a?r:"".concat(r,".").concat(a);void 0===n.props.fsCurrentList.find((function(e){return e.name===l}))?(j.transaction("rw",j.files,Object(De.a)(Ce.a.mark((function a(){return Ce.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,j.files.add({parent:n.props.fsCurrentDir,name:l,type:te(i),size:e.size,data:t});case 2:case"end":return a.stop()}}),a)})))).then((function(){n.fsListDir(n.props.fsCurrentDir)})),s=!0):(r="".concat(i," - Copy"),o>0&&(r="".concat(r," (").concat(o,")")),o++)};do{l()}while(!s)}()},n.copyItem=function(){var e=[];n.state.selected.forEach((function(t){var a=n.props.fsCurrentList.find((function(e){return e.name===t}));void 0!==a&&e.push({parent:a.parent,name:a.name})})),n.setState({selectedCopy:e})},n.cutItem=function(){var e=[];n.state.selected.forEach((function(t){var a=n.props.fsCurrentList.find((function(e){return e.name===t}));void 0!==a&&e.push({parent:a.parent,name:a.name})})),n.setState({selectedCopy:e}),n.cut=!0},n.pasteItem=function(){n.state.selectedCopy.forEach(function(){var e=Object(De.a)(Ce.a.mark((function e(t,a){return Ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.files.where({parent:t.parent,name:t.name}).first((function(e){if(void 0!==e)if("dir"===e.type){var t=0,a=!1,i=e.name,r=function(){var r=i;void 0===n.props.fsCurrentList.find((function(e){return e.name===r}))?a=!0:(i="".concat(e.name," - Copy"),t>0&&(i="".concat(i," (").concat(t,")")),t++)};do{r()}while(!a);j.files.add({parent:n.props.fsCurrentDir,name:i,type:e.type,size:e.size,data:e.data});var o=n.fsBuildParent(e.parent,e.name),s=n.fsBuildParent(n.props.fsCurrentDir,i),l=[];j.files.where("parent").startsWithIgnoreCase(o).each((function(e){l.push(e)})).then((function(){l.forEach((function(e){j.files.add({parent:s,name:e.name,type:e.type,size:e.size,data:e.data})}))}))}else{var c=ae(e.name),m=ne(e.name),u=m,d=0,p=!1,f=function(){var t=""===c?u:"".concat(u,".").concat(c);void 0===n.props.fsCurrentList.find((function(e){return e.name===t}))?(j.transaction("rw",j.files,Object(De.a)(Ce.a.mark((function a(){return Ce.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,j.files.add({parent:n.props.fsCurrentDir,name:t,type:e.type,size:e.size,data:e.data});case 2:case"end":return a.stop()}}),a)})))),p=!0):(u="".concat(m," - Copy"),d>0&&(u="".concat(u," (").concat(d,")")),d++)};do{f()}while(!p)}}));case 2:a===n.state.selectedCopy.length-1&&(n.cut&&(n.state.selectedCopy.forEach((function(e){j.files.where({parent:e.parent,name:e.name}).delete()})),n.setState({selectedCopy:[]}),n.cut=!1),n.fsListDir(n.props.fsCurrentDir));case 3:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()),n.setState({selected:[]})},n.deleteItem=function(){n.state.selected.forEach((function(e){var t=n.props.fsCurrentList.find((function(t){return t.name===e}));void 0!==t&&("dir"===t.type&&j.files.where("parent").startsWithIgnoreCase(n.fsBuildParent(t.parent,t.name)).delete(),j.files.where({parent:t.parent,name:t.name}).delete().then((function(){n.fsListDir(n.props.fsCurrentDir)})))})),n.setState({selected:[]})},n.showOthers=function(){n.setState({visibleOthers:!n.state.visibleOthers})},n.exportItem=function(){0!==n.state.selected.length&&n.setState({visibleOSaveAsDlg:!0})},n.itemClick=function(e,t){var a=n.state.selected.indexOf(t.name),i=[];-1===a?i=i.concat(n.state.selected,t.name):a>=0&&(i=i.concat(n.state.selected.slice(0,a),n.state.selected.slice(a+1))),n.setState({selected:i},(function(){}))},n.itemDoubleClick=function(e,t){if("dir"===t.type){n.setState({visibleWaiting:!0});var a=n.fsBuildParent(t.parent,t.name);n.props.setCurrentDir(a),n.fsListDir(a)}else"DICOMDIR"===t.name?n.props.onOpenDicomdir(t):(n.props.setFsFileStore(t),n.props.onOpen(t))},n.showDeleteDlg=function(){n.setState({visibleDeleteDlg:!0})},n.hideDeleteDlg=function(){n.setState({visibleDeleteDlg:!1})},n.confirmDeleteDlg=function(){n.hideDeleteDlg(),n.deleteItem()},n.hideAlreadyExistDlg=function(){n.setState({visibleAlreadyExistDlg:!1})},n.hideSaveAs=function(){n.setState({visibleOSaveAsDlg:!1})},n.closeSaveAs=function(){var e="".concat(n.saveAsField.value,".zip");n.setState({visibleOSaveAsDlg:!1},(function(){var t=new Pt.a,a=[];j.files.where("parent").startsWithIgnoreCase(n.props.fsCurrentDir).each((function(e){(n.state.selected.indexOf(e.parent)>=0||n.state.selected.indexOf(e.name)>=0)&&a.push(e)})).then((function(){a.forEach((function(e){"dir"!==e.type&&t.folder(e.parent).file(e.name,e.data)})),t.generateAsync({type:"blob"}).then((function(t){Object(Lt.saveAs)(t,e)}))}))}))},n.mouseDown=function(e,t){n.timer=setTimeout((function(){n.itemDoubleClick(e,t)}),500)},n.mouseUp=function(e){clearTimeout(n.timer)},n.files=[],n.cut=!1,n.itemsCount=0,n.saveAsField=i.a.createRef(),n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){this.fsListDir(this.props.fsCurrentDir)}},{key:"componentDidUpdate",value:function(e){var t=this;if(null!==this.props.fsZippedFile){var a=new Pt.a;a.loadAsync(this.props.fsZippedFile).then((function(e){e.forEach((function(e,n){n.dir||a.file(e).async("uint8array").then((function(a){t.fsAddItem(e,a)}))}))})).then((function(){t.props.setFsZippedFile(null)}))}}},{key:"fsBuildParent",value:function(e,t){var a="";return""===e?""!==t&&(a=t):a=""!==t?"".concat(e,"/").concat(t):e,a}},{key:"fsAddItem",value:function(e,t){var a=this,n=e.split("/"),i=n.pop(),r=this.fsBuildParent(this.props.fsCurrentDir,n.join("/"));j.transaction("rw",j.files,Object(De.a)(Ce.a.mark((function e(){return Ce.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.files.add({parent:r,name:i,type:te(i),size:t.length,data:t});case 2:case"end":return e.stop()}}),e)})))).then((function(){for(var e=function(){var e=n.pop(),t=a.fsBuildParent(a.props.fsCurrentDir,n.join("/"));j.transaction("rw",j.files,Object(De.a)(Ce.a.mark((function a(){return Ce.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,j.files.put({parent:t,name:e,type:"dir",size:""});case 2:case"end":return a.stop()}}),a)})))).then((function(){a.fsListDir(a.props.fsCurrentDir)}))};n.length>0;)e()}))}},{key:"fsExistDir",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=this.props.fsCurrentList.find((function(t){return t.name===e}));return void 0!==a&&(!!t&&(this.fsCreateDir(this.props.fsCurrentDir,e),!0))}},{key:"fsListDir",value:function(e){var t=this,a=[];j.transaction("r",j.files,(function(){j.files.where({parent:e,type:"dir"}).sortBy("name").then((function(e){a=e})).then((function(){j.files.where({parent:e}).and((function(e){return"dir"!==e.type})).sortBy("name").then((function(e){a=a.concat(e)})).then((function(){t.props.setCurrentList(a),setTimeout((function(){return t.setState({visibleWaiting:!1})}),1e3)}))}))}))}},{key:"fsCreateDir",value:function(e,t){var a=this;j.files.add({parent:e,name:t,type:"dir",size:""}).then((function(){a.fsListDir(a.props.fsCurrentDir)}))}},{key:"render",value:function(){var e=this,t=this.props.classes,a=this.state.visibleTextField,n=this.state.visibleOthers,r=this.state.visibleDeleteDlg,o=this.state.visibleAlreadyExistDlg,s=this.state.visibleOSaveAsDlg,l=this.state.visibleOpenMultipleFilesDlg,c=this.state.visibleWaiting,m=null;m="bottom"===oe()?{marginTop:"0px",height:"275px"}:{marginTop:"48px",width:"350px"};var u="";return u=this.state.selected.length>0?"(".concat(this.state.selected.length," / ").concat(this.props.fsCurrentList.length," items)"):"(".concat(this.props.fsCurrentList.length," items)"),i.a.createElement(A.a,null,i.a.createElement("div",{style:At},i.a.createElement("div",{style:m},a?i.a.createElement(yt.a,{component:"form",className:t.textPaper},i.a.createElement(St.a,{autoFocus:!0,className:t.textInput,placeholder:this.state.textFieldLabel,defaultValue:this.state.textFieldValue,onChange:function(t){e.setState({textFieldValue:t.target.value})}}),i.a.createElement(Ue.a,{className:t.textButton,onClick:this.confirmText},i.a.createElement(Be.a,{path:Ge.h,size:"1.2rem",color:this.props.color})),i.a.createElement(Ue.a,{className:t.textButton,onClick:this.cancelDir},i.a.createElement(Be.a,{path:Ge.l,size:"1.2rem",color:this.props.color}))):i.a.createElement("div",null,i.a.createElement("div",null,i.a.createElement(et.a,{variant:"dense"},i.a.createElement("div",{className:t.leftButtons},c?i.a.createElement(bt.a,{style:{marginLeft:"10px"},size:20,color:"secondary"}):i.a.createElement(Mt.a,{title:"Previous folder"},i.a.createElement(Ue.a,{color:"inherit",onClick:this.previousDir},i.a.createElement(Be.a,{path:Ge.k,size:"1.2rem",color:this.props.color})))),i.a.createElement("div",{className:t.toolbarButtons},i.a.createElement(Mt.a,{title:"Select/unselect all files"},i.a.createElement(Ue.a,{color:"inherit",onClick:this.doSelectUnselect},i.a.createElement(Be.a,{path:Ge.i,size:"1.2rem",color:this.props.color}))),i.a.createElement(Mt.a,{title:"Open selected files"},i.a.createElement(Ue.a,{color:"inherit",onClick:this.openSelectedFiles},i.a.createElement(Be.a,{path:Ge.F,size:"1.2rem",color:this.props.color}))),i.a.createElement(Mt.a,{title:"Create a new directory"},i.a.createElement(Ue.a,{color:"inherit",onClick:this.createDir},i.a.createElement(Be.a,{path:Ge.G,size:"1.2rem",color:this.props.color}))),i.a.createElement(Mt.a,{title:"Rename the last selected item"},i.a.createElement(Ue.a,{color:"inherit",onClick:this.renameItem},i.a.createElement(Be.a,{path:Ge.V,size:"1.2rem",color:this.props.color}))),i.a.createElement(Ue.a,{color:"inherit",onClick:this.showOthers},i.a.createElement(Be.a,{path:Ge.v,size:"1.2rem",color:this.props.color}))))),n?i.a.createElement("div",null,i.a.createElement(et.a,{variant:"dense"},i.a.createElement("div",{className:t.toolbarButtons},i.a.createElement(Mt.a,{title:"Move the selected items to the clipboard"},i.a.createElement(Ue.a,{color:"inherit",onClick:this.cutItem},i.a.createElement(Be.a,{path:Ge.o,size:"1.2rem",color:this.props.color}))),i.a.createElement(Mt.a,{title:"Copy the selected items to the clipboard"},i.a.createElement(Ue.a,{color:"inherit",onClick:this.copyItem},i.a.createElement(Be.a,{path:Ge.n,size:"1.2rem",color:this.props.color}))),i.a.createElement(Mt.a,{title:"Paste clipboard contents to current location"},i.a.createElement(Ue.a,{color:"inherit",onClick:this.pasteItem},i.a.createElement(Be.a,{path:Ge.p,size:"1.2rem",color:this.props.color}))),i.a.createElement(Mt.a,{title:"Delete the selected items"},i.a.createElement(Ue.a,{color:"inherit",onClick:this.showDeleteDlg},i.a.createElement(Be.a,{path:Ge.u,size:"1.2rem",color:this.props.color}))),i.a.createElement(Mt.a,{title:"Save the opened image to sandbox file system"},i.a.createElement(Ue.a,{color:"inherit",onClick:this.saveItem},i.a.createElement(Be.a,{path:Ge.q,size:"1.2rem",color:this.props.color}))),i.a.createElement(Mt.a,{title:"Export the selected items as zipped archive"},i.a.createElement(Ue.a,{color:"inherit",onClick:this.exportItem},i.a.createElement(Be.a,{path:Ge.x,size:"1.2rem",color:this.props.color})))))):null,i.a.createElement("div",null,i.a.createElement("div",null,i.a.createElement(D.a,{type:"caption text",style:{fontSize:"0.75em",marginLeft:"15px",color:"rgba(146, 146, 146, 1)",float:"left"}},"/"+this.props.fsCurrentDir+" ")),i.a.createElement("div",null,i.a.createElement(D.a,{type:"caption text",style:{fontSize:"0.75em",marginRight:"5px",color:"rgba(146, 146, 146, 1)",float:"right"}},u))),c?i.a.createElement("div",{style:{marginTop:"20px",position:"absolute"}},i.a.createElement(ze.a,{color:"secondary"})):null),i.a.createElement("div",{style:{height:"200px"}},i.a.createElement(Dt.a,{component:yt.a},i.a.createElement(xt.a,{className:t.table,size:"small"},i.a.createElement(wt.a,null,i.a.createElement(Ft.a,null,i.a.createElement(Ct.a,null,"Name"),i.a.createElement(Ct.a,{align:"left"},"Type"),i.a.createElement(Ct.a,{align:"left"},"Size"))),i.a.createElement(It.a,null,this.props.fsCurrentList.map((function(a){var n,r=(n=a.name,-1!==e.state.selected.indexOf(n));return i.a.createElement(Ft.a,{key:"".concat(a.parent,"/").concat(a.name),role:"button",hover:!0,selected:r,onClick:function(t){e.itemClick(t,a)},onDoubleClick:function(t){e.itemDoubleClick(t,a)},onTouchStart:function(t){return e.mouseDown(t,a)},onTouchEnd:function(t){return e.mouseUp(t,a)},onMouseDown:function(t){return e.mouseDown(t,a)},onMouseUp:function(t){return e.mouseUp(t,a)}},i.a.createElement(Ct.a,{component:"th",scope:"row"},i.a.createElement(D.a,{className:t.tableCellText},a.name)),i.a.createElement(Ct.a,{align:"left"},a.type),i.a.createElement(Ct.a,{align:"left"},function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;if(""===e)return"";if(0===e)return"0 Bytes";var a=1024,n=t<0?0:t,i=["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"],r=Math.floor(Math.log(e)/Math.log(a));return parseFloat((e/Math.pow(a,r)).toFixed(n))+" "+i[r]}(a.size)))})))))),i.a.createElement(v.a,{open:r,onClose:this.hideDeleteDlg},i.a.createElement(S.a,null,"Are you sure to delete selected items?"),i.a.createElement(E.a,null,i.a.createElement(h.a,{onClick:this.hideDeleteDlg},"Cancel"),i.a.createElement(h.a,{onClick:this.confirmDeleteDlg,autoFocus:!0},"Ok"))),i.a.createElement(v.a,{open:o,onClose:this.hideAlreadyExistDlg},i.a.createElement(S.a,null,"An item with this name already exists!"),i.a.createElement(E.a,null,i.a.createElement(h.a,{onClick:this.hideAlreadyExistDlg,autoFocus:!0},"Ok"))),i.a.createElement(v.a,{open:s},i.a.createElement(S.a,null,"Export archive"),i.a.createElement(b.a,null,i.a.createElement(we.a,null,"Specify a file name for the archive:"),i.a.createElement(Ot.a,{autoFocus:!0,margin:"dense",id:"id-open-url",inputRef:function(t){return e.saveAsField=t},fullWidth:!0})),i.a.createElement(E.a,null,i.a.createElement(h.a,{onClick:function(){return e.hideSaveAs()}},"Cancel"),i.a.createElement(h.a,{onClick:function(){return e.closeSaveAs()}},"Ok"))),l?i.a.createElement(kt,{onClose:this.hideOpenMultipleFilesDlg,files:this.files,origin:"fs"}):null)))}}]),a}(n.PureComponent),zt=Object(g.b)((function(e){return{files:e.files,localFileStore:e.localFile,fsFileStore:e.fsFile,activeDcm:e.activeDcm,fsCurrentDir:e.fsCurrentDir,fsCurrentList:e.fsCurrentList,fsZippedFile:e.fsZippedFile,fsRefresh:e.fsRefresh}}),(function(e){return{setCurrentDir:function(t){return e(function(e){return{type:"FSCURRENTDIR",fsCurrentDir:e}}(t))},setCurrentList:function(t){return e(function(e){return{type:"FSCURRENTLIST",fsCurrentList:e}}(t))},setFsZippedFile:function(t){return e(ve(t))},setFsFileStore:function(t){return e(me(t))}}}))(Object(f.a)((function(e){return{table:{minWidth:250},tableCellText:{fontSize:"0.80em"},toolbarButtons:{marginLeft:"auto",marginRight:-20},leftButtons:{marginLeft:-25},textPaper:{padding:"2px 4px",display:"flex",alignItems:"center",width:250},textInput:{marginLeft:e.spacing(1),flex:1},textButton:{padding:10}}}))(Vt)),jt=a(286),Nt={width:"273px",padding:"8px 8px 8px 8px",backgroundColor:"#444444"},Bt={width:"255px",marginTop:"-9px"},Ut={marginTop:"-9px"},Gt={borderCollapse:"collapse",fontFamily:"Courier, monospace",fontSize:"67%",width:"100%"},Wt={tableLayout:"fixed",width:"25%"},Zt=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={activeDrags:0,deltaPosition:{x:0,y:0},controlledPosition:{x:-400,y:200},value:128,histCount:0,valueScale:0,minHist:0,maxHist:0,mean:0,stdDev:0,indexDcm:-1},n.handleChangeValue=function(e,t){n.setState({value:t}),n.setState({valueScale:t*n.binSize+n.state.minHist}),n.setState({histCount:n.hist256[t]})},n.hide=function(){n.props.onClose()},n.onDrag=function(e,t){var a=n.state.deltaPosition,i=a.x,r=a.y;n.setState({deltaPosition:{x:i+t.deltaX,y:r+t.deltaY}})},n.onStart=function(){n.setState({activeDrags:n.state.activeDrags+1})},n.onStop=function(){n.setState({activeDrags:n.state.activeDrags-1})},n.canvasHistogram=i.a.createRef(),n.canvasGradient=i.a.createRef(),n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){var e=this.canvasHistogram.current,t=this.canvasHistogram.current.getContext("2d");t.translate(0,e.height),t.scale(1,-1),this.updateCanvas()}},{key:"componentDidUpdate",value:function(){this.state.indexDcm!==this.props.activeDcmIndex&&(this.setState({indexDcm:this.props.activeDcmIndex}),this.updateCanvas())}},{key:"getMousePos",value:function(e,t){var a=e.getBoundingClientRect();return{x:t.clientX-a.left,y:t.clientY-a.top}}},{key:"getRGBPixelsImage",value:function(e,t,a,n){var i=this.props.activeDcm.image.getPixelData(),r=[];e=Math.round(e),t=Math.round(t);var o,s,l,c=0;for(s=0;s<n;s++)for(l=0;l<a;l++){var m=i[o=4*((s+t)*this.props.activeDcm.image.rows+(l+e))],u=i[o+1],d=i[o+2],p=i[o+3];r[c++]=m,r[c++]=u,r[c++]=d,r[c++]=p}return r}},{key:"getPixelsImage",value:function(e,t,a,n){var i=this.props.activeDcm.image.getPixelData(),r=[];e=Math.round(e),t=Math.round(t);var o,s,l,c=0;for(s=0;s<n;s++)for(l=0;l<a;l++)o=(s+t)*this.props.activeDcm.image.rows+(l+e),r[c++]=i[o];return r}},{key:"getPixel",value:function(e,t){return(this.props.activeDcm.isDicom?this.props.activeDcm.image.color?this.getRGBPixelsImage(e,t,1,1):this.getPixelsImage(e,t,1,1):this.getRGBPixelsImage(e,t,1,1))[0]}},{key:"updateCanvas",value:function(){var e=this;if(null!==this.props.activeDcm){var t=this.props.activeDcm.image;if(null!==t){var a=t.maxPixelValue,n=t.minPixelValue+t.intercept,i=a+t.intercept,r=i-n+1,o=r/256,s=Math.floor(Math.abs(n)/o),l=Math.round(t.windowWidth/o/2),c=Math.round(t.windowCenter/o);this.setState({minHist:n}),this.setState({maxHist:i}),this.binSize=o;for(var m=0,u=Array(r).fill(0),d=0;d<t.columns;d++)for(var p=0;p<t.rows;p++){var f=this.getPixel(p,d)*t.slope+t.intercept;u[f-n]+=1,m+=f}m/=t.columns*t.rows,this.setState({mean:m});for(var g=0,h=0;h<t.columns;h++)for(var v=0;v<t.rows;v++){var E=this.getPixel(v,h)*t.slope+t.intercept;g+=Math.pow(E-m,2)}g=Math.sqrt(g/(t.columns*t.rows)),this.setState({stdDev:g});var b=Array(256).fill(0),S=0;if(o<1)for(var y=Math.round(256/r),x=0,I=0;I<256;){for(var C=0;C<y;C++)b[I]=x<r?u[x]:0,S<b[I]&&(S=b[I]),I++;x++}else for(var D=0,w=0;w<256;w++){for(var F=D;F<Math.round(D+o)&&!(F>=r);F++)b[w]+=u[F];S<b[w]&&(S=b[w]),D=Math.round(D+o)}this.hist256=b,S/128>100&&(S/=5);var O=this.canvasHistogram.current,M=this.canvasHistogram.current.getContext("2d");M.clearRect(0,0,M.canvas.width,M.canvas.height),O.addEventListener("pointermove",(function(t){var a=e.getMousePos(O,t);e.setState({histCount:b[a.x]});var i=Math.round(a.x*e.binSize);e.setState({valueScale:i+n})}),!0);var R=Math.round((m-n)/o);this.setState({value:R,valueScale:m,histCount:b[R]}),M.beginPath(),M.fillStyle="rgba(210, 210, 210, 0.5)",M.fillRect(s-l+c,0,2*l,128),M.beginPath(),M.strokeStyle="rgba(0, 0, 0, 1.0)";for(var P=0;P<256;P++){var L=Math.round(b[P]/S*128);M.moveTo(P,0),M.lineTo(P,L),M.stroke()}M.beginPath(),M.strokeStyle="rgba(140, 140, 140, 0.5)",M.moveTo(s+c,0),M.lineTo(s+c,128),M.lineWidth=1,M.stroke();var T=s-l+c,k=s+l+c,A=this.canvasGradient.current.getContext("2d");A.fillStyle="#000000",A.fillRect(0,0,T,10);var V=A.createLinearGradient(T,0,k+(T<0?T:0),0);V.addColorStop(0,"black"),V.addColorStop(1,"white"),A.fillStyle=V,A.fillRect(T,0,k,10)}}}},{key:"render",value:function(){return i.a.createElement("div",{style:Nt},i.a.createElement("div",null,i.a.createElement("canvas",{ref:this.canvasHistogram,width:256,height:128,style:{backgroundColor:"#FFFFFF",cursor:"crosshair"}})),i.a.createElement("div",{style:Ut},i.a.createElement("canvas",{ref:this.canvasGradient,width:256,height:10,style:{backgroundColor:"#FFFFFF"}})),i.a.createElement("div",{style:Bt},i.a.createElement(jt.a,{value:this.state.value,onChange:this.handleChangeValue,"aria-labelledby":"continuous-slider",color:"secondary",min:0,max:255})),i.a.createElement("div",null,i.a.createElement("table",{style:Gt},i.a.createElement("tbody",null,i.a.createElement("tr",null,i.a.createElement("td",{style:Wt},"min:"),i.a.createElement("td",{style:Wt},this.state.minHist),i.a.createElement("td",{style:Wt},"max:"),i.a.createElement("td",{style:Wt},this.state.maxHist)),i.a.createElement("tr",null,i.a.createElement("td",null,"mean:"),i.a.createElement("td",null,parseFloat(this.state.mean).toFixed(3)),i.a.createElement("td",null,"std dev:"),i.a.createElement("td",null,parseFloat(this.state.stdDev).toFixed(3))),i.a.createElement("tr",null,i.a.createElement("td",null,"count:"),i.a.createElement("td",null,this.state.histCount),i.a.createElement("td",null,"value:"),i.a.createElement("td",null,parseFloat(this.state.valueScale).toFixed(3)))))))}}]),a}(n.PureComponent),Ht=Object(g.b)((function(e){return{activeDcmIndex:e.activeDcmIndex,activeDcm:e.activeDcm}}))(Zt),_t={borderCollapse:"collapse",width:"100px",height:"100px"},Xt={width:"25px",height:"25px",border:"solid 1px black"},Jt=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).initTable=function(){for(var e=n.state.row,t=n.state.col,a=n.tableRef.current.rows,i=0;i<=e;i++)for(var r=0;r<=t;r++)a[i].cells[r].bgColor="#AAAAAA"},n.cellClick=function(e){var t=e.target.parentNode.rowIndex,a=e.target.cellIndex;n.setState({row:t,col:a});for(var i=n.tableRef.current.rows,r=0;r<=3;r++)for(var o=0;o<=3;o++)i[r].cells[o].bgColor="#444444";for(var s=0;s<=t;s++)for(var l=0;l<=a;l++)i[s].cells[l].bgColor="#AAAAAA";n.props.onChange(t+1,a+1)},n.tableRef=i.a.createRef(),n.state={row:n.props.row,col:n.props.col},n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){this.initTable()}},{key:"renderTable",value:function(){var e=this;return["","","",""].map((function(t,a){return i.a.createElement("tr",{key:"".concat(a)},i.a.createElement("td",{style:Xt,onClick:e.cellClick}),i.a.createElement("td",{style:Xt,onClick:e.cellClick}),i.a.createElement("td",{style:Xt,onClick:e.cellClick}),i.a.createElement("td",{style:Xt,onClick:e.cellClick}))}))}},{key:"render",value:function(){return i.a.createElement("div",null,i.a.createElement("table",{style:_t,ref:this.tableRef},i.a.createElement("tbody",null,this.renderTable())))}}]),a}(n.PureComponent),Yt={borderCollapse:"collapse",width:"120px",height:"120px"},qt={width:"40px",height:"40px",padding:"3px"},Qt=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).colorIcon=function(e){return n.props.toolActive===e?"rgba(0, 255, 0, 1.0)":"#FFFFFF"},n.tableRef=i.a.createRef(),n}return Object(c.a)(a,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this;return i.a.createElement("div",null,i.a.createElement("table",{style:Yt,ref:this.tableRef},i.a.createElement("tbody",null,i.a.createElement("tr",null,i.a.createElement("td",{style:qt},i.a.createElement(Mt.a,{title:"No Tool"},i.a.createElement(Ue.a,{color:"inherit",onClick:function(){return e.props.toolExecute("notool")}},i.a.createElement(Be.a,{path:Ge.r,size:"1.2rem",color:this.colorIcon("notool")})))),i.a.createElement("td",{style:qt},i.a.createElement(Mt.a,{title:"Reference Lines"},i.a.createElement(Ue.a,{color:"inherit",onClick:function(){return e.props.toolExecute("referencelines")}},i.a.createElement(Be.a,{path:Ge.d,size:"1.2rem",color:this.props.referenceLines?"rgba(0, 255, 0, 1.0)":"#FFFFFF"})))),i.a.createElement("td",{style:qt},i.a.createElement(Mt.a,{title:"Link Series"},i.a.createElement(Ue.a,{color:"inherit",onClick:function(){return e.props.toolExecute("serieslink")}},i.a.createElement(Be.a,{path:Ge.Y,size:"1.2rem",color:this.props.seriesLink?"rgba(0, 255, 0, 1.0)":"#FFFFFF"}))))),i.a.createElement("tr",null,i.a.createElement("td",{style:qt},i.a.createElement(Mt.a,{title:"WW/WC"},i.a.createElement(Ue.a,{color:"inherit",onClick:function(){return e.props.toolExecute("Wwwc")}},i.a.createElement(Be.a,{path:Ge.c,size:"1.2rem",color:this.colorIcon("Wwwc")})))),i.a.createElement("td",{style:qt},i.a.createElement(Mt.a,{title:"Pan"},i.a.createElement(Ue.a,{color:"inherit",onClick:function(){return e.props.toolExecute("Pan")}},i.a.createElement(Be.a,{path:Ge.s,size:"1.2rem",color:this.colorIcon("Pan")})))),i.a.createElement("td",{style:qt},i.a.createElement(Mt.a,{title:"Zoom"},i.a.createElement(Ue.a,{color:"inherit",onClick:function(){return e.props.toolExecute("Zoom")}},i.a.createElement(Be.a,{path:Ge.L,size:"1.2rem",color:this.colorIcon("Zoom")}))))),i.a.createElement("tr",null,i.a.createElement("td",{style:qt},i.a.createElement(Mt.a,{title:"Magnify"},i.a.createElement(Ue.a,{color:"inherit",onClick:function(){return e.props.toolExecute("Magnify")}},i.a.createElement(Be.a,{path:Ge.j,size:"1.2rem",color:this.colorIcon("Magnify")})))),i.a.createElement("td",{style:qt},i.a.createElement(Mt.a,{title:"Length"},i.a.createElement(Ue.a,{color:"inherit",onClick:function(){return e.props.toolExecute("Length")}},i.a.createElement(Be.a,{path:Ge.Q,size:"1.2rem",color:this.colorIcon("Length")})))),i.a.createElement("td",{style:qt},i.a.createElement(Mt.a,{title:"Probe"},i.a.createElement(Ue.a,{color:"inherit",onClick:function(){return e.props.toolExecute("Probe")}},i.a.createElement(Be.a,{path:Ge.y,size:"1.2rem",color:this.colorIcon("Probe")}))))),i.a.createElement("tr",null,i.a.createElement("td",{style:qt},i.a.createElement(Mt.a,{title:"Angle"},i.a.createElement(Ue.a,{color:"inherit",onClick:function(){return e.props.toolExecute("Angle")}},i.a.createElement(Be.a,{path:Ge.a,size:"1.2rem",color:this.colorIcon("Angle")})))),i.a.createElement("td",{style:qt},i.a.createElement(Mt.a,{title:"Elliptical Roi"},i.a.createElement(Ue.a,{color:"inherit",onClick:function(){return e.props.toolExecute("EllipticalRoi")}},i.a.createElement(Be.a,{path:Ge.w,size:"1.2rem",color:this.colorIcon("EllipticalRoi")})))),i.a.createElement("td",{style:qt},i.a.createElement(Mt.a,{title:"Rectangle Roi"},i.a.createElement(Ue.a,{color:"inherit",onClick:function(){return e.props.toolExecute("RectangleRoi")}},i.a.createElement(Be.a,{path:Ge.O,size:"1.2rem",color:this.colorIcon("RectangleRoi")}))))),i.a.createElement("tr",null,i.a.createElement("td",{style:qt},i.a.createElement(Mt.a,{title:"Freehand Roi"},i.a.createElement(Ue.a,{color:"inherit",onClick:function(){return e.props.toolExecute("FreehandRoi")}},i.a.createElement(Be.a,{path:Ge.H,size:"1.2rem",color:this.colorIcon("FreehandRoi")}))))))))}}]),a}(n.PureComponent),Kt=a(141),$t=a.n(Kt),ea=a(142),ta=a.n(ea),aa=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(l.a)(this,a),(n=t.call(this,e)).state={visibleDlgNote:!1,visibleDlgDelete:!1},n.showDlgNote=function(){n.setState({visibleDlgNote:!0})},n.hideDlgNote=function(){n.setState({visibleDlgNote:!1})},n.showDlgDelete=function(){n.setState({visibleDlgDelete:!0})},n.hideDlgDelete=function(){n.setState({visibleDlgDelete:!1})},n.handleOnChangeNote=function(e){n.setState({note:e.target.value})},n.confirmNote=function(e){n.hideDlgNote(),n.props.measurements[e].note=n.noteField.value},n.confirmDelete=function(e){n.hideDlgDelete(),n.props.toolRemove(e)},n.onEdit=function(){n.showDlgNote()},n.onDelete=function(){n.showDlgDelete()},n.noteField=i.a.createRef(),n}return Object(c.a)(a,[{key:"render",value:function(){var e=this,t=this.props.classes,a=this.props.item,n=this.props.index,r="",o="";switch(a.tool){case"Length":r="".concat(a.data.length.toFixed(2)," ").concat(a.data.unit),o=a.note;break;case"Angle":r="".concat(a.data.rAngle," \xb0"),o=a.note;break;case"EllipticalRoi":case"RectangleRoi":r=i.a.createElement("div",null,i.a.createElement("div",null," A: ",a.data.cachedStats.area.toFixed(2)," mm\xb2 "),i.a.createElement("div",null," M: ",a.data.cachedStats.mean.toFixed(2)," ",a.data.unit," "),i.a.createElement("div",null," SD: ",a.data.cachedStats.stdDev.toFixed(2)," ",a.data.unit," ")),o=a.note;break;case"FreehandRoi":r=i.a.createElement("div",null,i.a.createElement("div",null," A: ",a.data.area.toFixed(2)," mm\xb2 "),i.a.createElement("div",null," M: ",a.data.meanStdDev.mean.toFixed(2)," ",a.data.unit," "),i.a.createElement("div",null," SD: ",a.data.meanStdDev.stdDev.toFixed(2)," ",a.data.unit," ")),o=a.note}return i.a.createElement("div",null,i.a.createElement(I.a,null,i.a.createElement(C.a,{classes:{primary:t.listItemText},primary:r,secondary:o}),i.a.createElement(et.a,null,i.a.createElement(Ue.a,{edge:"end",onClick:function(){return e.onEdit(n)}},i.a.createElement($t.a,null)),i.a.createElement(Ue.a,{edge:"end",onClick:function(){return e.onDelete(n)}},i.a.createElement(ta.a,null)))),this.state.visibleDlgNote?i.a.createElement(v.a,{open:this.state.visibleDlgNote,onClose:this.hideDlgNote,"aria-labelledby":"form-dialog-title"},i.a.createElement(S.a,{id:"form-dialog-title"},"Note for measurement:"),i.a.createElement(b.a,null,i.a.createElement(Ot.a,{ref:"noteField",autoFocus:!0,margin:"dense",id:"note",fullWidth:!0,defaultValue:this.props.measurements[n].note,inputRef:function(t){return e.noteField=t}})),i.a.createElement(E.a,null,i.a.createElement(h.a,{onClick:this.hideDlgNote},"Cancel"),i.a.createElement(h.a,{onClick:function(){return e.confirmNote(n)},autoFocus:!0},"Ok"))):null,i.a.createElement(v.a,{open:this.state.visibleDlgDelete,onClose:this.hideDlgNote,"aria-labelledby":"alert-dialog-title"},i.a.createElement(S.a,{id:"alert-dialog-title"},"Are you sure to delete the measurement?"),i.a.createElement(E.a,null,i.a.createElement(h.a,{onClick:this.hideDlgDelete},"Cancel"),i.a.createElement(h.a,{onClick:function(){return e.confirmDelete(n)},autoFocus:!0},"Ok"))))}}]),a}(n.PureComponent),na=Object(g.b)((function(e){return{measurements:e.measurements}}))(Object(f.a)((function(e){return{listItemText:{fontSize:"0.9em"}}}))(aa)),ia=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(){var e;Object(l.a)(this,a);for(var n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))).state={visibleClearMeasureDlg:!1},e.showClearMeasureDlg=function(){e.setState({visibleClearMeasureDlg:!0})},e.hideClearMeasureDlg=function(){e.setState({visibleClearMeasureDlg:!1})},e.confirmClearMeasureDlg=function(){e.hideClearMeasureDlg(),e.dicomViewersRefs[e.props.activeDcmIndex].runTool("removetools")},e}return Object(c.a)(a,[{key:"render",value:function(){var e=this;return i.a.createElement("div",null,i.a.createElement("div",null,null!==this.props.measurements?this.props.measurements.map((function(t,a){return i.a.createElement(na,{item:t,index:a,toolRemove:e.props.toolRemove,key:a})})):null),i.a.createElement(v.a,{open:this.state.visibleClearMeasureDlg,onClose:this.hideClearMeasureDlg,"aria-labelledby":"alert-dialog-title"},i.a.createElement(S.a,{id:"alert-dialog-title"},"Are you sure to remove all the measurements?"),i.a.createElement(E.a,null,i.a.createElement(h.a,{onClick:this.hideClearMeasureDlg},"Cancel"),i.a.createElement(h.a,{onClick:this.confirmClearMeasureDlg,autoFocus:!0},"Ok"))))}}]),a}(n.PureComponent),ra=Object(g.b)((function(e){return{measurements:e.measurements}}))(ia),oa=a(146),sa=a(274),la=a(275),ca=a(282),ma=a(143),ua=a.n(ma),da=a(276),pa=a(206),fa=a(281),ga=a(288),ha=Object(sa.a)((function(e){return{appBar:{position:"relative"},formControl:{margin:e.spacing(3)},formLabel:{fontSize:"0.85em"},radioControl:{size:"small"},title:{marginLeft:e.spacing(2),flex:1,fontSize:"0.95em"}}})),va=function(e){var t=e.onClose,a=function(){var e=localStorage.getItem("saveAs");return null===e&&(e="png",localStorage.setItem("saveAs",e)),e}(),n=ie(),r=function(){var e=localStorage.getItem("exportAs");return null===e&&(e="json",localStorage.setItem("exportAs",e)),e}(),o=re(),s=oe(),l=se(),c=le(),m=ha(),u=i.a.useState({saveAs:a,saveInto:n,exportAs:r,overlay:o,fsView:s,dicomdirView:l,mprInterpolation:c}),d=Object(oa.a)(u,2),p=d[0],f=d[1];return i.a.createElement(v.a,{fullScreen:!0,open:!0,onClose:t}," ",i.a.createElement(la.a,{className:m.appBar,elevation:0},i.a.createElement(et.a,{variant:"dense"},i.a.createElement(Ue.a,{edge:"start",color:"inherit",onClick:t,"aria-label":"close"},i.a.createElement(ua.a,null)),i.a.createElement(D.a,{variant:"h6",className:m.title},"Settings"))),i.a.createElement(A.a,null,i.a.createElement("div",null,i.a.createElement("div",null,i.a.createElement(ut.a,{component:"fieldset",className:m.formControl},i.a.createElement(da.a,{control:i.a.createElement(ca.a,{checked:p.overlay,onChange:function(e){var t;f(Object($e.a)(Object($e.a)({},p),{},{overlay:e.target.checked})),t=e.target.checked,localStorage.setItem("overlay",t?"1":"0")},value:"overlay",size:"small"}),label:"Show overlay Information"}))),i.a.createElement("div",null,i.a.createElement(ut.a,{component:"fieldset",className:m.formControl},i.a.createElement(pa.a,{component:"legend",className:m.formLabel},"Open sandbox file system from:"),i.a.createElement(ga.a,{size:"small","aria-label":"filesystem",name:"filesystem",value:p.fsView,onChange:function(e){var t;f(Object($e.a)(Object($e.a)({},p),{},{fsView:e.target.value})),t=e.target.value,localStorage.setItem("fsView",t)}},i.a.createElement(da.a,{value:"left",control:i.a.createElement(fa.a,{size:"small"}),label:"left"}),i.a.createElement(da.a,{value:"right",control:i.a.createElement(fa.a,{size:"small"}),label:"right"}),i.a.createElement(da.a,{value:"bottom",control:i.a.createElement(fa.a,{size:"small"}),label:"bottom"})))),i.a.createElement("div",null,i.a.createElement(ut.a,{component:"fieldset",className:m.formControl},i.a.createElement(pa.a,{component:"legend",className:m.formLabel},"Open DICOMDIR panel from:"),i.a.createElement(ga.a,{size:"small","aria-label":"dicomdir",name:"dicomdir",value:p.dicomdirView,onChange:function(e){var t;f(Object($e.a)(Object($e.a)({},p),{},{dicomdirView:e.target.value})),t=e.target.value,localStorage.setItem("dicomdirView",t)}},i.a.createElement(da.a,{value:"left",control:i.a.createElement(fa.a,{size:"small"}),label:"left"}),i.a.createElement(da.a,{value:"right",control:i.a.createElement(fa.a,{size:"small"}),label:"right"}),i.a.createElement(da.a,{value:"bottom",control:i.a.createElement(fa.a,{size:"small"}),label:"bottom"})))),i.a.createElement("div",null,i.a.createElement(ut.a,{component:"fieldset",className:m.formControl},i.a.createElement(pa.a,{component:"legend",className:m.formLabel},"Save screenshot as:"),i.a.createElement(ga.a,{"aria-label":"saveas",name:"saveas",value:p.saveAs,onChange:function(e){var t;f(Object($e.a)(Object($e.a)({},p),{},{saveAs:e.target.value})),t=e.target.value,localStorage.setItem("saveAs",t)}},i.a.createElement(da.a,{value:"jpeg",control:i.a.createElement(fa.a,{size:"small"}),label:"JPEG"}),i.a.createElement(da.a,{value:"png",control:i.a.createElement(fa.a,{size:"small"}),label:"PNG"})))),i.a.createElement("div",null,i.a.createElement(ut.a,{component:"fieldset",className:m.formControl},i.a.createElement(pa.a,{component:"legend",className:m.formLabel},"Save screenshot into:"),i.a.createElement(ga.a,{"aria-label":"saveinto",name:"saveinto",value:p.saveInto,onChange:function(e){var t;f(Object($e.a)(Object($e.a)({},p),{},{saveInto:e.target.value})),t=e.target.value,localStorage.setItem("saveInto",t)}},i.a.createElement(da.a,{value:"local",control:i.a.createElement(fa.a,{size:"small"}),label:"local file system"}),i.a.createElement(da.a,{value:"sandbox",control:i.a.createElement(fa.a,{size:"small"}),label:"sandbox file system"})))),i.a.createElement("div",null,i.a.createElement(ut.a,{component:"fieldset",className:m.formControl},i.a.createElement(pa.a,{component:"legend",className:m.formLabel},"Export Dicom header as:"),i.a.createElement(ga.a,{"aria-label":"exportas",name:"exportas",value:r,onChange:function(e){var t;f(Object($e.a)(Object($e.a)({},p),{},{exportAs:e.target.value})),t=e.target.value,localStorage.setItem("exportAs",t)}},i.a.createElement(da.a,{value:"json",control:i.a.createElement(fa.a,{size:"small"}),label:"JSON"}),i.a.createElement(da.a,{value:"csv",control:i.a.createElement(fa.a,{size:"small"}),label:"CSV"})))),i.a.createElement("div",null,i.a.createElement(ut.a,{component:"fieldset",className:m.formControl},i.a.createElement(pa.a,{component:"legend",className:m.formLabel},"MPR interpolation method:"),i.a.createElement(ga.a,{"aria-label":"mprinterpolation",name:"mprinterpolation",value:c,onChange:function(e){var t;f(Object($e.a)(Object($e.a)({},p),{},{mprInterpolation:e.target.value})),t=e.target.value,localStorage.setItem("mprInterpolation",t)}},i.a.createElement(da.a,{value:"no",control:i.a.createElement(fa.a,{size:"small"}),label:"No interpolation (duplicate planes)"}),i.a.createElement(da.a,{value:"weightedlinear",control:i.a.createElement(fa.a,{size:"small"}),label:"Weighted linear interpolation"})))))))},Ea=a(278),ba=a(287),Sa=a(277),ya=a(110),xa=a.n(ya),Ia=a(265),Ca=a(283);a(201);null===localStorage.getItem("debug-u-dicom-viewer")&&(console.log=function(){});var Da=function(e){Object(u.a)(a,e);var t=Object(d.a)(a);function a(e){var n;Object(l.a)(this,a),(n=t.call(this,e)).state={anchorElLayout:null,anchorElToolsPanel:null,openMenu:!1,openImageEdit:!1,openTools:!1,mprMenu:!1,mprMode:!1,textMessage:"",titleMessage:"",visibleMainMenu:!0,visibleHeader:!1,visibleSettings:!1,visibleToolbar:!0,visibleOpenUrl:!1,visibleToolbox:!1,visibleTools:!1,visibleMeasure:!1,visibleClearMeasureDlg:!1,visibleAbout:!1,visibleDicomdir:!1,visibleFileManager:!1,visibleZippedFileDlg:!1,visibleDownloadZipDlg:!1,visibleOpenMultipleFilesDlg:!1,toolState:1,toolActive:"notool",sliceIndex:0,sliceMax:1,listOpenFilesScrolling:!1,visibleVolumeBuilding:!1,visibleMpr3D:!1,visibleMprOrthogonal:!1,visibleMprCoronal:!1,visibleMprSagittal:!1,visibleMprAxial:!1,visibleExplorer:!1,visibleMessage:!1,visibleReferenceLines:!0,visibleSeriesLink:!0},n.setDcmViewer=function(e){return i.a.createElement(Ke,{dcmRef:function(t){n.dicomViewersRefs[e]=t},index:e,dicomViewersRefs:n.dicomViewersRef,runTool:function(e){return n.runTool=e},changeTool:function(e){return n.changeTool=e},onLoadedImage:n.onLoadedImage,onRenderedImage:n.onRenderedImage,listOpenFilesPreviousFrame:n.listOpenFilesPreviousFrame,listOpenFilesNextFrame:n.listOpenFilesNextFrame,overlay:!0,visible:!0})},n.onLoadedImage=function(){},n.onRenderedImage=function(e){void 0!==n.referenceLines.crossViewer&&n.state.visibleReferenceLines&&n.isSliceChange&&n.referenceLines.crossViewer.layoutIndex===e&&(n.isSliceChange=!1,n.referenceLinesShow())},n.getDcmViewerRef=function(e){return n.dicomViewersRefs[e]},n.getDcmViewer=function(e){return n.dicomViewers[e]},n.getActiveDcmViewer=function(){return n.dicomViewersRefs[n.props.activeDcmIndex]},n.handleOpenLocalFs=function(e){if(e.length>1)n.files=e,n.changeLayout(1,1),n.mprPlane="",n.volume=[],n.setState({sliceIndex:0,sliceMax:1,visibleMprOrthogonal:!1,visibleMprCoronal:!1,visibleMprSagittal:!1,visibleMprAxial:!1},(function(){n.setState({visibleOpenMultipleFilesDlg:!0})}));else{var t=e[0];"application/x-zip-compressed"===t.type||"application/zip"===t.type?(n.file=t,n.url=null,n.setState({visibleZippedFileDlg:!0})):(n.setState({sliceIndex:0,sliceMax:1}),n.props.setLocalFileStore(t),n.dicomViewersRefs[n.props.activeDcmIndex].runTool("clear"),n.dicomViewersRefs[n.props.activeDcmIndex].runTool("openLocalFs",t))}},n.handleOpenSandboxFs=function(e){n.dicomViewersRefs[n.props.activeDcmIndex].runTool("clear"),n.dicomViewersRefs[n.props.activeDcmIndex].runTool("openSandboxFs",e)},n.handleOpenImage=function(e){n.dicomViewersRefs[n.props.activeDcmIndex].sliceIndex=e;var t,a=n.state.visibleMprOrthogonal,i=n.state.visibleMprSagittal,r=n.state.visibleMprCoronal,o=n.state.visibleMprAxial,s=n.mprPlanePosition();a?0===n.props.activeDcmIndex?(n.dicomViewersRefs[0].runTool("openimage",e),n.state.mprMode&&(n.dicomViewersRefs[1].mprReferenceLines(e),n.dicomViewersRefs[2].mprReferenceLines(e))):1===n.props.activeDcmIndex?(n.dicomViewersRefs[1].mprRenderXZPlane(n.dicomViewersRefs[0].filename,s,e,n.mprData),n.dicomViewersRefs[2].mprReferenceLines2(e),n.dicomViewersRefs[0].mprReferenceLines3(e,n.mprData)):2===n.props.activeDcmIndex&&(n.dicomViewersRefs[2].mprRenderYZPlane(n.dicomViewersRefs[0].filename,s,e,n.mprData),n.dicomViewersRefs[1].mprReferenceLines2(e),n.dicomViewersRefs[0].mprReferenceLines3(e,n.mprData)):null===(t=n.mprData)||void 0===t||Array.isArray(t)||"object"!==typeof t||0===Object.getOwnPropertyNames(t).length||"sagittal"===s&&i||"axial"===s&&o||"coronal"===s&&r?n.dicomViewersRefs[n.props.activeDcmIndex].runTool("openimage",e):"sagittal"===s&&o?n.dicomViewersRefs[n.props.activeDcmIndex].mprRenderXZPlane(n.dicomViewersRefs[0].filename,s,e,n.mprData):"sagittal"===s&&r||"axial"===s&&i?n.dicomViewersRefs[n.props.activeDcmIndex].mprRenderYZPlane(n.dicomViewersRefs[0].filename,s,e,n.mprData):"axial"===s&&r?n.dicomViewersRefs[n.props.activeDcmIndex].mprRenderXZPlane(n.dicomViewersRefs[0].filename,s,e,n.mprData):"coronal"===s&&i?n.dicomViewersRefs[n.props.activeDcmIndex].mprRenderYZPlane(n.dicomViewersRefs[0].filename,s,e,n.mprData):"coronal"===s&&o?n.dicomViewersRefs[n.props.activeDcmIndex].mprRenderXZPlane(n.dicomViewersRefs[0].filename,s,e,n.mprData):n.dicomViewersRefs[n.props.activeDcmIndex].runTool("openimage",e),n.activeDcmViewersNum=n.getActiveDcmViewers(),n.activeDcmViewersNum>0&&(n.getActiveDcmViewersSameStudy(),n.getActiveDcmViewersSamePlane(),n.state.visibleReferenceLines&&n.dicomViewersActive.length>1&&n.referenceLinesShow())},n.handleOpenFileDicomdir=function(e){n.dicomViewersRefs[n.props.activeDcmIndex].runTool("clear"),n.dicomViewersRefs[n.props.activeDcmIndex].runTool("openLocalFs",e)},n.handleOpenFolder=function(e){n.state.visibleExplorer?n.setState({visibleExplorer:!1},(function(){n.handleOpenFolderDo(e)})):n.handleOpenFolderDo(e)},n.handleOpenFolderDo=function(e){n.changeLayout(1,1),n.mprPlane="",n.volume=[],n.files=[],n.clear(),n.folder=e[0].webkitRelativePath.split("/")[0];for(var t=0;t<e.length;t++)n.files.push(e[t]);n.setState({sliceIndex:0,sliceMax:1,visibleMprOrthogonal:!1,visibleMprCoronal:!1,visibleMprSagittal:!1,visibleMprAxial:!1}),n.setState({visibleOpenMultipleFilesDlg:!0})},n.handleOpenDicomdir=function(e){n.setState({visibleDicomdir:!1},(function(){for(var t=null,a=[],i=0;i<e.length;i++)e[i].webkitRelativePath.includes("DICOMDIR")?t=e[i]:a.push(e[i]);null!==t?(n.props.setDicomdirStore({origin:"local",dicomdir:t,files:a}),n.toggleDicomdir()):n.setState({titleMessage:"Warning",textMessage:"The selected folder does not contains any DICOMDIR file."},(function(){n.setState({visibleMessage:!0})}))}))},n.handleOpenFsDicomdir=function(e){n.props.setDicomdirStore({origin:"fs",dicomdir:e,files:[]}),n.toggleDicomdir()},n.showAppBar=function(){window.scrollTo(0,0)},n.toggleMainMenu=function(){var e=n.state.visibleMainMenu;"left"===oe()?n.setState({visibleMainMenu:!e,visibleFileManager:!1}):n.setState({visibleMainMenu:!e})},n.showMainMenu=function(){n.setState({visibleMainMenu:!0})},n.hideMainMenu=function(){n.setState({visibleMainMenu:!1})},n.handleVisibility=function(e){n.setState({visibleMainMenu:e})},n.toggleFileManager=function(){if("left"===oe())n.setState({visibleMainMenu:!1,visibleFileManager:!n.state.visibleFileManager});else{var e=!n.state.visibleFileManager;n.setState({visibleFileManager:e}),e&&n.setState({visibleMeasure:!1,visibleHeader:!1,visibleToolbox:!1,visibleDicomdir:!1,visibleExplorer:!1})}},n.toggleExplorer=function(){var e=!n.state.visibleExplorer;n.setState({visibleExplorer:e}),e&&n.setState({visibleMeasure:!1,visibleHeader:!1,visibleToolbox:!1,visibleDicomdir:!1,visibleFileManager:!1})},n.toggleHeader=function(){var e=!n.state.visibleHeader;n.setState({visibleHeader:e}),e&&n.setState({visibleMeasure:!1,visibleToolbox:!1,visibleDicomdir:!1,visibleFileManager:!1,visibleExplorer:!1})},n.toggleToolbox=function(){var e=!n.state.visibleToolbox;n.setState({visibleToolbox:e}),e&&n.setState({visibleMeasure:!1,visibleHeader:!1,visibleDicomdir:!1,visibleFileManager:!1,visibleExplorer:!1})},n.saveMeasure=function(){n.dicomViewersRefs[n.props.activeDcmIndex].runTool("savetools")},n.toggleMeasure=function(){var e=!n.state.visibleMeasure;n.setState({visibleMeasure:e}),e&&n.setState({visibleToolbox:!1,visibleHeader:!1,visibleDicomdir:!1,visibleFileManager:!1,visibleExplorer:!1})},n.hideMeasure=function(){n.setState({visibleMeasure:!1})},n.handleVisibilityMeasure=function(e){n.setState({visibleMeasure:e})},n.toggleDicomdir=function(){var e=!n.state.visibleDicomdir;n.setState({visibleDicomdir:e}),e&&n.setState({visibleMeasure:!1,visibleToolbox:!1,visibleHeader:!1,visibleFileManager:!1})},n.clearMeasure=function(){n.showClearMeasureDlg()},n.showClearMeasureDlg=function(){n.setState({visibleClearMeasureDlg:!0})},n.hideClearMeasureDlg=function(){n.setState({visibleClearMeasureDlg:!1})},n.confirmClearMeasureDlg=function(){n.hideClearMeasureDlg(),n.dicomViewersRefs[n.props.activeDcmIndex].runTool("removetools")},n.showZippedFileDlg=function(){n.setState({visibleZippedFileDlg:!0})},n.hideZippedFileDlg=function(){n.setState({visibleZippedFileDlg:!1})},n.confirmZippedFileDlg=function(){n.hideZippedFileDlg(),n.setState({visibleFileManager:!0},(function(){null!==n.url?n.setState({visibleDownloadZipDlg:!0}):n.props.setFsZippedFile(n.file)}))},n.showAbout=function(){n.setState({visibleAbout:!n.state.visibleAbout})},n.showSettings=function(){n.setState({visibleMainMenu:!1,visibleSettings:!0,visibleToolbar:!1,position:"right"})},n.hideSettings=function(){n.setState({visibleMainMenu:!0,visibleSettings:!1,visibleToolbar:!0,visibleFileManager:!1,visibleDicomdir:!1})},n.handleVisibilitySettings=function(e){n.setState({visibleSettings:e})},n.hideDownloadZipDlg=function(){n.setState({visibleDownloadZipDlg:!1})},n.hideOpenMultipleFilesDlg=function(){n.setState({visibleOpenMultipleFilesDlg:!1}),n.openMultipleFilesCompleted()},n.openMultipleFilesCompleted=function(){if(null!==n.props.files){n.changeLayout(1,1),n.dicomViewersRefs[n.props.activeDcmIndex].runTool("openimage",0);var e=n.props.files.length;n.setState({sliceMax:e},(function(){}));var t=Y(n.props.files,(function(e){return e.patient.patientName})),a=Object(s.a)(t.keys()),i={list:t,keys:a};n.explorer={folder:n.folder,patient:i},e>1&&n.setState({visibleExplorer:!0,visibleFileManager:!1})}},n.showOpenUrl=function(){n.setState({visibleOpenUrl:!0})},n.hideOpenUrl=function(e){n.setState({visibleOpenUrl:!1},(function(){if(e){if(n.hideMainMenu(),n.file=null,n.url=n.openUrlField.value,"zip"!==ae(n.url))return n.dicomViewersRefs[n.props.activeDcmIndex].runTool("openurl",n.openUrlField.value);n.setState({visibleZippedFileDlg:!0})}}))},n.downloadOpenUrl=function(){n.setState({visibleOpenUrl:!1,visibleToolbar:!0})},n.resetImage=function(){n.dicomViewersRefs[n.props.activeDcmIndex].runTool("reset")},n.saveShot=function(){n.dicomViewersRefs[n.props.activeDcmIndex].runTool("saveas")},n.cinePlayer=function(){n.dicomViewersRefs[n.props.activeDcmIndex].runTool("cine")},n.clear=function(){n.layoutGridClick(0);for(var e=0;e<n.props.isOpen.length;e++)n.props.isOpen[e]&&n.dicomViewersRefs[e].runTool("clear");setTimeout((function(){n.setState({openImageEdit:!1,openTools:!1,mprMenu:!1,visibleToolbox:!1,visibleMeasure:!1,visibleHeader:!1,visibleDicomdir:!1},(function(){})),n.changeLayout(1,1),n.props.setFilesStore(null),n.props.setDicomdirStore(null)}),100)},n.handleLayout=function(e){n.setState({anchorElLayout:e.currentTarget})},n.closeLayout=function(){n.setState({anchorElLayout:null})},n.changeLayout=function(e,t){if(e<n.props.layout[0]||t<n.props.layout[1]){for(var a=0;a<4;a++)for(var i=0;i<4;i++)if(a+1>e||i+1>t){var r=4*a+i;n.dicomViewersRefs[r]=void 0,r===n.props.activeDcmIndex&&n.layoutGridClick(r-1)}n.activeDcmViewersNum=n.getActiveDcmViewers(),n.isMultipleFiles&&1===n.activeDcmViewersNum&&n.setState({mprMenu:!0})}n.props.setLayoutStore(e,t)},n.handleToolsPanel=function(e){n.setState({anchorElToolsPanel:e.currentTarget})},n.closeToolsPanel=function(){n.setState({anchorElToolsPanel:null})},n.toolExecute=function(e){n.closeToolsPanel(),"referencelines"===e?n.referenceLinesToggle():"serieslink"===e?n.seriesLinkToggle():(n.setState({toolActive:e}),n.props.toolStore(e),n.dicomViewersRefs[n.props.activeDcmIndex].runTool(e))},n.toolChange=function(){var e=1-n.state.toolState;n.setState({toolState:e},(function(){n.changeTool.changeTool(n.props.tool,e)}))},n.toolRemove=function(e){n.dicomViewersRefs[n.props.activeDcmIndex].runTool("removetool",e)},n.toggleOpenMenu=function(){n.setState({openMenu:!n.state.openMenu})},n.toggleImageEdit=function(){n.setState({openImageEdit:!n.state.openImageEdit})},n.toggleTools=function(){n.setState({openTools:!n.state.openTools})},n.toggleMpr=function(){n.setState({mprMenu:!n.state.mprMenu})},n.layoutGridClick=function(e){if(!Z.isMobile||e!==n.props.activeDcmIndex){var t=n.dicomViewersRefs[e].sliceMax,a=n.dicomViewersRefs[e].sliceIndex;n.setState({sliceMax:t,sliceIndex:a}),n.props.setActiveDcmIndex(e),n.state.visibleMprOrthogonal&&n.setState({sliceMax:t,sliceIndex:a});var i=n.getDcmViewerRef(e);null!==i.image&&(n.props.setActiveMeasurements(i.measurements),n.props.setActiveDcm(i),n.props.setExplorerActiveSeriesIndex(i.explorerIndex),n.state.visibleReferenceLines&&n.dicomViewersActive.length>1&&(void 0!==n.referenceLines.scoutViewer&&n.referenceLines.scoutViewer.updateImage(),n.setState({visibleReferenceLines:!1},(function(){n.referenceLinesToggle()}))))}},n.layoutGridTouch=function(e){Z.isMobile||n.props.activeDcmIndex},n.buildLayoutGrid=function(){for(var e=[],t=0;t<n.props.layout[0];t++)for(var a=function(a){var r={border:1===n.props.layout[0]&&1===n.props.layout[1]?"solid 1px #000000":"solid 1px #444444"},o=4*t+a;e.push(i.a.createElement("div",{key:o,style:r,onClick:function(){return n.layoutGridClick(o)},onTouchStart:function(){return n.layoutGridTouch(o)}},n.getDcmViewer(o)))},r=0;r<n.props.layout[1];r++)a(r);return i.a.createElement("div",{id:"dicomviewer-grid",style:{display:"grid",gridTemplateRows:"repeat(".concat(n.props.layout[0],", ").concat(100/n.props.layout[0],"%)"),gridTemplateColumns:"repeat(".concat(n.props.layout[1],", ").concat(100/n.props.layout[1],"%)"),height:"100%",width:"100%"}},e)},n.getStringVisiblePlane=function(){return n.state.visibleMprOrthogonal?"orthogonal":n.state.visibleMprSagittal?"sagittal":n.state.visibleMprAxial?"axial":n.state.visibleMprCoronal?"coronal":void 0},n.appBarTitle=function(e,t,a){if(Z.isMobile&&!Z.isTablet)return t?null:i.a.createElement(D.a,{variant:"overline",className:e.title},i.a.createElement("strong",null,"U")," ",i.a.createElement("strong",null,"D"),"icom ",i.a.createElement("strong",null,"V"),"iewer");if(t){var r=n.getStringVisiblePlane();return n.state.sliceMax>1&&n.mprPlane!==r&&""!==n.mprPlane?i.a.createElement(D.a,{variant:"overline",className:e.title},"MPR "+r):i.a.createElement(D.a,{variant:"overline",className:e.title},a.filename)}return null!==n.props.dicomdir?i.a.createElement(D.a,{variant:"overline",className:e.title},n.props.dicomdir.dicomdir.webkitRelativePath):i.a.createElement(D.a,{variant:"overline",className:e.title},i.a.createElement("strong",null,"U")," ",i.a.createElement("strong",null,"D"),"icom ",i.a.createElement("strong",null,"V"),"iewer")},n.seriesLinkToggle=function(){n.setState({visibleSeriesLink:!n.state.visibleSeriesLink})},n.referenceLinesToggle=function(){var e=!n.state.visibleReferenceLines;n.setState({visibleReferenceLines:e}),e&&n.dicomViewersActive.length>1?n.referenceLinesShow():n.referenceLinesHide()},n.referenceLinesShow=function(){if(!(n.state.mprMode||!n.state.visibleReferenceLines||n.dicomViewersActive.length<2)){n.referenceLines.crossViewer=n.getDcmViewerRef(n.props.activeDcmIndex);var e=n.referenceLines.crossViewer.mprPlane;n.openViewers=n.dicomViewersActive.filter((function(t){return t.layoutIndex!==n.props.activeDcmIndex&&e!==t.mprPlane})),n.referenceLines.crossViewer.updateImage();for(var t=0;t<n.openViewers.length;t++)n.openViewers[t].referenceLinesBuild(n.referenceLines.crossViewer.image)}},n.referenceLinesHide=function(){if(!n.state.mprMode&&void 0!==n.openViewers)for(var e=0;e<n.openViewers.length;e++)n.openViewers[e].updateImage()},n.mprBuildVolume=function(){var e=X(n.dicomViewersRefs[n.props.activeDcmIndex].image);if(!(n.volume.length>0&&e===n.echoNumber)){n.t0=performance.now();var t=n.dicomViewersRefs[0].files.filter((function(t){return t.series.echoNumber===e}));t.length<n.files.length&&(n.echoNumber=e,n.dicomViewersRefs[n.props.activeDcmIndex].runTool("setfiles",t));var a=n.state.sliceIndex,i=function(e,t){var a=e.data.string("x00280030");if(void 0!==a)return a.split("\\")[t]}(t[a].image,1),r=function(e){var t=e.data.string("x00180088");if(void 0!==t)return parseFloat(t)}(t[a].image),o=function(e){var t=e.data.string("x00180050");if(void 0!==t)return parseFloat(t)}(t[a].image),s=t[a].image.getPixelData().length,l=J(t[a].image);n.volume=[],n.mprData.zDim=Math.round(t.length*r/i);var c=!1;if(r<o&&void 0===l){for(var m=t[a].sliceDistance,u=t[a].sliceDistance,d=0;d<t.length;d++)t[d].sliceDistance>m&&(m=t[d].sliceDistance),t[d].sliceDistance<u&&(u=t[d].sliceDistance);n.mprData.zDim=Math.round(Math.abs(m-u)/i),c=!0}if(n.mprData.zStep=Math.round(n.mprData.zDim/t.length),t.length===n.mprData.zDim)for(var p=0,f=t.length;p<f;p++)n.volume.push(t[p].image.getPixelData());else if(t.length<n.mprData.zDim){for(var g=new Int16Array(s).fill(0),h=0,v=n.mprData.zDim;h<v;h++)n.volume.push(g);for(var E=[],b=0;b<t.length;b++)E.push({iFile:b,instanceNumber:t[b].instanceNumber,sliceDistance:t[b].sliceDistance,sliceLocation:t[b].sliceLocation});if(c)(E=E.reduce((function(e,t){return 0===e.filter((function(e){return e.sliceDistance===t.sliceDistance})).length&&e.push(t),e}),[])).sort((function(e,t){return e.instanceNumber-t.instanceNumber}));else if(t[0].sliceDistance<t[1].sliceDistance)E.sort((function(e,t){return t.sliceDistance-e.sliceDistance}));else{var S=function(e){var t=e.data.string("x00200037").split("\\").map((function(e){return parseFloat(e)}));return t[0]>t[1]}(t[a].image);Math.sign(t[0].sliceDistance)*Math.sign(t[0].sliceLocation)<0&&E.sort((function(e,t){return S?e.sliceDistance-t.sliceDistance:t.sliceDistance-e.sliceDistance}))}n.mprData.instanceNumberOrder=t[E[0].iFile].instanceNumber<t[E[1].iFile].instanceNumber?1:-1,n.mprData.indexMax=t.length;var y=[0];n.volume[0]=t[E[0].iFile].image.getPixelData(),n.volume[n.mprData.zDim-1]=t[E[E.length-1].iFile].image.getPixelData();for(var x=(n.mprData.zDim-2)/(E.length-2),I=0,C=1;C<=E.length-2;C++)I=Math.ceil(I+x),n.volume[I]=t[E[C].iFile].image.getPixelData(),y.push(I);y.push(n.mprData.zDim-1);var D=le();if("no"===D)for(var w=0;w<y.length-1;w++)for(var F=y[w]+1;F<=y[w+1]-1;F++)n.volume[F]=n.volume[y[w+1]];else if("weightedlinear"===D)for(var O=0;O<y.length-1;O++)for(var M=y[O+1]-y[O],R=y[O]+1;R<y[O+1];R++){for(var P=new Int16Array(s),L=(R-y[O])/M,T=0;T<s-1;T++){var k=n.volume[y[O]][T]*(1-L),A=n.volume[y[O+1]][T]*L;P[T]=k+A}n.volume[R]=P}n.t1=performance.now(),console.log("performance volume building: ".concat(n.t1-n.t0," milliseconds"))}else{n.mprData.zStep=Math.round(t.length/n.mprData.zDim);for(var V=0,z=n.mprData.zDim;V<z;V++){var j=V*n.mprData.zStep;n.volume.push(t[j].image.getPixelData())}}var N=Math.round(t.length/2);n.setState({sliceIndex:N},(function(){n.state.visibleMprOrthogonal?n.changeToOrthogonalView():n.state.visibleMprSagittal?n.changeToSagittalView():n.state.visibleMprCoronal?n.changeToCoronalView():n.changeToAxialView()}))}},n.changeToOrthogonalView=function(){n.setState({sliceMax:n.dicomViewersRefs[0].files.length}),n.changeLayout(1,3);var e=Math.trunc(n.dicomViewersRefs[0].files.length/2);n.setState({visibleVolumeBuilding:!1,sliceIndex:e,mprMode:!0},(function(){var t=n.mprPlanePosition();null===n.dicomViewersRefs[0].volume&&(n.dicomViewersRefs[0].volume=n.volume),n.dicomViewersRefs[0].runTool("openimage",e),null===n.dicomViewersRefs[1].volume&&(n.dicomViewersRefs[1].volume=n.volume),n.dicomViewersRefs[1].runTool("setfiles",n.files),n.dicomViewersRefs[1].explorerIndex=n.dicomViewersRefs[0].explorerIndex,n.dicomViewersRefs[1].sliceMax=n.dicomViewersRefs[0].files[e].image.columns;var a=Math.trunc(n.dicomViewersRefs[1].sliceMax/2);n.dicomViewersRefs[1].mprRenderXZPlane(n.dicomViewersRefs[0].filename,t,a,n.mprData),null===n.dicomViewersRefs[2].volume&&(n.dicomViewersRefs[2].volume=n.volume),n.dicomViewersRefs[2].runTool("setfiles",n.files),n.dicomViewersRefs[2].explorerIndex=n.dicomViewersRefs[0].explorerIndex,n.dicomViewersRefs[2].sliceMax=n.dicomViewersRefs[0].files[e].image.columns;var i=Math.trunc(n.dicomViewersRefs[2].sliceMax/2);n.dicomViewersRefs[2].mprRenderYZPlane(n.dicomViewersRefs[0].filename,t,i,n.mprData)}))},n.changeToSagittalView=function(){n.changeLayout(1,1),n.setState({visibleVolumeBuilding:!1},(function(){var e=n.mprPlanePosition();if(null===n.dicomViewersRefs[n.props.activeDcmIndex].volume&&(n.dicomViewersRefs[n.props.activeDcmIndex].volume=n.volume),"sagittal"===e){n.dicomViewersRefs[0].runTool("setfiles",n.files);var t=null===n.dicomViewersRefs[0].files?1:n.dicomViewersRefs[0].files.length,a=Math.trunc(t/2);n.setState({sliceIndex:a,sliceMax:t,mprMode:!1},(function(){n.dicomViewersRefs[n.props.activeDcmIndex].sliceMax=t,n.dicomViewersRefs[n.props.activeDcmIndex].runTool("openimage",a)}))}else if("axial"===e){var i=n.dicomViewersRefs[0].files[0].image.rows,r=Math.trunc(i/2);n.setState({sliceIndex:r,sliceMax:i},(function(){n.dicomViewersRefs[n.props.activeDcmIndex].sliceMax=i,n.dicomViewersRefs[n.props.activeDcmIndex].mprRenderYZPlane(n.dicomViewersRefs[0].filename,e,r,n.mprData)}))}else{var o=n.dicomViewersRefs[0].files[0].image.columns,s=Math.trunc(o/2);n.setState({sliceIndex:s,sliceMax:o},(function(){n.dicomViewersRefs[n.props.activeDcmIndex].sliceMax=o,n.dicomViewersRefs[n.props.activeDcmIndex].mprRenderXZPlane(n.dicomViewersRefs[0].filename,e,s,n.mprData)}))}}))},n.changeToCoronalView=function(){n.changeLayout(1,1),n.setState({visibleVolumeBuilding:!1},(function(){var e=n.mprPlanePosition();if(null===n.dicomViewersRefs[n.props.activeDcmIndex].volume&&(n.dicomViewersRefs[n.props.activeDcmIndex].volume=n.volume),"coronal"===e){n.dicomViewersRefs[0].runTool("setfiles",n.files);var t=null===n.dicomViewersRefs[0].files?1:n.dicomViewersRefs[0].files.length,a=Math.trunc(t/2);n.setState({sliceIndex:a,sliceMax:t,mprMode:!1},(function(){n.dicomViewersRefs[n.props.activeDcmIndex].sliceMax=t,n.dicomViewersRefs[n.props.activeDcmIndex].runTool("openimage",a)}))}else if("axial"===e){var i=n.dicomViewersRefs[0].files[0].image.columns,r=Math.trunc(i/2);n.setState({sliceIndex:r,sliceMax:i},(function(){n.dicomViewersRefs[n.props.activeDcmIndex].sliceMax=i,n.dicomViewersRefs[n.props.activeDcmIndex].mprRenderXZPlane(n.dicomViewersRefs[0].filename,e,r,n.mprData)}))}else{var o=n.dicomViewersRefs[0].files[0].image.rows,s=Math.trunc(o/2);n.setState({sliceIndex:s,sliceMax:o},(function(){n.dicomViewersRefs[n.props.activeDcmIndex].sliceMax=o,n.dicomViewersRefs[n.props.activeDcmIndex].mprRenderYZPlane(n.dicomViewersRefs[0].filename,e,s,n.mprData)}))}}))},n.changeToAxialView=function(){n.changeLayout(1,1),n.setState({visibleVolumeBuilding:!1},(function(){var e=n.mprPlanePosition();if(null===n.dicomViewersRefs[n.props.activeDcmIndex].volume&&(n.dicomViewersRefs[n.props.activeDcmIndex].volume=n.volume),"axial"===e){n.dicomViewersRefs[0].runTool("setfiles",n.files);var t=null===n.dicomViewersRefs[0].files?1:n.dicomViewersRefs[0].files.length,a=Math.trunc(t/2);n.setState({sliceIndex:a,sliceMax:t,mprMode:!1},(function(){n.dicomViewersRefs[n.props.activeDcmIndex].sliceMax=t,n.dicomViewersRefs[n.props.activeDcmIndex].runTool("openimage",a)}))}else if("sagittal"===e){var i=n.dicomViewersRefs[0].files[0].image.columns,r=Math.trunc(i/2);n.setState({sliceIndex:r,sliceMax:i},(function(){n.dicomViewersRefs[n.props.activeDcmIndex].sliceMax=i,n.dicomViewersRefs[n.props.activeDcmIndex].mprRenderXZPlane(n.dicomViewersRefs[0].filename,e,r,n.mprData)}))}else{var o=n.dicomViewersRefs[0].files[0].image.rows,s=Math.trunc(o/2);n.setState({sliceIndex:s,sliceMax:o},(function(){n.dicomViewersRefs[n.props.activeDcmIndex].sliceMax=o,n.dicomViewersRefs[n.props.activeDcmIndex].mprRenderYZPlane(n.dicomViewersRefs[0].filename,e,s,n.mprData)}))}}))},n.mprPlanePosition=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.props.activeDcmIndex;return(""===n.mprPlane||e)&&(n.mprPlane=n.dicomViewersRefs[t].mprPlanePosition(),n.state.visibleMprOrthogonal||("sagittal"===n.mprPlane?n.setState({visibleMprOrthogonal:!1,visibleMprSagittal:!0,visibleMprAxial:!1,visibleMprCoronal:!1}):"coronal"===n.mprPlane?n.setState({visibleMprOrthogonal:!1,visibleMprSagittal:!1,visibleMprAxial:!1,visibleMprCoronal:!0}):n.setState({visibleMprOrthogonal:!1,visibleMprSagittal:!1,visibleMprAxial:!0,visibleMprCoronal:!1}))),n.mprPlane},n.mpr3D=function(){},n.mprOrthogonal=function(){n.state.visibleMprOrthogonal||(n.mprData.plane={from:n.mprPlane,to:"orthogonal"},n.setState({visibleMprOrthogonal:!0,visibleMprCoronal:!1,visibleMprSagittal:!1,visibleMprAxial:!1},(function(){0===n.volume.length?n.setState({visibleVolumeBuilding:!0},(function(){setTimeout((function(){n.mprBuildVolume()}),100)})):n.changeToOrthogonalView()})))},n.mprSagittal=function(){n.state.visibleMprSagittal||(n.mprData.plane={from:n.mprPlane,to:"sagittal"},n.setState({visibleMprOrthogonal:!1,visibleMprSagittal:!0,visibleMprCoronal:!1,visibleMprAxial:!1},(function(){0===n.volume.length?n.setState({visibleVolumeBuilding:!0},(function(){setTimeout((function(){n.mprBuildVolume()}),100)})):n.changeToSagittalView()})))},n.mprCoronal=function(){n.state.visibleMprCoronal||(n.mprData.plane={from:n.mprPlane,to:"coronal"},n.setState({visibleMprOrthogonal:!1,visibleMprSagittal:!1,visibleMprCoronal:!0,visibleMprAxial:!1},(function(){0===n.volume.length?n.setState({visibleVolumeBuilding:!0},(function(){setTimeout((function(){n.mprBuildVolume()}),100)})):n.changeToCoronalView()})))},n.mprAxial=function(){n.state.visibleMprAxial||(n.mprData.plane={from:n.mprPlane,to:"axial"},n.setState({visibleMprOrthogonal:!1,visibleMprSagittal:!1,visibleMprCoronal:!1,visibleMprAxial:!0},(function(){0===n.volume.length?n.setState({visibleVolumeBuilding:!0},(function(){setTimeout((function(){n.mprBuildVolume()}),100)})):n.changeToAxialView()})))},n.listOpenFilesFirstFrame=function(){n.setState({sliceIndex:0},(function(){n.isSliceChange=!0,n.handleOpenImage(0)}))},n.listOpenFilesPreviousFrame=function(){var e=n.state.sliceIndex;e=0===e?n.state.sliceMax-1:e-1,n.setState({sliceIndex:e},(function(){n.isSliceChange=!0,n.handleOpenImage(e),n.syncActiveDcmViewersSamePlane(-1)}))},n.listOpenFilesNextFrame=function(){var e=n.state.sliceIndex;e=e===n.state.sliceMax-1?0:e+1,n.setState({sliceIndex:e},(function(){n.isSliceChange=!0,n.handleOpenImage(e),n.syncActiveDcmViewersSamePlane(1)}))},n.listOpenFilesLastFrame=function(){var e=n.state.sliceMax-1;n.setState({sliceIndex:e},(function(){n.isSliceChange=!0,n.handleOpenImage(e)}))},n.listOpenFilesScrolling=function(){var e=n.state.listOpenFilesScrolling;n.setState({listOpenFilesScrolling:!e},(function(){e?clearInterval(n.timerScrolling):n.timerScrolling=setInterval((function(){n.listOpenFilesNextFrame()}),500)}))},n.handleSliceChange=function(e,t){n.setState({sliceIndex:Math.floor(t)},(function(){var e=n.state.sliceIndex;n.isSliceChange=!0,n.handleOpenImage(e)}))},n.explorerOnSelectSeries=function(e,t){var a=n.props.activeDcmIndex;n.state.mprMode&&(a=0,n.setState({sliceIndex:0,sliceMax:1,visibleMprOrthogonal:!1,visibleMprCoronal:!1,visibleMprSagittal:!1,visibleMprAxial:!1}),n.props.setActiveDcmIndex(a),n.changeLayout(1,1)),n.files=e,n.mprPlane="",n.mprData={},n.volume=[],n.dicomViewersRefs[a].runTool("setfiles",n.files),n.dicomViewersRefs[a].explorerIndex=t;var i=n.dicomViewersRefs[a].sliceMax;n.setState({sliceMax:i,sliceIndex:0,mprMode:!1},(function(){n.handleOpenImage(0)}))},n.getActiveDcmViewers=function(){return n.dicomViewersActive=n.dicomViewersRefs.filter((function(e){return void 0!==e&&null!==e.image})),n.dicomViewersActive.length},n.getActiveDcmViewersSameStudy=function(){var e=H(n.dicomViewersRefs[n.props.activeDcmIndex].image);return n.dicomViewersActiveSameStudy=n.dicomViewersRefs.filter((function(t){return void 0!==t&&H(t.image)===e})),n.dicomViewersActiveSameStudy.length},n.getActiveDcmViewersSamePlane=function(){n.dicomViewersActiveSamePlane=[];for(var e=n.dicomViewersRefs[n.props.activeDcmIndex].mprPlane,t=0;t<n.dicomViewersActiveSameStudy.length;t++)n.dicomViewersActiveSameStudy[t].mprPlane===e&&n.dicomViewersActiveSameStudy[t].layoutIndex!==n.props.activeDcmIndex&&n.dicomViewersActiveSamePlane.push(n.dicomViewersActiveSameStudy[t])},n.syncActiveDcmViewersSamePlane=function(e){if(n.state.visibleSeriesLink&&n.dicomViewersActiveSamePlane.length>0)for(var t=n.dicomViewersRefs[n.props.activeDcmIndex].mprPlane,a=_(n.dicomViewersRefs[n.props.activeDcmIndex].image,0),i=_(n.dicomViewersRefs[n.props.activeDcmIndex].image,1),r=_(n.dicomViewersRefs[n.props.activeDcmIndex].image,2),o=0,s=0;s<n.dicomViewersActiveSamePlane.length;s++)"sagittal"===t?o=n.dicomViewersActiveSamePlane[s].findFirstSliceWithIppValue(a,0):"coronal"===t?o=n.dicomViewersActiveSamePlane[s].findFirstSliceWithIppValue(i,1):"axial"===t&&(o=n.dicomViewersActiveSamePlane[s].findFirstSliceWithIppValue(r,2)),o>=0&&n.dicomViewersActiveSamePlane[s].runTool("openimage",o)},n.colorIcon=function(e){return n.state.toolActive===e?"rgba(0, 255, 0, 1.0)":"#FFFFFF"},n.files=[],n.folder=null,n.file=null,n.url=null,n.explorer=null,n.series=null,n.mprData={},n.mprPlane="",n.echoNumber=0,n.volume=[],n.fileOpen=i.a.createRef(),n.showFileOpen=n.showFileOpen.bind(Object(m.a)(n)),n.openDicomdir=i.a.createRef(),n.showOpenDicomdir=n.showOpenDicomdir.bind(Object(m.a)(n)),n.openFolder=i.a.createRef(),n.showOpenFolder=n.showOpenFolder.bind(Object(m.a)(n)),n.openUrlField=i.a.createRef(),n.dicomViewersActive=[],n.dicomViewersActiveSameStudy=[],n.dicomViewersActiveSamePlane=[],n.dicomViewersRefs=[],n.dicomViewers=[];for(var r=0;r<16;r++)n.dicomViewers.push(n.setDcmViewer(r));return n.activeDcmViewersNum=0,n.referenceLines={},n}return Object(c.a)(a,[{key:"showFileOpen",value:function(){this.props.isOpenStore(!1),this.fileOpen.current.click()}},{key:"showOpenFolder",value:function(){this.openFolder.current.click()}},{key:"showOpenDicomdir",value:function(){this.openDicomdir.current.click()}},{key:"componentDidMount",value:function(){window.scrollTo(0,0)}},{key:"render",value:function(){var e=this,t=this.props.classes,a={primary:t.listItemText},n=this.props.isOpen[this.props.activeDcmIndex],r=null!==this.props.dicomdir;this.isMultipleFiles=!1,void 0===this.dicomViewersRefs[this.props.activeDcmIndex]?this.isMultipleFiles=!1:null!==this.dicomViewersRefs[this.props.activeDcmIndex].files?this.isMultipleFiles=this.dicomViewersRefs[this.props.activeDcmIndex].files.length>1:this.isMultipleFiles=!1;var o=this.state.openMenu,s=this.state.openImageEdit,l=this.state.openTools,c=this.state.visibleMainMenu,m=this.state.visibleHeader,u=this.state.visibleSettings,d=this.state.visibleAbout,p=this.state.visibleMeasure,f=this.state.visibleToolbox,g=this.state.visibleDicomdir,y=this.state.visibleFileManager,w=this.state.visibleClearMeasureDlg,M=this.state.visibleZippedFileDlg,R=this.state.visibleDownloadZipDlg,L=this.state.visibleOpenMultipleFilesDlg,k=Boolean(this.state.anchorElLayout),V=this.state.visibleVolumeBuilding,z=this.state.visibleMprOrthogonal,j=this.state.visibleMprCoronal,N=this.state.visibleMprSagittal,B=this.state.visibleMprAxial,U=this.state.visibleExplorer,G=this.state.visibleReferenceLines,W=this.state.visibleSeriesLink,H=Boolean(this.state.anchorElToolsPanel),_=this.state.mprMenu&&""!==this.mprPlane,X=this.getActiveDcmViewer(),J=this.state.sliceMax;return i.a.createElement("div",null,i.a.createElement(la.a,{className:t.appBar,position:"static",elevation:0},i.a.createElement(et.a,{variant:"dense"},i.a.createElement(Ue.a,{edge:"start",className:t.menuButton,color:"inherit","aria-label":"menu",onClick:this.toggleMainMenu},i.a.createElement(xa.a,null)),this.appBarTitle(t,n,X),i.a.createElement("div",{className:t.grow}),n||r?null:i.a.createElement(Ue.a,{onClick:this.showAbout},i.a.createElement(Be.a,{path:Ge.J,size:"1.2rem",color:"#FFFFFF"})),n&&X.numberOfFrames>1&&n?i.a.createElement(Mt.a,{title:"Cine Player"},i.a.createElement(Ue.a,{onClick:this.cinePlayer},i.a.createElement(Be.a,{path:Ge.Z,size:"1.2rem",color:"#FFFFFF"}))):null,n?i.a.createElement(Mt.a,{title:"Reset Image"},i.a.createElement(Ue.a,{onClick:this.resetImage},i.a.createElement(Be.a,{path:Ge.P,size:"1.2rem",color:"#FFFFFF"}))):null,n?i.a.createElement(Mt.a,{title:"Tools"},i.a.createElement(Ue.a,{onClick:this.handleToolsPanel},i.a.createElement(Be.a,{path:Ge.W,size:"1.2rem",color:"#FFFFFF"}))):null,n?i.a.createElement(Mt.a,{title:"Save Screenshot"},i.a.createElement(Ue.a,{color:"inherit",onClick:this.saveShot},i.a.createElement(Be.a,{path:Ge.f,size:"1.2rem",color:"#FFFFFF"}))):null,n?i.a.createElement(Mt.a,{title:"Measurements"},i.a.createElement(Ue.a,{color:"inherit",onClick:this.toggleMeasure},i.a.createElement(Be.a,{path:Ge.A,size:"1.2rem",color:"#FFFFFF"}))):null,n&&X.isDicom?i.a.createElement(Mt.a,{title:"Dicom Header"},i.a.createElement(Ue.a,{color:"inherit",onClick:this.toggleHeader},i.a.createElement(Be.a,{path:Ge.B,size:"1.2rem",color:"#FFFFFF"}))):null,r?i.a.createElement(Mt.a,{title:"DICOMDIR"},i.a.createElement(Ue.a,{color:"inherit",onClick:this.toggleDicomdir},i.a.createElement(Be.a,{path:Ge.E,size:"1.2rem",color:"#FFFFFF"}))):null,n&&this.isMultipleFiles||z?i.a.createElement(Mt.a,{title:"Explorer"},i.a.createElement(Ue.a,{color:"inherit",onClick:this.toggleExplorer},i.a.createElement(Be.a,{path:Ge.b,size:"1.2rem",color:"#FFFFFF"}))):null,n?i.a.createElement(Mt.a,{title:"Sandbox File Manager"},i.a.createElement(Ue.a,{color:"inherit",onClick:this.toggleFileManager},i.a.createElement(Be.a,{path:Ge.z,size:"1.2rem",color:"#FFFFFF"}))):null)),i.a.createElement(ba.a,{variant:"persistent",open:c,style:{position:"relative",zIndex:1},onClose:this.toggleMainMenu},i.a.createElement("div",{className:t.toolbar},i.a.createElement(A.a,null,i.a.createElement(x.a,{dense:!0},i.a.createElement(I.a,{button:!0,onClick:function(){return e.showAppBar()}},i.a.createElement(Sa.a,null,i.a.createElement(xa.a,null)),i.a.createElement(C.a,{primary:"Tool Bar"})),i.a.createElement(I.a,{button:!0,onClick:function(){return e.toggleFileManager()}},i.a.createElement(Sa.a,null,i.a.createElement(Be.a,{path:Ge.z,size:"1.2rem",color:"#FFFFFF"})),i.a.createElement(C.a,{classes:a,primary:"File Manager"})),i.a.createElement(I.a,{button:!0,onClick:function(){return e.toggleOpenMenu()}},i.a.createElement(Sa.a,null,i.a.createElement(Be.a,{path:Ge.D,size:"1.2rem",color:"#FFFFFF"})),i.a.createElement(C.a,{classes:a,primary:"Open ..."}),o?i.a.createElement(P.a,null):i.a.createElement(T.a,null)),i.a.createElement(O.a,{in:o,timeout:"auto",unmountOnExit:!0},i.a.createElement(x.a,{dense:!0,component:"div"},i.a.createElement(I.a,{button:!0,style:{paddingLeft:30},onClick:function(){return e.showFileOpen()}},i.a.createElement(Sa.a,null,i.a.createElement(Be.a,{path:Ge.C,size:"1.0rem",color:"#FFFFFF"})),i.a.createElement(C.a,{classes:a,primary:i.a.createElement(D.a,{type:"body1",style:{fontSize:"0.80em",marginLeft:"-20px"}},"File")})),i.a.createElement(I.a,{button:!0,style:{paddingLeft:30},onClick:function(){return e.showOpenUrl()}},i.a.createElement(Sa.a,null,i.a.createElement(Be.a,{path:Ge.bb,size:"1.0rem",color:"#FFFFFF"})),i.a.createElement(C.a,{classes:a,primary:i.a.createElement(D.a,{type:"body1",style:{fontSize:"0.80em",marginLeft:"-20px"}},"URL")})),q()&&!Z.isMobile?i.a.createElement(I.a,{button:!0,style:{paddingLeft:30},onClick:function(){return e.showOpenFolder()}},i.a.createElement(Sa.a,null,i.a.createElement(Be.a,{path:Ge.E,size:"1.0rem",color:"#FFFFFF"})),i.a.createElement(C.a,{classes:a,primary:i.a.createElement(D.a,{type:"body1",style:{fontSize:"0.80em",marginLeft:"-20px"}},"Folder")})):null,q()&&!Z.isMobile?i.a.createElement(I.a,{button:!0,style:{paddingLeft:30},onClick:function(){return e.showOpenDicomdir()}},i.a.createElement(Sa.a,null,i.a.createElement(Be.a,{path:Ge.E,size:"1.0rem",color:"#FFFFFF"})),i.a.createElement(C.a,{classes:a,primary:i.a.createElement(D.a,{type:"body1",style:{fontSize:"0.80em",marginLeft:"-20px"}},"DICOMDIR")})):null)),i.a.createElement(I.a,{button:!0,onClick:function(){return e.clear()}},i.a.createElement(Sa.a,null,i.a.createElement(Be.a,{path:Ge.t,size:"1.2rem",color:"#FFFFFF"})),i.a.createElement(C.a,{classes:a,primary:"Clear All"})),i.a.createElement(I.a,{button:!0,onClick:this.handleLayout},i.a.createElement(Sa.a,null,i.a.createElement(Be.a,{path:Ge.ab,size:"1.2rem",color:"#FFFFFF"})),i.a.createElement(C.a,{classes:a,primary:"Layout"})),i.a.createElement(I.a,{button:!0,onClick:function(){return e.showSettings()}},i.a.createElement(Sa.a,null,i.a.createElement(Be.a,{path:Ge.m,size:"1.2rem",color:"#FFFFFF"})),i.a.createElement(C.a,{classes:a,primary:"Settings"})),i.a.createElement(Ea.a,null),i.a.createElement(I.a,{button:!0,onClick:function(){return e.toggleToolbox()},disabled:!n},i.a.createElement(Sa.a,null,i.a.createElement(Be.a,{path:Ge.g,size:"1.2rem",color:"#FFFFFF"})),i.a.createElement(C.a,{classes:a,primary:"Histogram"})),i.a.createElement(I.a,{button:!0,onClick:function(){return e.toggleMpr()},disabled:!n||""===this.mprPlane},i.a.createElement(Sa.a,null,i.a.createElement(Be.a,{path:Ge.e,size:"1.2rem",color:"#FFFFFF"})),i.a.createElement(C.a,{classes:a,primary:"MPR"}),_?i.a.createElement(P.a,null):i.a.createElement(T.a,null)),i.a.createElement(O.a,{in:_,timeout:"auto",unmountOnExit:!0},i.a.createElement(x.a,{dense:!0,component:"div"},i.a.createElement(I.a,{button:!0,style:{paddingLeft:40},onClick:function(){return e.mprOrthogonal()}},z?i.a.createElement(Sa.a,{style:{marginLeft:"-10px"}},i.a.createElement(Be.a,{path:Ge.h,size:"1.0rem",color:"#FFFFFF"})):null,i.a.createElement(C.a,{style:z?{marginLeft:"-7px"}:{marginLeft:"40px"},primary:i.a.createElement(D.a,{type:"body1",style:{fontSize:"0.80em",marginLeft:"-23px"}},"Orthogonal")})),i.a.createElement(I.a,{button:!0,style:{paddingLeft:40},onClick:function(){return e.mprCoronal()}},j?i.a.createElement(Sa.a,{style:{marginLeft:"-10px"}},i.a.createElement(Be.a,{path:Ge.h,size:"1.0rem",color:"#FFFFFF"})):null,i.a.createElement(C.a,{style:j?{marginLeft:"-7px"}:{marginLeft:"40px"},primary:i.a.createElement(D.a,{type:"body1",style:{fontSize:"0.80em",marginLeft:"-23px"}},"Coronal")})),i.a.createElement(I.a,{button:!0,style:{paddingLeft:40},onClick:function(){return e.mprSagittal()}},N?i.a.createElement(Sa.a,{style:{marginLeft:"-10px"}},i.a.createElement(Be.a,{path:Ge.h,size:"1.0rem",color:"#FFFFFF"})):null,i.a.createElement(C.a,{style:N?{marginLeft:"-7px"}:{marginLeft:"40px"},primary:i.a.createElement(D.a,{type:"body1",style:{fontSize:"0.80em",marginLeft:"-23px"}},"Sagittal")})),i.a.createElement(I.a,{button:!0,style:{paddingLeft:40},onClick:function(){return e.mprAxial()}},B?i.a.createElement(Sa.a,{style:{marginLeft:"-10px"}},i.a.createElement(Be.a,{path:Ge.h,size:"1.0rem",color:"#FFFFFF"})):null,i.a.createElement(C.a,{style:B?{marginLeft:"-7px"}:{marginLeft:"40px"},primary:i.a.createElement(D.a,{type:"body1",style:{fontSize:"0.80em",marginLeft:"-23px"}},"Axial")})))),i.a.createElement(I.a,{button:!0,onClick:function(){return e.toggleImageEdit()},disabled:!n},i.a.createElement(Sa.a,null,i.a.createElement(Be.a,{path:Ge.I,size:"1.2rem",color:"#FFFFFF"})),i.a.createElement(C.a,{classes:a,primary:"Edit"}),s?i.a.createElement(P.a,null):i.a.createElement(T.a,null)),i.a.createElement(O.a,{in:s,timeout:"auto",unmountOnExit:!0},i.a.createElement(x.a,{dense:!0,component:"div"},i.a.createElement(I.a,{button:!0,style:{paddingLeft:30},onClick:function(){return e.toolExecute("Invert")}},i.a.createElement(Sa.a,null,i.a.createElement(Be.a,{path:Ge.K,size:"1.2rem",color:"#FFFFFF"})),i.a.createElement(C.a,{classes:a,primary:"Invert"})))),i.a.createElement(I.a,{button:!0,onClick:function(){return e.toggleTools()},disabled:!n},i.a.createElement(Sa.a,null,i.a.createElement(Be.a,{path:Ge.W,size:"1.2rem",color:"#FFFFFF"})),i.a.createElement(C.a,{classes:a,primary:"Tools"}),l?i.a.createElement(P.a,null):i.a.createElement(T.a,null)),i.a.createElement(O.a,{in:l,timeout:"auto",unmountOnExit:!0},i.a.createElement(x.a,{dense:!0,component:"div"},i.a.createElement(I.a,{button:!0,style:{paddingLeft:30},onClick:function(){return e.toolExecute("notool")},disabled:!n},i.a.createElement(Sa.a,null,i.a.createElement(Be.a,{path:Ge.r,size:"1.0rem",color:this.colorIcon("notool")})),i.a.createElement(C.a,{classes:a,primary:i.a.createElement(D.a,{type:"body1",style:{fontSize:"0.80em",marginLeft:"-23px"}},"No Tool")})),i.a.createElement(I.a,{button:!0,style:{paddingLeft:30},onClick:function(){return e.toolExecute("referencelines")},disabled:!n},i.a.createElement(Sa.a,null,i.a.createElement(Be.a,{path:Ge.d,size:"1.0rem",color:G?"rgba(0, 255, 0, 1.0)":"#FFFFFF"})),i.a.createElement(C.a,{classes:a,primary:i.a.createElement(D.a,{type:"body1",style:{fontSize:"0.80em",marginLeft:"-23px"}},"Reference Lines")})),i.a.createElement(I.a,{button:!0,style:{paddingLeft:30},onClick:function(){return e.toolExecute("serieslink")},disabled:!n},i.a.createElement(Sa.a,null,i.a.createElement(Be.a,{path:Ge.Y,size:"1.0rem",color:W?"rgba(0, 255, 0, 1.0)":"#FFFFFF"})),i.a.createElement(C.a,{classes:a,primary:i.a.createElement(D.a,{type:"body1",style:{fontSize:"0.80em",marginLeft:"-23px"}},"Link Series")})),i.a.createElement(I.a,{button:!0,style:{paddingLeft:30},onClick:function(){return e.toolExecute("Wwwc")},disabled:!n},i.a.createElement(Sa.a,null,i.a.createElement(Be.a,{path:Ge.c,size:"1.2rem",color:this.colorIcon("Wwwc")})),i.a.createElement(C.a,{classes:a,primary:i.a.createElement(D.a,{type:"body1",style:{fontSize:"0.80em",marginLeft:"-23px"}},"WW/WC")})),i.a.createElement(I.a,{button:!0,style:{paddingLeft:30},onClick:function(){return e.toolExecute("Pan")},disabled:!n},i.a.createElement(Sa.a,null,i.a.createElement(Be.a,{path:Ge.s,size:"1.2rem",color:this.colorIcon("Pan")})),i.a.createElement(C.a,{classes:a,primary:i.a.createElement(D.a,{type:"body1",style:{fontSize:"0.80em",marginLeft:"-23px"}},"Pan")})),i.a.createElement(I.a,{button:!0,style:{paddingLeft:30},onClick:function(){return e.toolExecute("Zoom")},disabled:!n},i.a.createElement(Sa.a,null,i.a.createElement(Be.a,{path:Ge.L,size:"1.2rem",color:this.colorIcon("Zoom")})),i.a.createElement(C.a,{classes:a,primary:i.a.createElement(D.a,{type:"body1",style:{fontSize:"0.80em",marginLeft:"-23px"}},"Zoom")})),i.a.createElement(I.a,{button:!0,style:{paddingLeft:30},onClick:function(){return e.toolExecute("Magnify")},disabled:!n},i.a.createElement(Sa.a,null,i.a.createElement(Be.a,{path:Ge.j,size:"1.2rem",color:this.colorIcon("Magnify")})),i.a.createElement(C.a,{classes:a,primary:i.a.createElement(D.a,{type:"body1",style:{fontSize:"0.80em",marginLeft:"-23px"}},"Magnify")})),i.a.createElement(I.a,{button:!0,style:{paddingLeft:30},onClick:function(){return e.toolExecute("Length")},disabled:!n},i.a.createElement(Sa.a,null,i.a.createElement(Be.a,{path:Ge.Q,size:"1.2rem",color:this.colorIcon("Length")})),i.a.createElement(C.a,{classes:a,primary:i.a.createElement(D.a,{type:"body1",style:{fontSize:"0.80em",marginLeft:"-23px"}},"Length")})),i.a.createElement(I.a,{button:!0,style:{paddingLeft:30},onClick:function(){return e.toolExecute("Probe")},disabled:!n},i.a.createElement(Sa.a,null,i.a.createElement(Be.a,{path:Ge.y,size:"1.2rem",color:this.colorIcon("Probe")})),i.a.createElement(C.a,{classes:a,primary:i.a.createElement(D.a,{type:"body1",style:{fontSize:"0.80em",marginLeft:"-23px"}},"Probe")})),i.a.createElement(I.a,{button:!0,style:{paddingLeft:30},onClick:function(){return e.toolExecute("Angle")},disabled:!n},i.a.createElement(Sa.a,null,i.a.createElement(Be.a,{path:Ge.a,size:"1.2rem",color:this.colorIcon("Angle")})),i.a.createElement(C.a,{classes:a,primary:i.a.createElement(D.a,{type:"body1",style:{fontSize:"0.80em",marginLeft:"-23px"}},"Angle")})),i.a.createElement(I.a,{button:!0,style:{paddingLeft:30},onClick:function(){return e.toolExecute("EllipticalRoi")},disabled:!n},i.a.createElement(Sa.a,null,i.a.createElement(Be.a,{path:Ge.w,size:"1.2rem",color:this.colorIcon("EllipticalRoi")})),i.a.createElement(C.a,{classes:a,primary:i.a.createElement(D.a,{type:"body1",style:{fontSize:"0.80em",marginLeft:"-23px"}},"Elliptical Roi")})),i.a.createElement(I.a,{button:!0,style:{paddingLeft:30},onClick:function(){return e.toolExecute("RectangleRoi")},disabled:!n},i.a.createElement(Sa.a,null,i.a.createElement(Be.a,{path:Ge.O,size:"1.2rem",color:this.colorIcon("RectangleRoi")})),i.a.createElement(C.a,{classes:a,primary:i.a.createElement(D.a,{type:"body1",style:{fontSize:"0.80em",marginLeft:"-23px"}},"Rectangle Roi")})),i.a.createElement(I.a,{button:!0,style:{paddingLeft:30},onClick:function(){return e.toolExecute("FreehandRoi")},disabled:!n},i.a.createElement(Sa.a,null,i.a.createElement(Be.a,{path:Ge.H,size:"1.2rem",color:this.colorIcon("FreehandRoi")})),i.a.createElement(C.a,{classes:a,primary:i.a.createElement(D.a,{type:"body1",style:{fontSize:"0.80em",marginLeft:"-23px"}},"Freehand Roi")}))))),this.isMultipleFiles||_?i.a.createElement("div",null,i.a.createElement(Ea.a,null),i.a.createElement("div",{align:"center"},i.a.createElement(Ue.a,{onClick:this.listOpenFilesFirstFrame,size:"small"},i.a.createElement(Be.a,{path:Ge.R,size:"1.0rem",color:"#FFFFFF"})),i.a.createElement(Ue.a,{onClick:this.listOpenFilesPreviousFrame,size:"small"},i.a.createElement(Be.a,{path:Ge.U,size:"1.0rem",color:"#FFFFFF"})),i.a.createElement(Ue.a,{onClick:this.listOpenFilesScrolling,size:"small"},i.a.createElement(Be.a,{path:this.state.listOpenFilesScrolling?Ge.M:Ge.N,size:"1.0rem",color:"#FFFFFF"})),i.a.createElement(Ue.a,{onClick:this.listOpenFilesNextFrame,size:"small"},i.a.createElement(Be.a,{path:Ge.T,size:"1.0rem",color:"#FFFFFF"})),i.a.createElement(Ue.a,{onClick:this.listOpenFilesLastFrame,size:"small"},i.a.createElement(Be.a,{path:Ge.S,size:"1.0rem",color:"#FFFFFF"}))),i.a.createElement("div",{style:{textAlign:"center"}},i.a.createElement(D.a,{type:"body1",style:{fontSize:"0.80em"}},"".concat(this.state.sliceIndex+1," / ").concat(J))),i.a.createElement("div",{style:{width:"130px",margin:"auto"}},i.a.createElement(jt.a,{style:{marginTop:"-4px"},value:this.state.sliceIndex,onChange:this.handleSliceChange,color:"secondary",min:0,max:J-1,step:100/J}))):null))),i.a.createElement(ba.a,{variant:"persistent",anchor:"right",open:m,onClose:this.toggleHeader},m?i.a.createElement(tt,{dcmViewer:X,classes:t,color:"#FFFFFF"}):null),i.a.createElement(ba.a,{variant:"persistent",anchor:"right",open:p,onClose:this.toggleMeasure},i.a.createElement("div",{style:{marginTop:"48px"}},i.a.createElement(et.a,{variant:"dense"},i.a.createElement(D.a,{variant:"subtitle1",className:t.title},"Measurements\xa0\xa0"),i.a.createElement("div",{className:t.grow}),i.a.createElement(Ue.a,{color:"inherit",onClick:this.saveMeasure,edge:"end"},i.a.createElement(Be.a,{path:Ge.q,size:"1.2rem",color:"#FFFFFF"})),i.a.createElement(Ue.a,{color:"inherit",onClick:this.clearMeasure,edge:"end"},i.a.createElement(Be.a,{path:Ge.X,size:"1.2rem",color:"#FFFFFF"}))),i.a.createElement("div",null,n?i.a.createElement(ra,{dcmViewer:X,toolRemove:this.toolRemove,classes:t}):null))),i.a.createElement(ba.a,{variant:"persistent",anchor:"right",open:f,onClose:this.toggleToolbox},i.a.createElement("div",{style:{marginTop:"48px"}},i.a.createElement("div",null,n?i.a.createElement(Ht,{key:X.filename}):null))),i.a.createElement(ba.a,{variant:"persistent",anchor:se(),open:g,onClose:this.toggleDicomdir},i.a.createElement("div",null,i.a.createElement("div",null,g?i.a.createElement(xe,{onOpenFile:this.handleOpenFileDicomdir,onOpenFs:this.handleOpenSandboxFs}):null))),i.a.createElement(ba.a,{variant:"persistent",anchor:oe(),open:y,onClose:this.toggleFileManager},i.a.createElement("div",null,i.a.createElement("div",null,y?i.a.createElement(zt,{onOpen:this.handleOpenSandboxFs,onOpenImage:this.handleOpenImage,onOpenMultipleFilesCompleted:this.openMultipleFilesCompleted,onOpenDicomdir:this.handleOpenFsDicomdir,color:"#FFFFFF"}):null))),u?i.a.createElement(va,{onClose:this.hideSettings}):null,d?i.a.createElement(F,{onClose:this.showAbout}):null,R?i.a.createElement(ot,{onClose:this.hideDownloadZipDlg,url:this.url}):null,L?i.a.createElement(kt,{onClose:this.hideOpenMultipleFilesDlg,files:this.files,origin:"local"}):null,i.a.createElement(v.a,{open:w,onClose:this.hideClearMeasureDlg},i.a.createElement(S.a,null,"Are you sure to remove all the measurements?"),i.a.createElement(E.a,null,i.a.createElement(h.a,{onClick:this.hideClearMeasureDlg},"Cancel"),i.a.createElement(h.a,{onClick:this.confirmClearMeasureDlg,autoFocus:!0},"Ok"))),i.a.createElement(v.a,{open:M,onClose:this.hideZippedFileDlg},i.a.createElement(S.a,null,"This is a zipped file, would you import into sandbox file system?"),i.a.createElement(E.a,null,i.a.createElement(h.a,{onClick:this.hideZippedFileDlg},"Cancel"),i.a.createElement(h.a,{onClick:this.confirmZippedFileDlg,autoFocus:!0},"Ok"))),i.a.createElement(v.a,{open:this.state.visibleOpenUrl},i.a.createElement(S.a,null,"Open URL"),i.a.createElement(b.a,null,i.a.createElement(we.a,null,"Insert an URL to download a DICOM or image file:"),i.a.createElement(Ot.a,{autoFocus:!0,margin:"dense",id:"id-open-url",inputRef:function(t){return e.openUrlField=t},fullWidth:!0})),i.a.createElement(E.a,null,i.a.createElement(h.a,{onClick:function(){return e.hideOpenUrl(!1)}},"Cancel"),i.a.createElement(h.a,{onClick:function(){return e.hideOpenUrl(!0)},autoFocus:!0},"Ok"))),i.a.createElement(v.a,{open:this.state.visibleMessage},i.a.createElement(S.a,null,this.state.titleMessage),i.a.createElement(b.a,null,i.a.createElement(we.a,null,this.state.textMessage)),i.a.createElement(E.a,null,i.a.createElement(h.a,{onClick:function(){return e.setState({visibleMessage:!1})}},"Cancel"))),i.a.createElement(Ia.a,{id:"id-layout",open:k,anchorEl:this.state.anchorElLayout,onClose:this.closeLayout,anchorOrigin:{vertical:"center",horizontal:"right"},transformOrigin:{vertical:"center",horizontal:"left"}},i.a.createElement(Jt,{row:this.props.layout[0]-1,col:this.props.layout[1]-1,onChange:this.changeLayout})),i.a.createElement(Ia.a,{id:"id-tools",open:H,anchorEl:this.state.anchorElToolsPanel,onClose:this.closeToolsPanel,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"center"}},i.a.createElement(Qt,{toolActive:this.state.toolActive,referenceLines:G,seriesLink:W,toolExecute:this.toolExecute,onChange:this.changeLayout})),i.a.createElement(Ca.a,{anchorOrigin:{vertical:"top",horizontal:"center"},open:V,autoHideDuration:6e3,message:"Volume building, wait please ..."}),i.a.createElement("div",{style:{height:"calc(100vh - 48px)"}},this.buildLayoutGrid()),i.a.createElement(ba.a,{variant:"persistent",anchor:"right",open:U,onClose:this.toggleExplorer},i.a.createElement("div",null,i.a.createElement("div",null,U?i.a.createElement(Et,{explorer:this.explorer,onSelectSeries:this.explorerOnSelectSeries,color:"#FFFFFF"}):null))),i.a.createElement("div",null,i.a.createElement("input",{type:"file",id:"file_open",style:{display:"none"},ref:this.fileOpen,onChange:function(t){return e.handleOpenLocalFs(t.target.files)},multiple:!0})),i.a.createElement("div",null,i.a.createElement("input",{type:"file",id:"file_dicomdir",style:{display:"none"},ref:this.openDicomdir,onChange:function(t){return e.handleOpenDicomdir(t.target.files)},webkitdirectory:"",mozdirectory:"",directory:"",multiple:!0})),i.a.createElement("div",null,i.a.createElement("input",{type:"file",id:"file_folder",style:{display:"none"},ref:this.openFolder,onChange:function(t){return e.handleOpenFolder(t.target.files)},webkitdirectory:"",mozdirectory:"",directory:"",multiple:!0})))}}]),a}(n.PureComponent),wa=Object(g.b)((function(e){return{localFileStore:e.localFileStore,files:e.files,series:e.series,isOpen:e.isOpen,tool:e.tool,activeDcmIndex:e.activeDcmIndex,explorerActivePatientIndex:e.explorerActivePatientIndex,explorerActiveStudyIndex:e.explorerActiveStudyIndex,explorerActiveSeriesIndex:e.explorerActiveSeriesIndex,measurements:e.measurements,layout:e.layout,dicomdir:e.dicomdir,fsZippedFile:e.fsZippedFile}}),(function(e){return{clearingStore:function(){return e({type:"CLEAR_STORE"})},setLocalFileStore:function(t){return e(function(e){return{type:"LOCALFILE_STORE",localFile:e}}(t))},toolStore:function(t){return e(pe(t))},isOpenStore:function(t){return e(de(t))},setActiveDcm:function(t){return e(fe(t))},setActiveDcmIndex:function(t){return e(function(e){return{type:"ACTIVE_DCM_INDEX",activeDcmIndex:e}}(t))},setActiveMeasurements:function(t){return e(ge(t))},setLayoutStore:function(t,a){return e(function(e,t){return{type:"LAYOUT",layout:[e,t]}}(t,a))},setDicomdirStore:function(t){return e(function(e){return{type:"DICOMDIR",dicomdir:e}}(t))},setFsZippedFile:function(t){return e(ve(t))},setVolumeStore:function(t){return e({type:"VOLUME_STORE",volume:t})},setFilesStore:function(t){return e(ue(t))},setExplorerActiveSeriesIndex:function(t){return e(he(t))}}}))(Object(f.a)((function(e){return{"@global":{body:{backgroundColor:e.palette.common.black}},grow:{flexGrow:1},root:{display:"flex"},menuButton:{marginRight:e.spacing(2)},title:{flexGrow:1},appBar:{position:"relative",zIndex:e.zIndex.drawer+1,transition:e.transitions.create(["width","margin"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen})},appBarShift:{marginLeft:240,width:"calc(100% - ".concat(240,"px)"),transition:e.transitions.create(["width","margin"],{easing:e.transitions.easing.sharp,duration:e.transitions.duration.enteringScreen})},hide:{display:"none"},drawer:{width:240,flexShrink:0,whiteSpace:"nowrap"},drawerOpen:{width:240,transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.enteringScreen})},drawerClose:Object(p.a)({transition:e.transitions.create("width",{easing:e.transitions.easing.sharp,duration:e.transitions.duration.leavingScreen}),overflowX:"hidden",width:e.spacing(7)+1},e.breakpoints.up("sm"),{width:e.spacing(9)+1}),toolbar:e.mixins.toolbar,content:{flexGrow:1,padding:e.spacing(3)},listItemText:{fontSize:"0.85em",marginLeft:"-20px"}}}))(Da)),Fa=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Oa(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var a=e.installing;null!=a&&(a.onstatechange=function(){"installed"===a.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var Ma=a(144),Ra=a.n(Ma),Pa=a(90);var La={localFile:null,fsFile:null,files:null,series:null,isOpen:new Array(16).fill(!1),tool:null,activeDcmIndex:0,activeDcm:null,explorer:null,explorerActivePatientIndex:0,explorerActiveStudyIndex:0,explorerActiveSeriesIndex:0,measurements:[],layout:[1,1],dicomdir:null,fsCurrentDir:"",fsCurrentList:[],fsZippedFile:null,fsRefresh:!1,volume:null,dcmEnableTool:!1},Ta=Object(Pa.b)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"CLEAR_STORE":return{localFile:e.localFile,fsFile:e.fsFile,files:null,series:null,isOpen:e.isOpen.map((function(t,a){return a!==e.activeDcmIndex&&t})),tool:null,activeDcmIndex:e.activeDcmIndex,activeDcm:e.activeDcm,explorer:e.explorer,explorerActivePatientIndex:e.explorerActivePatientIndex,explorerActiveStudyIndex:e.explorerActiveStudyIndex,explorerActiveSeriesIndex:e.explorerActiveSeriesIndex,measurements:null,layout:e.layout,dicomdir:e.dicomdir,fsCurrentDir:e.fsCurrentDir,fsCurrentList:e.fsCurrentList,fsZippedFile:null,fsRefresh:e.fsRefresh,volume:null,dcmEnableTool:!1};case"LOCALFILE_STORE":return Object($e.a)(Object($e.a)({},e),{},{localFile:t.localFile,fsFile:null});case"LOCALFILE_STORE":return Object($e.a)(Object($e.a)({},e),{},{localFile:null,fsFile:t.fsFile});case"FILES_STORE":return Object($e.a)(Object($e.a)({},e),{},{files:t.files});case"SERIES_STORE":return Object($e.a)(Object($e.a)({},e),{},{series:t.series});case"DCM_IS_OPEN":return Object($e.a)(Object($e.a)({},e),{},{isOpen:e.isOpen.map((function(e,a){return a===t.value.index?t.value.value:e})),measurements:e.measurements,layout:e.layout,dicomdir:e.dicomdir,fsCurrentDir:e.fsCurrentDir,fsCurrentList:e.fsCurrentList});case"DCM_TOOL":return Object($e.a)(Object($e.a)({},e),{},{tool:t.tool,measurements:e.measurements,layout:e.layout,dicomdir:e.dicomdir,fsCurrentDir:e.fsCurrentDir,fsCurrentList:e.fsCurrentList});case"ACTIVE_DCM_INDEX":return Object($e.a)(Object($e.a)({},e),{},{activeDcmIndex:t.activeDcmIndex,measurements:e.measurements,layout:e.layout,dicomdir:e.dicomdir,fsCurrentDir:e.fsCurrentDir,fsCurrentList:e.fsCurrentList});case"ACTIVE_DCM":return Object($e.a)(Object($e.a)({},e),{},{activeDcm:t.activeDcm,measurements:e.measurements,layout:e.layout,dicomdir:e.dicomdir,fsCurrentDir:e.fsCurrentDir,fsCurrentList:e.fsCurrentList});case"ACTIVE_MEASUREMENTS":return Object($e.a)(Object($e.a)({},e),{},{measurements:Object(s.a)(t.measurements)});case"EXPLORER_STORE":return Object($e.a)(Object($e.a)({},e),{},{explorer:t.explorer});case"EXPLORER_ACTIVE_PATIENT_INDEX":return Object($e.a)(Object($e.a)({},e),{},{explorerActivePatientIndex:t.explorerActivePatientIndex});case"EXPLORER_ACTIVE_STUDY_INDEX":return Object($e.a)(Object($e.a)({},e),{},{explorerActiveStudyIndex:t.explorerActiveStudyIndex});case"EXPLORER_ACTIVE_SERIES_INDEX":return Object($e.a)(Object($e.a)({},e),{},{explorerActiveSeriesIndex:t.explorerActiveSeriesIndex});case"LAYOUT":return Object($e.a)(Object($e.a)({},e),{},{measurements:e.measurements,layout:t.layout,dicomdir:e.dicomdir,fsCurrentDir:e.fsCurrentDir,fsCurrentList:e.fsCurrentList});case"DICOMDIR":return Object($e.a)(Object($e.a)({},e),{},{dicomdir:t.dicomdir});case"FSCURRENTDIR":return Object($e.a)(Object($e.a)({},e),{},{fsCurrentDir:t.fsCurrentDir});case"FSCURRENTLIST":return Object($e.a)(Object($e.a)({},e),{},{fsCurrentList:Object(s.a)(t.fsCurrentList)});case"FSZIPPEDFILE":return Object($e.a)(Object($e.a)({},e),{},{fsZippedFile:t.fsZippedFile});case"FSREFRESH":return Object($e.a)(Object($e.a)({},e),{},{fsRefresh:!e.fsRefresh});case"VOLUME_STORE":return Object($e.a)(Object($e.a)({},e),{},{volume:t.volume});case"DCMENABLETOOL_STORE":return Object($e.a)(Object($e.a)({},e),{},{dcmEnableTool:t.dcmEnableTool});default:return e}}),La,window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__()),ka=a(145),Aa=a(279);Ra.a.load({google:{families:["Roboto:300,400,500,700","Material Icons"]}});var Va=Object(ka.a)({overrides:{MuiFormControlLabel:{label:{fontSize:"0.85em"}},MuiFormLabel:{root:{"&$focused":{color:"#CCCCCC"}}}},palette:{primary:{main:"#004d40"},secondary:{main:"#888888"},type:"dark"}});o.a.render(i.a.createElement(g.a,{store:Ta},i.a.createElement(Aa.a,{theme:Va},i.a.createElement(wa,null))),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/u-dicom-viewer",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/u-dicom-viewer","/service-worker.js");Fa?(!function(e,t){fetch(e).then((function(a){var n=a.headers.get("content-type");404===a.status||null!=n&&-1===n.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):Oa(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):Oa(t,e)}))}}()}},[[164,1,2]]]);
//# sourceMappingURL=main.fae65f24.chunk.js.map